{"version":3,"sources":["webpack:///./app/src/modules/HomeModule/ui/PostEffects.ts","webpack:///./app/src/modules/HomeModule/utils/DollyZoom.ts","webpack:///./app/src/modules/HomeModule/ui/materials/DOFPointsMaterial.ts","webpack:///./app/src/modules/HomeModule/ui/UIRing.ts","webpack:///./app/src/modules/HomeModule/ui/Eye.ts","webpack:///./app/src/modules/HomeModule/ui/LandingMouseEnter.ts","webpack:///./app/src/modules/HomeModule/ui/ExploreButton.ts","webpack:///./app/src/modules/HomeModule/utils/SortPoints.ts","webpack:///./app/src/modules/HomeModule/ui/ChapterIntro.ts","webpack:///./app/src/modules/HomeModule/ui/ChapterPOIText.ts","webpack:///./app/src/modules/HomeModule/ui/chapters/Chapter.ts","webpack:///./app/src/modules/HomeModule/ui/MakeChoice.ts","webpack:///./app/src/modules/HomeModule/ui/chapters/Chapter2.ts","webpack:///./app/src/modules/HomeModule/utils/LoadManager.ts","webpack:///./app/src/modules/HomeModule/ui/chapters/Chapter1.ts","webpack:///./app/src/modules/HomeModule/ui/ClusterCloud.ts","webpack:///./app/src/modules/HomeModule/ui/ExploreNav.ts","webpack:///./app/src/modules/HomeModule/ui/chapters/Chapter3.ts","webpack:///./app/src/modules/HomeModule/ui/chapters/Chapter4.ts","webpack:///./app/src/modules/HomeModule/ui/chapters/Chapter5.ts","webpack:///./app/src/modules/HomeModule/ui/Gallery.ts","webpack:///./app/src/modules/HomeModule/ui/AmbientAudio.ts","webpack:///./app/src/modules/HomeModule/ui/MainScene.ts"],"names":["scene","camera","renderer","menu","clock","enabled","_godRaysEnabled","this","composer","renderPass","renderToScreen","addPass","noiseEffect","blendFunction","MULTIPLY","blendMode","params","abberationEnabled","noiseEnabled","noiseOpacity","abberationOffsetX","abberationOffsetY","add","onChange","value","setBlendFunction","Number","opacity","min","max","step","removePass","standardPass","godrayPass","sun","light","godRaysEffect","height","kernelSize","SMALL","density","decay","weight","exposure","samples","clampMax","uniforms","godRaysMaterial","color","resolution","blurriness","blurPass","copyLinearToSRGB","material","getHex","GodRaysFolder","addFolder","VERY_SMALL","HUGE","blur","addColor","setHex","convertSRGBToLinear","position","x","updateMatrix","y","z","render","getDelta","cameraLookAtPoint","totalProgress","initialized","progress","startFOV","endFOV","focusZ","endZ","currentFOV","initDepth","_cameraLookAtPoint","_cameraLookAtObject","Math","tan","PI","fov","init","current_depht_s","aspect","fovZ","atan2","DOFPointsMaterialCOUNT","DEBUG_DOF","gui","guiName","dofParams","focusNear","focusFar","focusFadeOutLength","maxBlur","minBlur","minOpacity","maxOpacity","useFocusCenter","focusCenter","focusLength","radiusScaleFactor","viewport","GlobalsLanding","RENDERER_HEIGHT","PIXEL_RATIO","RENDERER_PIXEL_RATIO","pointTexture","texCircleSolid","pointTextureAlpha","texCircleAlpha","window","addEventListener","super","depthWrite","vertexShader","fragmentShader","transparent","BokehFolder","updateFocusCenter","container","radius","segments","thetaStart","thetaLength","name","geometry","buildGeometry","points","vertex","vertices","sizes","Float32Array","colors","s","segment","cos","sin","push","r","g","b","setAttribute","computeBoundingSphere","postEffects","loadManager","group","pointCloudContainer","ringsGroup","rings","eyeGeometryLoaded","gltf","createRings","eye","children","rotation","metalness","roughness","map","texture","flatShading","center","repeat","set","gsap","to","ease","duration","setupGeometry","path","pointCloudBelt","renderOrder","scale","yoyo","mainLight","sunMaterial","fog","sunGeometry","copy","frustumCulled","matrixAutoUpdate","godraysEffect","setupGodRaysAndSmaa","loadTexture","loadGLTF","addLoadItem","doneCallback","tl","timeline","fromTo","onUpdate","from","paused","fadeOutLength","tl2","delay","visible","round","offset","forEach","ring","index","MouseMoveTracker","target","speed","hitArea","pos","innerWidth","innerHeight","mouse","resetTween","raf","xSet","quickSetter","ySet","dt","pow","ticker","deltaRatio","originX","bounds","left","right","originY","top","bottom","kill","onWindowResize","getBoundingClientRect","enable","disable","killTweensOf","remove","removeEventListener","gallery","main","document","querySelector","frustum","matrix","sphere","clickHandler","event","preventDefault","setGalleryItems","currentExploreChapter","galleryImages","show","force3D","visibility","object","widthHalf","heightHalf","projectionMatrix","multiply","matrixWorldInverse","setFromProjectionMatrix","setFromMatrixPosition","matrixWorld","intersectsSphere","project","vector","sortArray","numericalSort","a","registerPlugin","SplitText","title","title2","querySelectorAll","split","type","charsClass","split2","chars","char","innerHTML","innerText","stagger","each","grid","cameraWrapper","mainGroup","exploreButton","chapterIntro","chapterPOITitles","exploreNavLink","sortPoints","chapterWrapper","exploreAnchor","currentChapterScrollProgress","scrollProgress","SCROLL_LENGTH","CHAPTER_DISTANCE","CHAPTER_OFFSET","setupScrollTimeline","setActiveExploreItem","activeExploreAnchor","titles","dataset","exploreTitles","descriptions","exploreDescriptions","exploreImages","url","description","ringsMaterial","chapterIntroClass","chapterPOIs","scrollTimeline","sortPointsData","point","multiplyMatrices","getIndex","positions","getAttribute","array","length","i","setIndex","fromArray","applyMatrix4","sort","indices","needsUpdate","toNonIndexed","currHoverIndex","mouseOver","hideCurrentIndex","currImageHoverTimeline","imagesComp","yPercent","xPercent","imagesSingular","mouseOut","instant","svg","buttons","descriptionWrapper","centerWrapper","scrollIndicator","choiceText","scrollLine","scrollLineBG","scrollLineDiamond","exploreNav","inTimeline","pointerEvents","call","pause","playIn","MainScene","width","scaleY","button","play","planetLinkContainer","ringsWrapper","itemLoaded","mesh","_shipWrapper","_ship","spaceStation","spaceContainer","planetLink","introOffset","dollyZoom7","update","clusterCloud","st","tlDolly","dummy","mousePanAmount","mouseMoveAmount","dollyZoom","dollyZoom2","dollyZoom3","dollyZoom4","dollyZoom5","dollyZoom6","CustomEase","create","makeChoice","loadDone","createChapterRings","loadDoneCallback","loadItems","Map","currentlyLoaded","additionalLoads","additionalLoadsCompleted","dracoLoader","DRACOLoader","gltfLoader","GLTFLoader","loadedPaths","taskConfig","attributeIDs","size","attributeTypes","useUniqueIDs","loadItem","has","get","callback","load","result","checkLoadDone","xhr","error","console","log","manager","setURLModifier","setDecoderPath","setDecoderConfig","preload","setDRACOLoader","chapters","chapter","getLoadItems","item","loadObj","onLoad","onProgress","onError","loader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","buffer","decodeGeometry","then","catch","indexOf","dracoLoad","attributes","deleteAttribute","dispose","planetShipsOrbitContainer","shipContainer","shipContainer2","planetShipsOrbit","ship2","ship","planets","j","zOffset","gotoChapter","links","Array","lines","linesInner","linesProgress","diamonds","innerDiamonds","outerDiamonds","highlightDiamonds","highlightDiamondOuters","diamondLabels","linksTimeline","expandTime","dummyTime","dummyTime2","onResize","buildLinksDisplaceTimeline","chapterLengths","currOffset","link","mobile","clear","line","slice","asteroids","miningStation","stationContainer","material2","miningStation2","miningStationPlanet","cosmonaut","cosmonautContainer","capitalShipContainer","capitalShipContainer2","capitalShipContainer3","capitalShip","capitalShip2","capitalShip3","calicoYacht","calicoYachtContainer","endScreen","endScreenItems","councilOfPeace","councilOfPeaceContainer","usturFace","usturFaceContainer","ustur","usturContainer","InertiaPlugin","Draggable","getElementById","imageContainer","imageContainerInner","closeButton","navButtons","jumpNavContainer","progressWrap","utils","wrap","wrapWidth","slides","slideAnimation","slideDuration","currSnapIndex","currSnapX","totalSlides","jumpNavContainerAnchors","onPress","toggleCaption","updateDraggable","onRelease","draggable","isThrowing","tween","noDelay","onStart","textContent","items","animateSlides","direction","currX","getProperty","proxy","isActive","vars","snapX","getSnapIndex","updateProgress","resize","clientWidth","snap","updateSize","norm","animation","closeClickHandler","hide","jumpAnchorClickHandler","currentTarget","slideIndex","killDragThrow","diff","createElement","trigger","IS_ANDROID","inertia","onDrag","onThrowUpdate","onThrowComplete","endDrag","updateAnchors","classList","galleryItems","slide","removeChild","anchor","img","onload","fm","Globals","WEBP_SUPPORTED","srcset","appendChild","jumpAnchor","href","modifiers","autoAlpha","audioElement","soundToggle","body","playing","loadAudio","src","toggleSound","enableAudio","volume","AmbientAudio","_mainGroup","AppContainer","ViewContainer","ScrollSpacer","USE_SCROLL_TIMER","CSS","supports","_cameraLookAtVector","ambientValue","currentMasterScrollProgress","landingSkipped","renderEffects","DEBUG_MODE","DebugHelpers","SKIP_INTRO","URLSearchParams","location","search","SKIP_LOAD_ANIMATION","chapterPositions","scrollHeight","requestAnimationFrameID","ambientAudio","scrollTriggerReady","scrollTrigger","ScrollTrigger","ScrollToPlugin","USE_STICKY","IS_SAFARI","style","zIndex","defaults","scroller","documentElement","clientHeight","_camera","_scene","background","introDollyZoom","_renderer","antialias","stencil","depth","powerPreference","premultipliedAlpha","PREMULTIPLY_ALPHA","setPixelRatio","setSize","premultiplyAlpha","_clock","domElement","setupLights","DEBUG","setupDebug","setupChapters","landingEnterHitArea","enterLanding","diamondMouseEnter","clickMouseEnter","playLoadDoneIntroAnimation","setupDebugControls","animate","requestAnimationFrame","stats","begin","VIDEO_OPEN","MENU_OPEN","xEased","yEased","spotLight","distanceFromCenter","getWorldPosition","lookAt","updateProjectionMatrix","updateMatrixWorld","updateScreenPosition","_controls","helper","debugCamera","end","force","prevWidth","prevHeight","windowWidth","windowHeight","zoom","setTimeout","scroll","maxScroll","getTween","refresh","enableScroll","display","offsetHeight","scrub","SCRUB_DURATION","scrollTimerText","scrolltime","time","parseFloat","start","toFixed","mtl","currPos","currScrollLength","totalDuration","warn","setupTimeline","camPos","clone","camRot","updateWorldMatrix","scrollTo","firstChapter","onComplete","getScrollInAnimation","timeScale","cancelAnimationFrame","isWebGLAvailable","stop","resume","warning","getWebGLErrorMessage","chapterIntros","exploreNavLinks","chapter1","splice","chapter2","chapter3","chapter4","chapter5","setChapters","startLoading","dirLight","intensity","penumbra","angle","power","loadTimeline","getIntroAnimation","firstTimeDebug","key","toggle","cameraHelper","far","OrbitControls","zoomSpeed","dom","close","THREE"],"mappings":"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","file":"MainScene.65041b97.js","sourcesContent":["import { GUI } from 'three/examples/jsm/libs/dat.gui.module';\r\nimport { Clock, Color, Light, LoadingManager, Mesh, MeshBasicMaterial, PerspectiveCamera, PointLight, Scene, WebGLRenderer } from 'three';\r\nimport {\r\n\tBlendFunction,\r\n\tChromaticAberrationEffect,\r\n\tEdgeDetectionMode,\r\n\tEffectComposer,\r\n\tEffectPass,\r\n\tNoiseEffect,\r\n\tOverrideMaterialManager,\r\n\tRenderPass,\r\n\tSMAAEffect,\r\n\tGodRaysEffect,\r\n\tKernelSize,\r\n\tSMAAImageLoader,\r\n\tSMAAPreset\r\n} from 'postprocessing';\r\n\r\n/**\r\n * Loads scene assets.\r\n *\r\n * @return {Promise} Returns loaded assets when ready.\r\n */\r\n\r\nfunction load() {\r\n\tconst assets = new Map();\r\n\tconst loadingManager = new LoadingManager();\r\n\tconst smaaImageLoader = new SMAAImageLoader(loadingManager);\r\n\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tloadingManager.onLoad = () => resolve(assets);\r\n\t\tloadingManager.onError = reject;\r\n\r\n\t\tsmaaImageLoader.load(([search, area]) => {\r\n\t\t\tassets.set('smaa-search', search);\r\n\t\t\tassets.set('smaa-area', area);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport class PostEffects {\r\n\tpublic composer: EffectComposer;\r\n\tprivate scene: Scene;\r\n\tprivate camera: PerspectiveCamera;\r\n\tprivate menu: any;\r\n\tprivate renderer: WebGLRenderer;\r\n\r\n\tpublic enabled = false;\r\n\tprivate smaaPass: any;\r\n\tprivate smaaEffect: any;\r\n\tpublic godRaysEffect: GodRaysEffect;\r\n\tprivate noiseEffect: any;\r\n\tprivate godrayPass: any;\r\n\tprivate clock: Clock;\r\n\tprivate standardPass: any;\r\n\r\n\tprivate _godRaysEnabled = true;\r\n\r\n\tget godRaysEnabled(): boolean {\r\n\t\treturn this._godRaysEnabled;\r\n\t}\r\n\r\n\tset godRaysEnabled(value: boolean) {\r\n\t\tthis._godRaysEnabled = value;\r\n\t\tif (this._godRaysEnabled) {\r\n\t\t\tthis.composer.removePass(this.standardPass);\r\n\t\t\tthis.composer.addPass(this.godrayPass);\r\n\t\t\tthis.standardPass.enabled = false;\r\n\t\t\tthis.godrayPass.enabled = true;\r\n\t\t} else {\r\n\t\t\tthis.godrayPass.enabled = false;\r\n\t\t\tthis.standardPass.enabled = true;\r\n\t\t\tthis.composer.removePass(this.godrayPass);\r\n\t\t\tthis.composer.addPass(this.standardPass);\r\n\t\t}\r\n\t}\r\n\r\n\tconstructor(scene: Scene, camera: PerspectiveCamera, renderer: WebGLRenderer, menu: any, clock: Clock, enabled = true) {\r\n\t\tthis.clock = clock;\r\n\t\tthis.scene = scene;\r\n\t\tthis.camera = camera;\r\n\t\tthis.renderer = renderer;\r\n\t\tthis.menu = menu;\r\n\t\tthis.enabled = enabled;\r\n\t\tthis.composer = new EffectComposer(this.renderer);\r\n\t\tvar renderPass = new RenderPass(this.scene, this.camera);\r\n\t\trenderPass.renderToScreen = false;\r\n\t\tthis.composer.addPass(renderPass);\r\n\r\n\t\t//@todo, check if this makes a diff, otherwise disable:\r\n\t\t// OverrideMaterialManager.workaroundEnabled = true;\r\n\t\tthis.noiseEffect = new NoiseEffect({\r\n\t\t\tblendFunction: BlendFunction.MULTIPLY\r\n\t\t});\r\n\t\t// this.noiseEffect.renderToScreen = false;\r\n\t\tconst blendMode = this.noiseEffect.blendMode;\r\n\r\n\t\tconst params = {\r\n\t\t\tenabled: this.enabled,\r\n\t\t\tabberationEnabled: false,\r\n\t\t\t// \"SMAAEnabled\": true,\r\n\t\t\tnoiseEnabled: true,\r\n\t\t\tnoiseOpacity: 0.1,\r\n\t\t\tabberationOffsetX: 0.001,\r\n\t\t\tabberationOffsetY: 0.0005,\r\n\t\t\t'noise blend mode': blendMode.blendFunction\r\n\t\t};\r\n\r\n\t\t/*        load().then((assets: any) => {\r\n            this.smaaEffect = new SMAAEffect(\r\n                assets.get(\"smaa-search\"),\r\n                assets.get(\"smaa-area\"),\r\n                SMAAPreset.HIGH\r\n                // EdgeDetectionMode.DEPTH\r\n            );\r\n            // this.smaaPass = new EffectPass(this.camera, this.smaaEffect);\r\n            // smaaEffect.edgeDetectionMaterial.setEdgeDetectionThreshold(0.01);\r\n            // this.composer.addPass(this.smaaPass);\r\n\r\n            console.log(\"smaa\")\r\n        }).catch((e) => console.error(e));*/\r\n\r\n\t\tif (menu) {\r\n\t\t\tmenu.add(params, 'enabled').onChange(value => {\r\n\t\t\t\tparams.enabled = value;\r\n\t\t\t\tthis.enabled = value;\r\n\t\t\t\t//depthOfFieldEffect.resolution.height = Number(value);\r\n\t\t\t});\r\n\r\n\t\t\t/*        menu.add(params, \"SMAAEnabled\").onChange((value) => {\r\n                        this.smaaEffect.enabled = value;\r\n                    });*/\r\n\t\t\tmenu.add(params, 'noise blend mode', BlendFunction).onChange(value => {\r\n\t\t\t\tthis.noiseEffect.blendMode.setBlendFunction(Number(value));\r\n\t\t\t});\r\n\t\t}\r\n\t\t// const chromaticAberrationEffect = new ChromaticAberrationEffect();\r\n\r\n\t\tthis.noiseEffect.blendMode.opacity.value = params.noiseOpacity;\r\n\r\n\t\t/*        const chromaticAberrationPass = new EffectPass(this.camera, chromaticAberrationEffect);\r\n        chromaticAberrationPass.enabled = params.abberationEnabled;\r\n        this.composer.addPass(chromaticAberrationPass);*/\r\n\t\t/*        console.log(chromaticAberrationEffect.offset);\r\n        const noisePass = new EffectPass(this.camera, this.noiseEffect);\r\n        this.composer.addPass(noisePass);*/\r\n\r\n\t\tif (menu) {\r\n\t\t\tmenu.add(params, 'noiseOpacity')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.0001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.noiseEffect.blendMode.opacity.value = value;\r\n\t\t\t\t});\r\n\t\t}\r\n\t\t/*       menu.add(params, \"abberationOffsetX\").min(-0.01).max(0.01).step(.00001).onChange((value) => {\r\n                   chromaticAberrationEffect.offset.x = value;\r\n               });\r\n               menu.add(params, \"abberationOffsetY\").min(-0.01).max(0.01).step(.00001).onChange((value) => {\r\n                   chromaticAberrationEffect.offset.y = value;\r\n               });\r\n               menu.add(params, \"abberationEnabled\").onChange((value) => {\r\n                   chromaticAberrationPass.enabled = value;\r\n               });*/\r\n\t}\r\n\r\n\tpublic setupGodRaysAndSmaa(sun: Mesh, light: PointLight) {\r\n\t\tconst godRaysEffect = new GodRaysEffect(this.camera, sun, {\r\n\t\t\theight: 480,\r\n\t\t\tkernelSize: KernelSize.SMALL,\r\n\t\t\tdensity: 0.8,\r\n\t\t\tdecay: 0.9,\r\n\t\t\tweight: 0.7,\r\n\t\t\texposure: 0.9,\r\n\t\t\tsamples: 35, //@todo: lower this, to around 37\r\n\t\t\tclampMax: 1.0\r\n\t\t});\r\n\r\n\t\t// const noisePass = new EffectPass(this.camera, this.noiseEffect);\r\n\r\n\t\tthis.godRaysEffect = godRaysEffect;\r\n\r\n\t\tthis.godrayPass = new EffectPass(this.camera, /*this.smaaEffect,*/ godRaysEffect, this.noiseEffect);\r\n\t\tthis.standardPass = new EffectPass(this.camera, /*this.smaaEffect,*/ this.noiseEffect);\r\n\r\n\t\tthis.composer.addPass(this.godrayPass);\r\n\r\n\t\tconst uniforms = godRaysEffect.godRaysMaterial.uniforms;\r\n\t\tconst blendMode = godRaysEffect.blendMode;\r\n\t\tconst color = new Color();\r\n\r\n\t\tconst params = {\r\n\t\t\tresolution: godRaysEffect.height,\r\n\t\t\tblurriness: godRaysEffect.blurPass.kernelSize + 0,\r\n\t\t\tdensity: uniforms.density.value,\r\n\t\t\tdecay: uniforms.decay.value,\r\n\t\t\tweight: uniforms.weight.value,\r\n\t\t\texposure: uniforms.exposure.value,\r\n\t\t\tclampMax: uniforms.clampMax.value,\r\n\t\t\tsamples: godRaysEffect.samples,\r\n\t\t\tcolor: color.copyLinearToSRGB((sun.material as MeshBasicMaterial).color).getHex(),\r\n\t\t\topacity: blendMode.opacity.value,\r\n\t\t\t'blend mode': blendMode.blendFunction\r\n\t\t}; /*\r\n        this.menu.add(params, \"noiseEnabled\").onChange((value) => {\r\n            noisePass.enabled = value;\r\n        });*/\r\n\t\tif (this.menu) {\r\n\t\t\tlet GodRaysFolder = this.menu.addFolder('Eye Godrays');\r\n\t\t\tGodRaysFolder.add(params, 'resolution', [240, 360, 480, 720, 1080]).onChange(value => {\r\n\t\t\t\tgodRaysEffect.resolution.height = Number(value);\r\n\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(this.godrayPass, 'dithering');\r\n\r\n\t\t\tGodRaysFolder.add(params, 'blurriness')\r\n\t\t\t\t.min(KernelSize.VERY_SMALL)\r\n\t\t\t\t.max(KernelSize.HUGE + 1)\r\n\t\t\t\t.step(1)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tgodRaysEffect.blur = value > 0;\r\n\t\t\t\t\tgodRaysEffect.blurPass.kernelSize = value - 1;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'density')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tuniforms.density.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'decay')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tuniforms.decay.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'weight')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tuniforms.weight.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'exposure')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tuniforms.exposure.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'clampMax')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tuniforms.clampMax.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(godRaysEffect, 'samples')\r\n\t\t\t\t.min(15)\r\n\t\t\t\t.max(200)\r\n\t\t\t\t.step(1);\r\n\r\n\t\t\tGodRaysFolder.addColor(params, 'color').onChange(value => {\r\n\t\t\t\t(sun.material as MeshBasicMaterial).color.setHex(value).convertSRGBToLinear();\r\n\t\t\t\tlight.color.setHex(value).convertSRGBToLinear();\r\n\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'opacity')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tblendMode.opacity.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(params, 'blend mode', BlendFunction).onChange(value => {\r\n\t\t\t\tblendMode.setBlendFunction(Number(value));\r\n\t\t\t});\r\n\r\n\t\t\tGodRaysFolder.add(sun.position, 'x')\r\n\t\t\t\t.min(-10.0)\r\n\t\t\t\t.max(10.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tsun.position.x = value;\r\n\t\t\t\t\tsun.updateMatrix();\r\n\t\t\t\t});\r\n\t\t\tGodRaysFolder.add(sun.position, 'y')\r\n\t\t\t\t.min(-10.0)\r\n\t\t\t\t.max(10.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tsun.position.y = value;\r\n\t\t\t\t\tsun.updateMatrix();\r\n\t\t\t\t});\r\n\t\t\tGodRaysFolder.add(sun.position, 'z')\r\n\t\t\t\t.min(-10.0)\r\n\t\t\t\t.max(10.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tsun.position.z = value;\r\n\t\t\t\t\tsun.updateMatrix();\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn godRaysEffect;\r\n\t}\r\n\r\n\trender() {\r\n\t\tthis.composer.render(this.clock.getDelta());\r\n\t}\r\n}\r\n","import { Object3D, PerspectiveCamera, Vector3 } from 'three';\r\nimport { gsap } from 'gsap';\r\n\r\nexport class DollyZoom {\r\n\tprivate camera: PerspectiveCamera;\r\n\r\n\tpublic totalProgress = 0;\r\n\tpublic initialized = false;\r\n\tpublic progress = { startFOV: 15, endFOV: 110, focusZ: -200, endZ: -110 };\r\n\tpublic currentFOV = -1;\r\n\tprivate initDepth: number = 0;\r\n\tprivate _cameraLookAtObject: Object3D;\r\n\tprivate _cameraLookAtPoint = new Vector3();\r\n\r\n\tconstructor(camera: PerspectiveCamera, cameraLookAtPoint: Object3D) {\r\n\t\tthis.camera = camera;\r\n\t\tthis._cameraLookAtObject = cameraLookAtPoint;\r\n\t}\r\n\r\n\tpublic init() {\r\n\t\tthis.camera.position.z = this.progress.focusZ;\r\n\t\tthis.initDepth = Math.tan(((this.progress.startFOV / 2.0) * Math.PI) / 180.0) * 2.0;\r\n\t}\r\n\r\n\tupdate(endFOV: number, endZ: number, startFOV?: number, progress?: number) {\r\n\t\tif (!this.initialized) {\r\n\t\t\tthis.initialized = true;\r\n\t\t\tthis.progress = {\r\n\t\t\t\tstartFOV: startFOV ? startFOV : this.camera.fov,\r\n\t\t\t\tendFOV: endFOV,\r\n\t\t\t\tfocusZ: this.camera.position.z,\r\n\t\t\t\tendZ: this.camera.position.z + endZ\r\n\t\t\t};\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t\tthis.currentFOV = this.progress.startFOV + (this.progress.endFOV - this.progress.startFOV) * (progress ? progress : this.totalProgress);\r\n\t\tlet current_depht_s = Math.tan(((this.currentFOV / 2.0) * Math.PI) / 180.0) * 2.0;\r\n\r\n\t\tthis.camera.position.z = this.progress.endZ + ((this.progress.focusZ - this.progress.endZ) * this.initDepth) / current_depht_s;\r\n\t\tthis.camera.fov = this.currentFOV;\r\n\t\t/*        this._cameraLookAtObject.getWorldPosition(this._cameraLookAtPoint);\r\n        this.camera.lookAt(this._cameraLookAtPoint);\r\n        // @ts-ignore\r\n        // console.log(this.camera.getWorldPosition().z, this._cameraLookAtPoint.z, this.currentFOV);\r\n        this.camera.updateProjectionMatrix();*/\r\n\t}\r\n\r\n\tgetValues(progress: number) {\r\n\t\tthis.currentFOV = this.progress.startFOV + (this.progress.endFOV - this.progress.startFOV) * progress;\r\n\t\tlet current_depht_s = Math.tan(((this.currentFOV / 2.0) * Math.PI) / 180.0) * 2.0;\r\n\r\n\t\t// this.camera.position.z = this.progress.endZ + ((this.progress.focusZ - this.progress.endZ) * this.initDepth / current_depht_s);\r\n\t\t// this._cameraLookAtObject.getWorldPosition(this._cameraLookAtPoint);\r\n\t\t// this.camera.lookAt(this._cameraLookAtPoint);\r\n\t\t// @ts-ignore\r\n\t\t// console.log(this.camera.getWorldPosition().z, this._cameraLookAtPoint.z, this.currentFOV);\r\n\t\t// this.camera.updateProjectionMatrix();\r\n\t\treturn {\r\n\t\t\tfov: this.currentFOV,\r\n\t\t\tz: this.progress.endZ + ((this.progress.focusZ - this.progress.endZ) * this.initDepth) / current_depht_s\r\n\t\t};\r\n\t}\r\n\r\n\tconvertFovToZ(fov) {\r\n\t\treturn 1 / (2 * this.camera.aspect * Math.tan((fov / 2) * (Math.PI / 180)));\r\n\t}\r\n\r\n\tconvertZToFov(fovZ) {\r\n\t\treturn 2 * Math.atan2(1, 2 * this.camera.aspect * fovZ) * (180 / Math.PI);\r\n\t}\r\n}\r\n","import { Color, ShaderMaterial, Texture } from 'three';\r\nimport { GlobalsLanding } from '../../utils/GlobalsLanding';\r\n\r\nexport interface IDofParams {\r\n\tfocusNear?: number;\r\n\tfocusFar?: number;\r\n\tfocusFadeOutLength?: number;\r\n\tmaxBlur?: number;\r\n\tminBlur?: number;\r\n\tminOpacity?: number;\r\n\tmaxOpacity?: number;\r\n\tuseFocusCenter?: boolean;\r\n\tfocusCenter?: number;\r\n\tfocusLength?: number;\r\n\tradiusScaleFactor?: number;\r\n}\r\n\r\n// private tex = new TextureLoader().load('point.png');\r\n// private texSolid = new TextureLoader().load('solid.png');\r\n// private texSharp = new TextureLoader().load('particles/0.png');\r\n// private texBlur = new TextureLoader().load('particles/1.png');\r\nvar DOFPointsMaterialCOUNT = 0;\r\nconst DEBUG_DOF = false;\r\n\r\nexport class DOFPointsMaterial extends ShaderMaterial {\r\n\tpublic static texCircleSolid: Texture;\r\n\tpublic static texCircleAlpha: Texture;\r\n\r\n\tconstructor(params: IDofParams, gui: any = null, guiName: string = '') {\r\n\t\tvar dofParams: IDofParams = {\r\n\t\t\tfocusNear: 9.14,\r\n\t\t\tfocusFar: 11.34,\r\n\t\t\tfocusFadeOutLength: 1.0,\r\n\t\t\tmaxBlur: 0.34,\r\n\t\t\tminBlur: 0.14,\r\n\t\t\tminOpacity: 0.02,\r\n\t\t\tmaxOpacity: 0.8,\r\n\t\t\tuseFocusCenter: false,\r\n\t\t\tfocusCenter: 8,\r\n\t\t\tfocusLength: 4,\r\n\t\t\tradiusScaleFactor: 1\r\n\t\t};\r\n\r\n\t\tif (params) {\r\n\t\t\tdofParams = { ...dofParams, ...params };\r\n\t\t}\r\n\r\n\t\tlet uniforms = {\r\n\t\t\tviewport: { value: GlobalsLanding.RENDERER_HEIGHT / 1000 },\r\n\t\t\tPIXEL_RATIO: { value: GlobalsLanding.RENDERER_PIXEL_RATIO },\r\n\t\t\tfocusNear: { value: dofParams.focusNear },\r\n\t\t\tfocusFar: { value: dofParams.focusFar },\r\n\t\t\tfocusFadeOutLength: { value: dofParams.focusFadeOutLength },\r\n\t\t\tmaxBlur: { value: dofParams.maxBlur },\r\n\t\t\tminBlur: { value: dofParams.minBlur },\r\n\t\t\tradiusScaleFactor: { value: dofParams.radiusScaleFactor },\r\n\t\t\tminOpacity: { value: dofParams.minOpacity },\r\n\t\t\tmaxOpacity: { value: dofParams.maxOpacity },\r\n\t\t\tcolor: { value: new Color(0xffffff) },\r\n\t\t\tpointTexture: { value: DOFPointsMaterial.texCircleSolid },\r\n\t\t\tpointTextureAlpha: { value: DOFPointsMaterial.texCircleAlpha }\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('resize', () => {\r\n\t\t\tuniforms.viewport.value = GlobalsLanding.RENDERER_HEIGHT / 1000;\r\n\t\t});\r\n\r\n\t\tsuper({\r\n\t\t\tuniforms: uniforms,\r\n\t\t\tdepthWrite: false,\r\n\t\t\t// language=GLSL\r\n\t\t\tvertexShader: `attribute float size;\r\n            attribute vec3 customColor;\r\n\r\n            varying vec3 vColor;\r\n            varying float vAlpha;\r\n//            varying float vBlur;\r\n            uniform float focusNear;\r\n            uniform float PIXEL_RATIO;\r\n            uniform float focusFar;\r\n            uniform float maxBlur;\r\n            uniform float minBlur;\r\n            uniform float minOpacity;\r\n            uniform float maxOpacity;\r\n            uniform float focusFadeOutLength;\r\n            uniform float viewport;\r\n            uniform float radiusScaleFactor;\r\n\r\n            void main() {\r\n\r\n                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n\r\n                //float sizeCalc = smoothstep(focusNear, focusFar, -mvPosition.z);\r\n                float sizeCalc = 1.0;\r\n\r\n                if (-mvPosition.z < focusNear) {\r\n                    sizeCalc = smoothstep(focusNear - focusFadeOutLength, focusNear, -mvPosition.z);\r\n                    //                    sizeCalc = 0.0;\r\n                }\r\n                if (-mvPosition.z > focusFar) {\r\n                    sizeCalc = smoothstep(focusFar + focusFadeOutLength, focusFar, -mvPosition.z);\r\n                }\r\n                //\t\t\t\tgl_PointSize = size * ( focusNear / -mvPosition.z );\r\n                //                gl_PointSize = size;\r\n                sizeCalc = 1.0 - sizeCalc;\r\n                //gl_PointSize = size;\r\n\r\n                //                gl_PointSize *= ( scale / - mvPosition.z );\r\n                //                gl_PointSize = (size * minBlur + (size * maxBlur * sizeCalc));\r\n                //                vAlpha = clamp(sin(1.0 - ( focusNear / -mvPosition.z )), 0.05, 1.0);\r\n                vAlpha = min(max((1.0 - sizeCalc) * maxOpacity, minOpacity), maxOpacity);\r\n//                vAlpha = clamp(minOpacity, maxOpacity, (1.0 - sizeCalc) * maxOpacity); //Clamp has a bug in safari and iOS\r\n//                vBlur = 1.0 - sizeCalc;\r\n//                vBlur = 1.0;\r\n                if (vAlpha < 0.0001) {\r\n                    //This makes the GPU cull the vertex, increasing performance for non-visibe points:\r\n                    gl_PointSize = 0.0;\r\n                    gl_Position.z = 0.0;\r\n                } else {\r\n                    gl_PointSize = (viewport * (size * PIXEL_RATIO * minBlur + (size * PIXEL_RATIO * maxBlur * sizeCalc))) * radiusScaleFactor;\r\n                    gl_Position = projectionMatrix * mvPosition;\r\n                    vColor = customColor;\r\n                }\r\n                ${\r\n\t\t\t\t\tDEBUG_DOF\r\n\t\t\t\t\t\t? `\r\n                gl_PointSize = 3.0;\r\n                gl_Position = projectionMatrix * mvPosition;\r\n                vAlpha = 1.0;`\r\n\t\t\t\t\t\t: ''\r\n\t\t\t\t};\r\n\r\n            }`,\r\n\t\t\t// language=GLSL\r\n\t\t\tfragmentShader: `\r\n                uniform vec3 color;\r\n                uniform sampler2D pointTexture;\r\n                uniform sampler2D pointTextureAlpha;\r\n\r\n                varying vec3 vColor;\r\n                varying float vAlpha;\r\n//                varying float vBlur;\r\n\r\n                //            vec4 mapTexelToLinear( vec4 value ) { return LinearToLinear( value) ; }\r\n                void main() {\r\n                    /*\r\n                                    if(vAlpha == 0.0) {\r\n                                        discard;\r\n                                    }*/\r\n\r\n                    vec4 tColor = texture2D(pointTexture, gl_PointCoord);\r\n                    vec4 tColorAlpha = texture2D(pointTextureAlpha, gl_PointCoord);\r\n\r\n                    //gl_FragColor = vec4(color * vColor / tColor.a, mix(tColorAlpha.a, tColor.a, vAlpha) * vAlpha) * tColor;\r\n\r\n                    //Equation from: http://eelpi.gotdns.org/blog.wiki.html [Premultiplied alpha]\r\n                    tColor.rgb = tColor.rgb + tColor.rgb * (1.0 - tColor.a);\r\n                    tColorAlpha.rgb = tColorAlpha.rgb + tColorAlpha.rgb * (1.0 - tColorAlpha.a);\r\n//                    gl_FragColor = vec4(vColor, mix(tColorAlpha.a, tColor.a, vBlur) * vAlpha);\r\n                    gl_FragColor = vec4(vColor, mix(tColorAlpha.a, tColor.a, vAlpha) * vAlpha);\r\n\r\n                }`,\r\n\t\t\ttransparent: true\r\n\t\t});\r\n\t\tthis.dofParams = dofParams;\r\n\t\tif (gui) {\r\n\t\t\tDOFPointsMaterialCOUNT++;\r\n\t\t\tlet BokehFolder = gui.addFolder('DOFPointsMaterial ' + guiName + DOFPointsMaterialCOUNT);\r\n\r\n\t\t\tBokehFolder.add(this.dofParams, 'focusNear')\r\n\t\t\t\t.min(0.01)\r\n\t\t\t\t.max(200.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.focusNear.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'focusFar')\r\n\t\t\t\t.min(0.01)\r\n\t\t\t\t.max(200.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.focusFar.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'focusFadeOutLength')\r\n\t\t\t\t.min(0.01)\r\n\t\t\t\t.max(100.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.focusFadeOutLength.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'minBlur')\r\n\t\t\t\t.min(0.001)\r\n\t\t\t\t.max(2.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.minBlur.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'maxBlur')\r\n\t\t\t\t.min(0.1)\r\n\t\t\t\t.max(2.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.maxBlur.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'minOpacity')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.minOpacity.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'radiusScaleFactor')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1000.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.radiusScaleFactor.value = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'maxOpacity')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(1.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.uniforms.maxOpacity.value = value;\r\n\t\t\t\t});\r\n\r\n\t\t\tBokehFolder.add(this.dofParams, 'useFocusCenter').onChange(value => {\r\n\t\t\t\tthis.dofParams.useFocusCenter = value;\r\n\t\t\t\tthis.updateFocusCenter();\r\n\t\t\t});\r\n\r\n\t\t\tBokehFolder.add(this.dofParams, 'focusCenter')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(30.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.focusCenter = value;\r\n\t\t\t\t});\r\n\t\t\tBokehFolder.add(this.dofParams, 'focusLength')\r\n\t\t\t\t.min(0.0)\r\n\t\t\t\t.max(100.0)\r\n\t\t\t\t.step(0.001)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.focusLength = value;\r\n\t\t\t\t});\r\n\t\t\t// BokehFolder.open(true);\r\n\t\t}\r\n\t\tthis.updateFocusCenter();\r\n\t}\r\n\r\n\tprivate dofParams: IDofParams;\r\n\r\n\tprivate updateFocusCenter() {\r\n\t\tif (this.dofParams.useFocusCenter) {\r\n\t\t\tthis.uniforms.focusNear.value = this.dofParams.focusCenter - this.dofParams.focusLength * 0.5;\r\n\t\t\tthis.uniforms.focusFar.value = this.dofParams.focusCenter + this.dofParams.focusLength * 0.5;\r\n\t\t} else {\r\n\t\t\tthis.uniforms.focusNear.value = this.dofParams.focusNear;\r\n\t\t\tthis.uniforms.focusFar.value = this.dofParams.focusFar;\r\n\t\t}\r\n\t}\r\n\r\n\tget focusCenter(): number {\r\n\t\treturn this.dofParams.focusCenter;\r\n\t}\r\n\r\n\tset focusCenter(value: number) {\r\n\t\tthis.dofParams.focusCenter = value;\r\n\t\tthis.updateFocusCenter();\r\n\t}\r\n\r\n\tget focusLength(): number {\r\n\t\treturn this.dofParams.focusLength;\r\n\t}\r\n\r\n\tset focusLength(value: number) {\r\n\t\tthis.dofParams.focusLength = value;\r\n\t\tthis.updateFocusCenter();\r\n\t}\r\n}\r\n","import { BufferAttribute, BufferGeometry, Color, Float32BufferAttribute, Mesh, Object3D, Points, Scene, Texture, Vector3 } from 'three';\r\nimport { DOFPointsMaterial, IDofParams } from './materials/DOFPointsMaterial';\r\nimport { GlobalsLanding } from '../utils/GlobalsLanding';\r\n\r\nexport class UIRing {\r\n\tprivate geometry = new BufferGeometry();\r\n\tpublic material: DOFPointsMaterial;\r\n\tpublic points: Points<BufferGeometry, DOFPointsMaterial>;\r\n\r\n\tconstructor(\r\n\t\tcontainer: Object3D,\r\n\t\tradius = 0.01,\r\n\t\tsegments = 8,\r\n\t\tthetaStart = 0,\r\n\t\tthetaLength = Math.PI * 2,\r\n\t\tgui?: any,\r\n\t\tname = 'ring',\r\n\t\tcolor = new Color(0x080202),\r\n\t\tparams: IDofParams = null,\r\n\t\tmaterial: DOFPointsMaterial = null\r\n\t) {\r\n\t\tthis.buildGeometry(radius, segments, thetaStart, thetaLength, color);\r\n\t\tif (material) {\r\n\t\t\tthis.material = material;\r\n\t\t} else {\r\n\t\t\tif (name === 'poi ring') {\r\n\t\t\t\tthis.material = new DOFPointsMaterial(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfocusNear: 10,\r\n\t\t\t\t\t\tfocusFar: 40,\r\n\t\t\t\t\t\tfocusFadeOutLength: 50,\r\n\t\t\t\t\t\tminBlur: 0.07,\r\n\t\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\t\tmaxOpacity: 0.8,\r\n\t\t\t\t\t\tmaxBlur: 0.2\r\n\t\t\t\t\t},\r\n\t\t\t\t\tgui,\r\n\t\t\t\t\tname\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthis.material = new DOFPointsMaterial(\r\n\t\t\t\t\tparams\r\n\t\t\t\t\t\t? params\r\n\t\t\t\t\t\t: {\r\n\t\t\t\t\t\t\t\tfocusNear: 30,\r\n\t\t\t\t\t\t\t\tfocusFar: 60,\r\n\t\t\t\t\t\t\t\tfocusFadeOutLength: 50,\r\n\t\t\t\t\t\t\t\tminBlur: 0.1,\r\n\t\t\t\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\t\t\t\tmaxOpacity: 0.55,\r\n\t\t\t\t\t\t\t\tmaxBlur: 0.11\r\n\t\t\t\t\t\t  },\r\n\t\t\t\t\tgui,\r\n\t\t\t\t\tname\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.points = new Points(this.geometry, this.material);\r\n\t\tcontainer.add(this.points);\r\n\t}\r\n\r\n\tprivate buildGeometry(radius: number, segments: number, thetaStart: number, thetaLength: number, color: Color) {\r\n\t\tsegments = Math.max(3, segments);\r\n\r\n\t\tconst vertex = new Vector3();\r\n\t\tconst indices = [];\r\n\r\n\t\tconst vertices = [];\r\n\t\tconst sizes = new Float32Array(segments);\r\n\t\tconst colors = [];\r\n\r\n\t\tfor (let s = 0; s < segments; s++) {\r\n\t\t\tconst segment = thetaStart + (s / segments) * thetaLength;\r\n\t\t\t// const segment = s;\r\n\r\n\t\t\t// vertex\r\n\t\t\tvertex.x = radius * Math.cos(segment);\r\n\t\t\tvertex.y = radius * Math.sin(segment);\r\n\r\n\t\t\tvertices.push(vertex.x, vertex.y, vertex.z);\r\n\t\t\tcolors.push(color.r, color.g, color.b);\r\n\t\t\tsizes[s] = 0.5 * 100;\r\n\t\t}\r\n\r\n\t\t// build geometry\r\n\r\n\t\tthis.geometry.setAttribute('customColor', new Float32BufferAttribute(colors, 3));\r\n\t\tthis.geometry.setAttribute('position', new Float32BufferAttribute(vertices, 3));\r\n\t\tthis.geometry.setAttribute('size', new BufferAttribute(sizes, 1));\r\n\t\tthis.geometry.computeBoundingSphere();\r\n\t}\r\n}\r\n","import { GLTF } from 'three/examples/jsm/loaders/GLTFLoader';\r\nimport { BufferGeometry, Color, Group, Mesh, MeshBasicMaterial, MeshStandardMaterial, Object3D, PointLight, Points, SphereBufferGeometry, Texture } from 'three';\r\nimport { PostEffects } from './PostEffects';\r\n\r\nimport { UIRing } from './UIRing';\r\nimport { gsap } from 'gsap';\r\nimport { PointCloud } from './PointCloud';\r\nimport { DOFPointsMaterial } from './materials/DOFPointsMaterial';\r\nimport { LoadManager } from '../utils/LoadManager';\r\n\r\nexport class Eye {\r\n\tprivate group = new Object3D();\r\n\tprivate pointCloudContainer = new Object3D();\r\n\tprivate ringsGroup = new Group();\r\n\tprivate rings: UIRing[] = [];\r\n\tprivate menu: any;\r\n\tprivate pointCloud: PointCloud;\r\n\tprivate sun: Mesh<SphereBufferGeometry, MeshBasicMaterial>;\r\n\tprivate eye: Mesh;\r\n\tprivate godraysEffect: any;\r\n\tprivate postEffects: PostEffects;\r\n\tprivate texture: Texture;\r\n\tprivate pointCloudBelt: Points<BufferGeometry, DOFPointsMaterial>;\r\n\r\n\tconstructor(container: Object3D, postEffects: PostEffects, menu: any, loadManager: LoadManager) {\r\n\t\tthis.postEffects = postEffects;\r\n\t\tthis.menu = menu;\r\n\r\n\t\t// this.pointCloud = new PointCloud(this.pointCloudContainer, this.texCircleSolid, this.texCircleAlpha, this.menu);\r\n\r\n\t\t// Sun\r\n\r\n\t\tvar color = new Color(0xeac0ae).convertSRGBToLinear();\r\n\t\tconst mainLight = new PointLight(color);\r\n\t\tmainLight.position.set(0.36, -2.454, 0);\r\n\r\n\t\tconst sunMaterial = new MeshBasicMaterial({\r\n\t\t\tcolor: color,\r\n\t\t\ttransparent: true,\r\n\t\t\tfog: false\r\n\t\t});\r\n\r\n\t\tconst sunGeometry = new SphereBufferGeometry(1.5, 32, 32);\r\n\t\tthis.sun = new Mesh(sunGeometry, sunMaterial);\r\n\t\tthis.sun.position.copy(mainLight.position);\r\n\t\tthis.sun.updateMatrix();\r\n\t\tthis.sun.frustumCulled = false;\r\n\t\tthis.sun.matrixAutoUpdate = false;\r\n\t\tthis.sun.name = 'sun';\r\n\r\n\t\t// this.group.position.copy(mainLight.position);\r\n\t\tthis.group.add(this.pointCloudContainer);\r\n\t\tthis.group.add(this.ringsGroup);\r\n\t\tthis.group.add(this.sun);\r\n\r\n\t\tthis.godraysEffect = postEffects.setupGodRaysAndSmaa(this.sun, mainLight);\r\n\t\tcontainer.add(this.group);\r\n\r\n\t\t//this.texture = loadManager.loadTexture(checkWebP('eye_texture.webp', '.jpg'));\r\n\t\tthis.texture = loadManager.loadTexture('eye_texture.jpg');\r\n\t\tloadManager.loadGLTF('eye_singular.glb', this.eyeGeometryLoaded);\r\n\t\tloadManager.addLoadItem({ path: 'particles/eye.drc', name: 'eye_particles', doneCallback: this.setupGeometry });\r\n\t}\r\n\r\n\tpublic eyeGeometryLoaded = (gltf: GLTF) => {\r\n\t\tthis.createRings();\r\n\t\tthis.eye = gltf.scene.children[0] as Mesh;\r\n\t\tthis.eye.name = 'eye';\r\n\t\tthis.group.add(this.eye);\r\n\t\t// this.eye.scale.set(0.1, 0.1, 0.1);\r\n\r\n\t\t/*                this.group.rotation.x = -0.861;\r\n                        this.group.rotation.y = -0.51;\r\n                        this.group.rotation.z = 0.28;\r\n                        this.group.position.x = -0.11;\r\n                        this.group.position.y = 0.83;\r\n                        this.group.position.z = -300;*/\r\n\r\n\t\tthis.group.rotation.x = -0.961;\r\n\t\tthis.group.rotation.y = -0.08;\r\n\t\tthis.group.rotation.z = 0.2;\r\n\t\tthis.group.position.x = -0.11;\r\n\t\tthis.group.position.y = 0.83;\r\n\t\tthis.group.position.z = -298;\r\n\r\n\t\t// this.eye.geometry.computeVertexNormals();\r\n\t\tthis.eye.material = new MeshStandardMaterial({\r\n\t\t\tmetalness: 0.12,\r\n\t\t\troughness: 0.55,\r\n\t\t\tcolor: 0x7889cd,\r\n\t\t\ttransparent: true,\r\n\t\t\topacity: 0.97,\r\n\t\t\tmap: this.texture,\r\n\t\t\tflatShading: false\r\n\t\t});\r\n\t\tthis.texture.center.x = 0.5;\r\n\t\tthis.texture.center.y = 0.5;\r\n\t\tthis.texture.repeat.set(4, 4);\r\n\r\n\t\tif (this.menu) {\r\n\t\t\tthis.menu\r\n\t\t\t\t.add(this.texture.repeat, 'x')\r\n\t\t\t\t.min(1.0)\r\n\t\t\t\t.max(10.0)\r\n\t\t\t\t.step(0.01)\r\n\t\t\t\t.onChange(value => {\r\n\t\t\t\t\tthis.texture.repeat.x = value;\r\n\t\t\t\t\tthis.texture.repeat.y = value;\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tgsap.to(this.texture, { rotation: -Math.PI * 2, ease: 'none', repeat: -1, duration: 200 });\r\n\t\tvar mat = this.eye.material as MeshStandardMaterial;\r\n\t\t// mat.map = this.texture;\r\n\t};\r\n\r\n\tprivate setupGeometry = (geometry: THREE.BufferGeometry, path: string, name: string) => {\r\n\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t{\r\n\t\t\t\tuseFocusCenter: true,\r\n\t\t\t\tfocusLength: 12.58,\r\n\t\t\t\tfocusCenter: 15.023,\r\n\t\t\t\tfocusFadeOutLength: 6,\r\n\t\t\t\tminOpacity: 0,\r\n\t\t\t\tmaxOpacity: 0.534,\r\n\t\t\t\tmaxBlur: 0.15,\r\n\t\t\t\tminBlur: 0.05,\r\n\t\t\t\tradiusScaleFactor: 0.006\r\n\t\t\t},\r\n\t\t\tthis.menu,\r\n\t\t\tname\r\n\t\t);\r\n\t\tthis.pointCloudBelt = new Points(geometry, material);\r\n\t\tthis.pointCloudBelt.renderOrder = 1;\r\n\t\tthis.pointCloudBelt.scale.set(0.001, 0.001, 0.001);\r\n\t\tthis.group.add(this.pointCloudBelt);\r\n\t\tgsap.to(this.pointCloudBelt.rotation, { y: Math.PI * 2, repeat: -1, yoyo: false, ease: 'none', duration: 200 });\r\n\t\tthis.pointCloudBelt.name = name;\r\n\t};\r\n\r\n\tpublic getIntroAnimation(duration: number = 6) {\r\n\t\tconst tl = gsap.timeline();\r\n\t\ttl.fromTo(\r\n\t\t\tthis.sun.position,\r\n\t\t\t{ x: -0.5, y: -0.72 },\r\n\t\t\t{\r\n\t\t\t\tx: this.sun.position.x,\r\n\t\t\t\ty: this.sun.position.y,\r\n\t\t\t\tduration,\r\n\t\t\t\tonUpdate: () => this.sun.updateMatrix()\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\t// tl.from(this.group.rotation, {x: -Math.PI * 0.5, duration:duration * 0.5, ease: 'power3.inOut'}, 0);\r\n\t\t// tl.from(this.group.rotation, {y: 0.5, duration:duration * 0.5, ease: 'power3.inOut'}, 0);\r\n\t\t// tl.from(this.group.rotation, {z: -0.18, duration:duration * 0.5, ease: 'power3.inOut'}, 0);\r\n\t\ttl.from(this.godraysEffect.godRaysMaterial.uniforms.weight, { value: 1, duration: 1, ease: 'power3.inOut' }, 0);\r\n\t\ttl.from(this.godraysEffect.godRaysMaterial.uniforms.exposure, { value: 1, duration: 1, ease: 'power3.inOut' }, 0);\r\n\t\ttl.from(this.godraysEffect.godRaysMaterial.uniforms.decay, { value: 1, duration: 1, ease: 'power3.inOut' }, 0);\r\n\t\treturn tl;\r\n\t}\r\n\r\n\tpublic getScrollInAnimation(duration: number = 4) {\r\n\t\tconst tl = gsap.timeline({ paused: false });\r\n\t\t// tl.to(this.sun.position, {x: -0.5, y: 0.36, z: 0.5, duration, onUpdate: () => this.sun.updateMatrix()}, 0);\r\n\t\ttl.to(this.group.position, { y: 0, x: 0, duration, ease: 'sine.inOut' }, 0);\r\n\t\ttl.to(this.group.position, { z: '-=5.5', duration: duration * 1.2, ease: 'power4.inOut' }, 0);\r\n\t\ttl.to(this.group.rotation, { x: -Math.PI * 0.5, duration, ease: 'sine.inOut' }, 0);\r\n\t\ttl.to(this.group.rotation, { y: 1, duration: duration * 1.2, ease: 'sine.inOut' }, 0);\r\n\t\ttl.to(this.group.rotation, { z: -0.18, duration, ease: 'sine.inOut' }, 0);\r\n\t\ttl.to(this.texture.repeat, { x: 7.5, y: 7.5, duration: duration * 1.2, ease: 'power4.inOut' }, 0);\r\n\t\t// tl.to(this.group.rotation, {z: '-=.5', duration, ease: 'sine.inOut'}, 0);\r\n\t\t// tl.to(this.group.rotation, {y: '+=.9', duration, ease: 'sine.inOut'}, 0);\r\n\t\ttl.to(this.pointCloudContainer.rotation, { x: -0.5, duration, ease: 'sine.inOut' }, 0);\r\n\t\t// tl.to(this.pointCloud.material.uniforms.maxOpacity, {value: 0, duration: 0.05, ease: 'sine.out'}, 0.2);\r\n\r\n\t\t//Fade out:\r\n\t\tvar fadeOutLength = duration * 0.2;\r\n\t\tvar tl2 = gsap.timeline({ delay: 1.5 });\r\n\t\ttl2.to(this.pointCloudBelt.material.uniforms.maxOpacity, { value: 0, duration: duration * 0.05, ease: 'sine.out' }, duration * 0.2);\r\n\t\ttl2.to(this.godraysEffect.godRaysMaterial.uniforms.weight, { value: 1, duration: fadeOutLength, ease: 'sine.out' }, duration * 0.2);\r\n\t\ttl2.to(this.godraysEffect.godRaysMaterial.uniforms.exposure, { value: 1, duration: fadeOutLength, ease: 'sine.out' }, duration * 0.2);\r\n\t\ttl2.to(this.godraysEffect.godRaysMaterial.uniforms.decay, { value: 1, duration: fadeOutLength, ease: 'sine.out' }, duration * 0.2);\r\n\r\n\t\ttl2.to(this.eye.material, { opacity: 0, duration: duration * 0.2, ease: 'power3.inOut' }, duration * 0.25);\r\n\t\ttl2.to(this.sun.material, { opacity: 0, duration: duration * 0.4, ease: 'power3.inOut' }, duration * 0.25);\r\n\t\ttl2.to(this.group.position, { z: '+=90', duration: duration * 0.6, ease: 'power4.inOut' }, duration * 0.25);\r\n\t\t// tl2.set(this.postEffects, {godRaysEnabled: false}, duration * 0.65);\r\n\t\ttl2.set(this.eye, { visible: false }, duration * 0.45);\r\n\t\t// tl2.set(this.sun, {visible: false}, duration * 0.65);\r\n\t\ttl2.set(this.ringsGroup, { visible: false }, duration * 0.25);\r\n\t\t// tl2.to(this.godraysEffect.blendMode.opacity, {value: 0, duration: duration * 0.05, ease: 'sine.out'}, duration * 0.25);\r\n\t\treturn [tl, tl2];\r\n\t}\r\n\r\n\tprivate createRings() {\r\n\t\tvar color = new Color(0xffffff);\r\n\t\tvar params = {\r\n\t\t\tminBlur: 0.05,\r\n\t\t\tmaxBlur: 0.1,\r\n\t\t\tminOpacity: 1,\r\n\t\t\tfocusFadeOutLength: 7.77,\r\n\t\t\tfocusFar: 13.11,\r\n\t\t\tfocusNear: 8.7,\r\n\t\t\tmaxOpacity: 1\r\n\t\t};\r\n\t\tvar dotCount = 40;\r\n\t\tthis.rings.push(new UIRing(this.ringsGroup, 2.93, Math.round(2.93 * dotCount), 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\t// this.rings.push(new UIRing(this.ringsGroup, 3.5, Math.round(3.5 * dotCount), 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\tthis.rings.push(new UIRing(this.ringsGroup, 4.1, Math.round(4.1 * dotCount), 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\t// this.rings.push(new UIRing(this.ringsGroup, 4.7, Math.round(4.7 * dotCount), 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\tthis.rings.push(new UIRing(this.ringsGroup, 5.4, Math.round(5.6 * dotCount), 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\tthis.rings.push(new UIRing(this.ringsGroup, 7.0, Math.round(7.0 * dotCount), 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\t// this.rings.push(new UIRing(this.group, this.texCircleSolid, this.texCircleAlpha, 600, 100, 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\t// this.rings.push(new UIRing(this.group, this.texCircleSolid, this.texCircleAlpha, 700, 100, 0, Math.PI * 2, this.menu, 'eye ring', color, params));\r\n\t\tvar offset = 0.05;\r\n\t\tthis.rings[0].points.position.y = offset - 0.05;\r\n\t\t// this.rings[1].points.position.y = offset + 0.4;\r\n\t\tthis.rings[1].points.position.y = offset + 0.6;\r\n\t\t// this.rings[3].points.position.y = offset + 0.75;\r\n\t\tthis.rings[2].points.position.y = offset + 0.75;\r\n\t\tthis.rings[3].points.position.y = offset + 0.8;\r\n\t\t// this.rings[4].points.position.y = offset + 10;\r\n\t\t/*        this.rings[0].points.rotation.x = Math.PI * 2;\r\n                this.rings[1].points.rotation.x = Math.PI * 2;\r\n                this.rings[2].points.rotation.x = Math.PI * 2;\r\n                this.rings[3].points.rotation.x = Math.PI * 2;\r\n                this.rings[4].points.rotation.x = Math.PI * 2;*/\r\n\t\tthis.rings.forEach((ring, index) => {\r\n\t\t\tring.points.rotation.x = -Math.PI * 0.5;\r\n\t\t\tgsap.to(ring.points.rotation, { z: Math.PI, duration: 50 + index * 10, repeat: -1, ease: 'none' });\r\n\t\t});\r\n\t}\r\n}\r\n","import { MouseMoveTracker } from '../utils/MouseMoveTracker';\r\nimport { gsap } from 'gsap';\r\n\r\nexport class LandingMouseEnter {\r\n\tprivate target: HTMLElement;\r\n\tprivate MouseMoveTracker: MouseMoveTracker;\r\n\r\n\tprivate speed: number;\r\n\tprivate pos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };\r\n\tprivate mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };\r\n\tprivate hitArea: Element;\r\n\tprivate bounds: DOMRect;\r\n\tprivate resetTween: gsap.core.Tween = null;\r\n\r\n\tconstructor(MouseMoveTracker: MouseMoveTracker, target: HTMLElement, speed = 0.2, hitArea: Element) {\r\n\t\tthis.MouseMoveTracker = MouseMoveTracker;\r\n\t\tthis.target = target;\r\n\t\tthis.speed = speed;\r\n\t\tthis.hitArea = hitArea;\r\n\r\n\t\tconst initSpeed = speed;\r\n\t\tthis.onWindowResize();\r\n\t\tgsap.ticker.add(this.raf);\r\n\t\twindow.addEventListener('resize', this.onWindowResize);\r\n\t}\r\n\r\n\tprivate raf = () => {\r\n\t\tconst xSet = gsap.quickSetter(this.target, 'x', 'px');\r\n\t\tconst ySet = gsap.quickSetter(this.target, 'y', 'px');\r\n\r\n\t\tconst dt = 1.0 - Math.pow(1.0 - this.speed, gsap.ticker.deltaRatio());\r\n\r\n\t\tif (\r\n\t\t\tthis.MouseMoveTracker.mouse.originX >= this.bounds.left &&\r\n\t\t\tthis.MouseMoveTracker.mouse.originX <= this.bounds.right &&\r\n\t\t\tthis.MouseMoveTracker.mouse.originY >= this.bounds.top &&\r\n\t\t\tthis.MouseMoveTracker.mouse.originY <= this.bounds.bottom\r\n\t\t) {\r\n\t\t\tthis.mouse.x = this.MouseMoveTracker.mouse.x;\r\n\t\t\tthis.mouse.y = this.MouseMoveTracker.mouse.y;\r\n\t\t\tif (this.resetTween) {\r\n\t\t\t\tthis.resetTween.kill();\r\n\t\t\t\tthis.resetTween = null;\r\n\t\t\t}\r\n\t\t\t// console.log('within bounds');\r\n\t\t} else {\r\n\t\t\t// this.speed = 0.05;\r\n\t\t\tif (this.resetTween === null) {\r\n\t\t\t\tthis.resetTween = gsap.to(this.mouse, { x: 0, y: 0, duration: 0.4 });\r\n\t\t\t}\r\n\t\t\t// console.log('out of bounds', MouseMoveTracker.mouse.topX, MouseMoveTracker.mouse.topY);\r\n\t\t}\r\n\r\n\t\tthis.pos.x += (this.mouse.x - this.pos.x) * dt;\r\n\t\tthis.pos.y += (this.mouse.y - this.pos.y) * dt;\r\n\t\txSet(this.pos.x);\r\n\t\tySet(this.pos.y);\r\n\t};\r\n\r\n\tprivate onWindowResize = () => {\r\n\t\tthis.bounds = this.hitArea.getBoundingClientRect();\r\n\t};\r\n\r\n\tenable = () => {\r\n\t\tgsap.to(this.target, { opacity: 1, duration: 1 });\r\n\t};\r\n\r\n\tdisable = () => {\r\n\t\tgsap.killTweensOf(this.target, 'opacity');\r\n\t\tgsap.to(this.target, { opacity: 0, duration: 0.15 });\r\n\t\tgsap.ticker.remove(this.raf);\r\n\t\twindow.removeEventListener('resize', this.onWindowResize);\r\n\t};\r\n}\r\n","import { Frustum, Matrix4, Object3D, PerspectiveCamera, Sphere, Vector3 } from 'three';\r\nimport { gsap } from 'gsap';\r\nimport { Gallery } from './Gallery';\r\nimport { MainScene } from './MainScene';\r\n\r\nexport class ExploreButton {\r\n\tprivate pos = new Vector3();\r\n\tpublic container = document.querySelector('.ExploreButton');\r\n\tprivate xSet = gsap.quickSetter(this.container, 'x', 'px');\r\n\tprivate ySet = gsap.quickSetter(this.container, 'y', 'px');\r\n\r\n\tprivate frustum = new Frustum();\r\n\tprivate matrix = new Matrix4();\r\n\tprivate sphere = new Sphere(this.pos, 6);\r\n\tprivate gallery: Gallery;\r\n\tprivate main: MainScene;\r\n\r\n\tconstructor(gallery: Gallery, main: MainScene) {\r\n\t\tthis.gallery = gallery;\r\n\t\tthis.main = main;\r\n\t\tgsap.set(this.container, { opacity: 0, force3D: true, visibility: 'visible' });\r\n\t\tthis.container.addEventListener('click', this.clickHandler);\r\n\t}\r\n\r\n\tupdateScreenPosition(object: Object3D, camera: PerspectiveCamera, widthHalf: number, heightHalf: number) {\r\n\t\tthis.matrix.copy(camera.projectionMatrix);\r\n\t\tthis.matrix.multiply(camera.matrixWorldInverse);\r\n\t\tthis.frustum.setFromProjectionMatrix(this.matrix);\r\n\t\tthis.pos = this.pos.setFromMatrixPosition(object.matrixWorld);\r\n\t\tif (this.frustum.intersectsSphere(this.sphere)) {\r\n\t\t\t// console.log('in front');\r\n\t\t\tthis.pos.project(camera);\r\n\t\t\tthis.pos.x = this.pos.x * widthHalf + widthHalf;\r\n\t\t\tthis.pos.y = -(this.pos.y * heightHalf) + heightHalf;\r\n\t\t\tthis.pos.z = 0;\r\n\t\t\tthis.xSet(this.pos.x);\r\n\t\t\tthis.ySet(this.pos.y);\r\n\t\t} else {\r\n\t\t\t// console.log('behind');\r\n\t\t\tthis.xSet(-1000);\r\n\t\t\tthis.ySet(-1000);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate clickHandler = (event: MouseEvent) => {\r\n\t\tevent.preventDefault();\r\n\t\tif (!this.gallery.visible) {\r\n\t\t\tthis.gallery.setGalleryItems(this.main.currentExploreChapter.galleryImages);\r\n\t\t\tthis.gallery.show();\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n}\r\n","import { BufferAttribute, Camera, Matrix4, Mesh, Points, Vector3 } from 'three';\r\n\r\nconst vector = new Vector3();\r\nconst matrix = new Matrix4();\r\nlet sortArray = [];\r\n\r\nfunction numericalSort(a, b) {\r\n\treturn b[0] - a[0];\r\n}\r\nexport function sortPoints(object: Points, camera: Camera) {\r\n\t// Model View Projection matrix\r\n\tmatrix.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);\r\n\tmatrix.multiply(object.matrixWorld);\r\n\r\n\tconst geometry = object.geometry;\r\n\r\n\tlet index = geometry.getIndex();\r\n\tconst positions = geometry.getAttribute('position').array;\r\n\tconst length = positions.length / 3;\r\n\r\n\tif (index === null) {\r\n\t\tconst array = new Float32Array(length);\r\n\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tarray[i] = i;\r\n\t\t}\r\n\r\n\t\tindex = new BufferAttribute(array, 1);\r\n\r\n\t\tgeometry.setIndex(index);\r\n\t}\r\n\r\n\tsortArray = [];\r\n\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tvector.fromArray(positions, i * 3);\r\n\t\tvector.applyMatrix4(matrix);\r\n\r\n\t\tsortArray.push([vector.z, i]);\r\n\t}\r\n\r\n\tsortArray.sort(numericalSort);\r\n\r\n\tconst indices = index.array as Array<any>;\r\n\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tindices[i] = sortArray[i][1];\r\n\t}\r\n\r\n\tgeometry.index.needsUpdate = true;\r\n}\r\n","import { gsap } from 'gsap';\r\nimport { SplitText } from 'gsap/SplitText';\r\n\r\nexport class ChapterIntro {\r\n\tpublic timeline = gsap.timeline({ paused: true });\r\n\r\n\tconstructor(container: HTMLDivElement) {\r\n\t\tgsap.registerPlugin(SplitText);\r\n\t\tvar title = container.querySelector('h1');\r\n\t\tvar title2 = container.querySelectorAll('h1')[1];\r\n\t\tvar split = new SplitText(title, { type: 'chars', charsClass: 'blurCharacter' });\r\n\t\tvar split2 = new SplitText(title2, { type: 'chars' });\r\n\r\n\t\tsplit.chars.forEach((char: HTMLDivElement) => {\r\n\t\t\tchar.innerHTML = `<span>${char.innerText}</span>`;\r\n\t\t});\r\n\t\tsplit2.chars.forEach((char: HTMLDivElement) => {\r\n\t\t\tchar.innerHTML = `<span>${char.innerText}</span>`;\r\n\t\t});\r\n\r\n\t\tgsap.set(split.chars, { opacity: 0, force3D: true });\r\n\t\t// gsap.set(title, { /*x: 50, y: 30, */ /*scaleX: 1.5,*/ opacity: 0, force3D: true });\r\n\t\tgsap.set(split2.chars, { /*x: 50, y: 30, */ /*scaleX: 1.5,*/ opacity: 1, force3D: true });\r\n\t\t// gsap.to(split.chars, { /*x: 0, y: 0,*//* filter: 'blur(15px)',*/ /*scaleX: 1.5,*/ opacity: 1, duration: 3, delay: 3, force3D: true, repeat: -1 });\r\n\t\tgsap.set(container, { visibility: 'hidden' });\r\n\t\tthis.timeline.set(container, { visibility: 'visible' }, 0);\r\n\t\tthis.timeline.to(container.querySelector('.ChapterIntro-lead'), { opacity: 0, force3D: true }, 0);\r\n\t\tthis.timeline.to(container.querySelector('.ChapterIntro-number'), { opacity: 0, force3D: true }, 0);\r\n\t\tthis.timeline.to(\r\n\t\t\tsplit.chars,\r\n\t\t\t{\r\n\t\t\t\tstagger: {\r\n\t\t\t\t\teach: 0.1,\r\n\t\t\t\t\tfrom: 'edges',\r\n\t\t\t\t\tgrid: 'auto',\r\n\t\t\t\t\tease: 'power2.inOut'\r\n\t\t\t\t},\r\n\t\t\t\topacity: 1,\r\n\t\t\t\tease: 'quad.inOut',\r\n\t\t\t\tduration: 0.5,\r\n\t\t\t\tforce3D: true\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.timeline.to(\r\n\t\t\tsplit.chars,\r\n\t\t\t{\r\n\t\t\t\tstagger: {\r\n\t\t\t\t\teach: 0.1,\r\n\t\t\t\t\tfrom: 'edges',\r\n\t\t\t\t\tgrid: 'auto',\r\n\t\t\t\t\tease: 'power2.inOut'\r\n\t\t\t\t},\r\n\t\t\t\topacity: 0,\r\n\t\t\t\tduration: 0.5,\r\n\t\t\t\tforce3D: true\r\n\t\t\t},\r\n\t\t\t0.5\r\n\t\t);\r\n\t\tthis.timeline.to(\r\n\t\t\tsplit2.chars,\r\n\t\t\t{\r\n\t\t\t\topacity: 0,\r\n\t\t\t\tstagger: {\r\n\t\t\t\t\teach: 0.1,\r\n\t\t\t\t\tfrom: 'edges',\r\n\t\t\t\t\tgrid: 'auto',\r\n\t\t\t\t\tease: 'power2.inOut'\r\n\t\t\t\t},\r\n\t\t\t\tduration: 0.5,\r\n\t\t\t\tease: 'quad.inOut',\r\n\t\t\t\tforce3D: true\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.timeline.fromTo(\r\n\t\t\tsplit.chars,\r\n\t\t\t{ x: 30, force3D: true },\r\n\t\t\t{\r\n\t\t\t\tx: 0,\r\n\t\t\t\tstagger: {\r\n\t\t\t\t\teach: 0.1,\r\n\t\t\t\t\tfrom: 'edges',\r\n\t\t\t\t\tgrid: 'auto',\r\n\t\t\t\t\tease: 'power2.inOut'\r\n\t\t\t\t},\r\n\t\t\t\tduration: 0.5,\r\n\t\t\t\tease: 'quad.inOut',\r\n\t\t\t\tforce3D: true\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.timeline.set(container, { visibility: 'hidden' });\r\n\t\t// this.timeline.to(title, {opacity: 0, duration: 1, force3D: true});\r\n\t}\r\n}\r\n","import { gsap } from 'gsap';\r\n\r\nexport class ChapterPOIText {\r\n\tpublic timeline: gsap.core.Timeline;\r\n\tconstructor(container: HTMLDivElement) {\r\n\t\tthis.timeline = gsap.timeline({ paused: true });\r\n\t\tthis.timeline.fromTo(container, { y: 80 }, { y: 0, ease: 'power3.out', duration: 0.35 }, 0);\r\n\t\tthis.timeline.to(container, { opacity: 1, ease: 'sine.out', duration: 0.2 }, 0);\r\n\t\tthis.timeline.to(container, { opacity: 0, ease: 'sine.out', duration: 0.2 }, 0.8);\r\n\t}\r\n}\r\n","import { BufferGeometry, Group, Mesh, MeshBasicMaterial, Object3D, PerspectiveCamera, Points, SphereBufferGeometry } from 'three';\r\nimport { DOFPointsMaterial } from '../../ui/materials/DOFPointsMaterial';\r\nimport { sortPoints } from '../../utils/SortPoints';\r\nimport { UIRing } from '../UIRing';\r\nimport { ExploreButton } from '../../ui/ExploreButton';\r\nimport { ChapterIntro } from '../../ui/ChapterIntro';\r\nimport { ChapterPOIText } from '../../ui/ChapterPOIText';\r\nimport { gsap } from 'gsap';\r\nimport { MainScene } from '../../ui/MainScene';\r\nimport { GlobalsLanding } from '../../utils/GlobalsLanding';\r\n\r\nexport interface IChapter {\r\n\tgetLoadItems(): Array<Array<string>>;\r\n\titemLoaded(geometry: BufferGeometry, path: string, name: string);\r\n}\r\nexport interface GalleryItem {\r\n\ttitle: string;\r\n\tdescription: string;\r\n\turl: string;\r\n}\r\nexport class Chapter implements IChapter {\r\n\tprotected menu: any;\r\n\tprotected sortPoints: Points[] = [];\r\n\tprotected chapterWrapper = new Object3D();\r\n\t// public exploreAnchor = new Mesh(new SphereBufferGeometry(0.1), new MeshBasicMaterial({color: 0xff2080}))\r\n\tpublic exploreAnchor = new Object3D();\r\n\r\n\tprotected camera: PerspectiveCamera;\r\n\tprotected mainGroup: Group;\r\n\tprotected cameraLookAtPoint: Object3D;\r\n\tpublic ringsMaterial: DOFPointsMaterial;\r\n\tpublic rings: UIRing[] = [];\r\n\tprotected exploreButton: ExploreButton;\r\n\tpublic chapterIntroClass: ChapterIntro;\r\n\tprotected chapterPOITitles: HTMLDivElement[];\r\n\tprotected currentChapterScrollProgress = 0;\r\n\tprotected chapterPOIs: ChapterPOIText[];\r\n\tpublic scrollTimeline: gsap.core.Timeline;\r\n\tprotected cameraWrapper: Object3D;\r\n\tprotected duration = 1;\r\n\tprotected scrollProgress = 0;\r\n\tpublic SCROLL_LENGTH = 10;\r\n\tpublic CHAPTER_DISTANCE = GlobalsLanding.CHAPTER_DISTANCE;\r\n\tpublic CHAPTER_OFFSET = 0;\r\n\tprotected main: MainScene;\r\n\tprotected index: number;\r\n\tpublic galleryImages: GalleryItem[] = [];\r\n\r\n\tconstructor(\r\n\t\tmenu: any,\r\n\t\tcamera: PerspectiveCamera,\r\n\t\tcameraWrapper: Object3D,\r\n\t\tmainGroup: Group,\r\n\t\tcameraLookAtPoint: Object3D,\r\n\t\texploreButton: ExploreButton,\r\n\t\tchapterIntro: HTMLDivElement,\r\n\t\tchapterPOITitles: HTMLDivElement[],\r\n\t\tindex: number,\r\n\t\tmain: MainScene,\r\n\t\texploreNavLink: HTMLAnchorElement\r\n\t) {\r\n\t\tconst titles = exploreNavLink.dataset.exploreTitles.split('|||');\r\n\t\tconst descriptions = exploreNavLink.dataset.exploreDescriptions.split('|||');\r\n\t\tthis.galleryImages = exploreNavLink.dataset.exploreImages.split('|||').map((url, index) => {\r\n\t\t\treturn { url: url, title: titles[index], description: descriptions[index] };\r\n\t\t});\r\n\r\n\t\tthis.index = index;\r\n\t\tthis.cameraWrapper = cameraWrapper;\r\n\t\tthis.menu = menu;\r\n\t\tthis.camera = camera;\r\n\t\tthis.mainGroup = mainGroup;\r\n\t\tthis.cameraLookAtPoint = cameraLookAtPoint;\r\n\t\tthis.exploreButton = exploreButton;\r\n\t\tthis.chapterPOITitles = chapterPOITitles;\r\n\t\tthis.main = main;\r\n\t\tthis.chapterWrapper.name = 'Chapter ' + index;\r\n\t\tthis.chapterWrapper.position.z = (index - 1) * this.CHAPTER_DISTANCE;\r\n\t\tthis.mainGroup.add(this.chapterWrapper);\r\n\t\tthis.ringsMaterial = new DOFPointsMaterial(\r\n\t\t\t{\r\n\t\t\t\tfocusNear: 0.01,\r\n\t\t\t\tfocusFar: 113,\r\n\t\t\t\tfocusFadeOutLength: 7,\r\n\t\t\t\tminBlur: 0.08,\r\n\t\t\t\tminOpacity: 0,\r\n\t\t\t\tmaxOpacity: 0.55,\r\n\t\t\t\tmaxBlur: 0.1\r\n\t\t\t},\r\n\t\t\tthis.menu,\r\n\t\t\t'rings'\r\n\t\t);\r\n\t\tthis.chapterIntroClass = new ChapterIntro(chapterIntro);\r\n\t\tthis.chapterIntroClass.timeline.progress(1);\r\n\t\tthis.chapterPOIs = this.chapterPOITitles.map(container => new ChapterPOIText(container));\r\n\r\n\t\tthis.scrollTimeline = gsap.timeline({ paused: true });\r\n\t\tthis.scrollTimeline.to(this, { currentChapterScrollProgress: 1, ease: 'none', duration: this.duration }, 0);\r\n\t}\r\n\r\n\tpublic loadDone() {\r\n\t\tthis.sortPointsData();\r\n\t}\r\n\r\n\tpublic sortPointsData() {\r\n\t\tthis.sortPoints.forEach(point => {\r\n\t\t\tsortPoints(point, this.camera);\r\n\t\t\tpoint.geometry = (point.geometry as BufferGeometry).toNonIndexed();\r\n\t\t});\r\n\t}\r\n\tpublic raf() {\r\n\t\tthis.sortPointsData();\r\n\t}\r\n\r\n\tpublic setupScrollTimeline = (): gsap.core.Timeline => {\r\n\t\treturn null;\r\n\t};\r\n\r\n\tprotected setActiveExploreItem = () => {\r\n\t\tif (this.main.currentExploreChapter !== this) {\r\n\t\t\tthis.main.currentExploreChapter = this;\r\n\t\t\tthis.main.activeExploreAnchor = this.exploreAnchor;\r\n\t\t}\r\n\t};\r\n\r\n\tgetLoadItems(): Array<Array<string>> {\r\n\t\treturn null;\r\n\t}\r\n\titemLoaded(geometry: BufferGeometry, path: string, name: string) {}\r\n}\r\n","import { gsap } from 'gsap';\r\nimport { GlobalsLanding } from '../utils/GlobalsLanding';\r\nexport class MakeChoice {\r\n\tpublic timeline: gsap.core.Timeline;\r\n\tprivate container: HTMLDivElement;\r\n\tprivate imagesComp: NodeListOf<HTMLElement>;\r\n\tprivate imagesSingular: NodeListOf<HTMLElement>;\r\n\tprivate svg: HTMLElement;\r\n\tprivate buttons: NodeListOf<HTMLElement>;\r\n\tprivate descriptions: NodeListOf<HTMLElement>;\r\n\tprivate descriptionWrapper: HTMLElement;\r\n\tprivate inTimeline: gsap.core.Timeline;\r\n\tprivate currHoverIndex = -1;\r\n\tprivate currImageHoverTimeline: gsap.core.Timeline;\r\n\tprivate centerWrapper: Element;\r\n\tprivate scrollIndicator: Element;\r\n\tprivate choiceText: Element;\r\n\tprivate scrollLine: Element;\r\n\tprivate scrollLineBG: Element;\r\n\tprivate scrollLineDiamond: Element;\r\n\tprivate exploreNav: Element;\r\n\tprivate index: number;\r\n\tconstructor(container: HTMLDivElement, index = 1) {\r\n\t\tthis.container = container;\r\n\t\tthis.index = index;\r\n\t\tthis.imagesComp = this.container.querySelectorAll('.MakeChoice-images .MakeChoice-imageComp');\r\n\t\tthis.imagesSingular = this.container.querySelectorAll('.MakeChoice-images .MakeChoice-imageSingular');\r\n\t\tthis.svg = this.container.querySelector('.MakeChoice-bgSVG');\r\n\t\tthis.buttons = this.container.querySelectorAll('.MakeChoice-button');\r\n\t\tthis.descriptions = this.container.querySelectorAll('.MakeChoice-description');\r\n\t\tthis.descriptionWrapper = this.container.querySelector('.MakeChoice-descriptions');\r\n\t\tthis.centerWrapper = this.container.querySelector('.MakeChoice-center');\r\n\t\tthis.scrollIndicator = this.container.querySelector('.MakeChoice-scrollIndicator');\r\n\t\tthis.choiceText = this.container.querySelector('.MakeChoice-text');\r\n\t\tthis.scrollLine = this.container.querySelector('.MakeChoice-scrollIndicator-line');\r\n\t\tthis.scrollLineBG = this.container.querySelector('.MakeChoice-scrollIndicator-lineBG');\r\n\t\tthis.scrollLineDiamond = this.container.querySelector('.MakeChoice-Diamond');\r\n\t\tthis.exploreNav = document.querySelector('.ExploreNav');\r\n\r\n\t\tthis.inTimeline = gsap.timeline({ paused: true });\r\n\t\tthis.inTimeline.fromTo(this.svg, { opacity: 0 }, { opacity: 1, duration: 1 }, 0);\r\n\t\tthis.inTimeline.fromTo(this.buttons, { opacity: 0 }, { opacity: 1, duration: 1 }, 0);\r\n\t\tthis.inTimeline.fromTo(this.imagesComp[0], { opacity: 0 }, { opacity: 1, duration: 0.6 }, 0);\r\n\t\tif (this.index === 2) {\r\n\t\t\tthis.inTimeline.fromTo(this.imagesComp[2], { yPercent: 2, xPercent: 15 }, { yPercent: 0, xPercent: 0, ease: 'power4.out', duration: 1.2 }, 0);\r\n\t\t\tthis.inTimeline.fromTo([this.imagesComp[2], this.imagesComp[1]], { opacity: 0 }, { opacity: 1, duration: 0.4 }, 0);\r\n\t\t\tthis.inTimeline.fromTo(this.imagesComp[0], { xPercent: 10, yPercent: 5 }, { xPercent: 0, yPercent: 0, ease: 'power4.out', duration: 1.5 }, 0);\r\n\t\t\tthis.inTimeline.fromTo(this.imagesComp[1], { yPercent: -4, xPercent: 20 }, { yPercent: 0, xPercent: 0, ease: 'power4.out', duration: 1.6 }, 0);\r\n\t\t} else {\r\n\t\t\tthis.inTimeline.fromTo(this.imagesComp[1], { xPercent: -10 }, { xPercent: 0, ease: 'power4.out', duration: 1.8 }, 0);\r\n\t\t\tthis.inTimeline.fromTo(this.imagesComp[0], { yPercent: 5 }, { yPercent: 0, duration: 1.2 }, 0);\r\n\t\t\tthis.inTimeline.fromTo([this.imagesComp[2], this.imagesComp[1]], { opacity: 0 }, { opacity: 1, duration: 0.4 }, 0);\r\n\t\t\tthis.inTimeline.fromTo(this.imagesComp[2], { xPercent: 10 }, { xPercent: 0, ease: 'power4.out', duration: 1.5 }, 0);\r\n\t\t}\r\n\t\tthis.inTimeline.set(this.buttons, { pointerEvents: 'auto' });\r\n\t\t// this.inTimeline.fromTo(this.buttons, {opacity: 0},{stagger: 0.2, opacity: 1, ease: 'power4.out', duration: 1.8}, 0);\r\n\r\n\t\tthis.timeline = gsap.timeline({ paused: true });\r\n\t\tconst duration = 1;\r\n\t\tthis.timeline.to(this.exploreNav, { opacity: 0, x: -100, duration: duration * 0.1 }, 0);\r\n\t\tvar offset = 0.2;\r\n\t\tthis.timeline.call(\r\n\t\t\t() => {\r\n\t\t\t\t// this.hideCurrentIndex();\r\n\t\t\t\t// gsap.killTweensOf(this.imagesComp, null, true);\r\n\t\t\t\tthis.mouseOut(-1, true);\r\n\t\t\t\tthis.inTimeline.pause(0);\r\n\t\t\t\tthis.inTimeline.render(0);\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\toffset + 0.1\r\n\t\t);\r\n\t\tthis.timeline.fromTo(this.centerWrapper, { opacity: 0 }, { opacity: 1, duration: 0.05 }, offset + 0.1);\r\n\t\tthis.timeline.fromTo(this.descriptionWrapper, { opacity: 0 }, { opacity: 1, duration: 0.05 }, offset + 0.1);\r\n\t\tthis.timeline.call(\r\n\t\t\t() => {\r\n\t\t\t\tthis.playIn();\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\toffset + 0.1\r\n\t\t);\r\n\t\tthis.timeline.fromTo(this.scrollIndicator, { opacity: 0, x: -80 }, { opacity: 1, x: 0, duration: duration * 0.1 }, offset + 0.05);\r\n\t\tthis.timeline.fromTo(this.choiceText, { opacity: 0 }, { opacity: 1, duration: duration * 0.12 }, offset + 0.05);\r\n\r\n\t\tthis.timeline.fromTo(this.choiceText, { x: () => (GlobalsLanding.MainScene.width >= 768 ? -80 : 0) }, { x: 0, duration: duration * 0.15 }, offset + 0.05);\r\n\r\n\t\tthis.timeline.fromTo(this.scrollLine, { scaleY: 0 }, { scaleY: 1, ease: 'none', duration: duration - (offset + 0.15 + 0.1) }, offset + 0.15);\r\n\r\n\t\tvar tl = gsap.timeline({ paused: true });\r\n\t\ttl.to(this.scrollLine, { scaleY: 0, yPercent: 100, duration: 0.9, ease: 'none' }, 0);\r\n\t\ttl.to(this.scrollLineBG, { scaleY: 0, yPercent: 100, duration: 0.9, ease: 'none' }, 0);\r\n\t\ttl.to(this.scrollLine, { y: 16, duration: 0.1, ease: 'none' }, 0.9);\r\n\t\ttl.to(this.scrollLineBG, { y: 16, duration: 0.1, ease: 'none' }, 0.9);\r\n\t\ttl.to(this.scrollIndicator, { opacity: 0, duration: 1, ease: 'sine.out' }, 0);\r\n\t\ttl.to(this.scrollLineDiamond, { y: 300, duration: 0.9, ease: 'none' }, 0);\r\n\t\ttl.to(this.scrollLineDiamond, { y: 316, duration: 0.1, ease: 'none' }, 0.9);\r\n\t\ttl.to(this.choiceText, { opacity: 0, duration: 0.5, ease: 'sine.out' }, 0);\r\n\t\ttl.to(this.choiceText, { y: 50, duration: 1, ease: 'sine.out' }, 0);\r\n\t\ttl.to(this.centerWrapper, { opacity: 0, duration: 0.3 }, 0.7);\r\n\t\ttl.to(this.descriptionWrapper, { opacity: 0, duration: 0.3 }, 0.7);\r\n\r\n\t\tthis.timeline.to(tl, { progress: 1, duration: 0.1 }, 0.9);\r\n\t\tthis.timeline.to(this.exploreNav, { opacity: 1, x: 0, duration: duration * 0.07 }, 0.93);\r\n\t\tthis.timeline.set(this.container, { visibility: 'visible' }, 0);\r\n\t\tthis.timeline.set(this.container, { visibility: 'hidden' }, 1);\r\n\r\n\t\tthis.buttons.forEach((button, index) => {\r\n\t\t\tconst i = index;\r\n\t\t\tbutton.addEventListener('mouseover', () => this.mouseOver(i), false);\r\n\t\t\tbutton.addEventListener('mouseout', () => this.mouseOut(i), false);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate mouseOver = (index: number) => {\r\n\t\tif (this.currHoverIndex !== -1 && this.currHoverIndex !== index) {\r\n\t\t\tthis.hideCurrentIndex();\r\n\t\t}\r\n\t\tthis.currHoverIndex = index;\r\n\r\n\t\tif (this.currImageHoverTimeline) {\r\n\t\t\tthis.currImageHoverTimeline.kill();\r\n\t\t\tthis.currImageHoverTimeline = null;\r\n\t\t}\r\n\t\tthis.currImageHoverTimeline = gsap.timeline();\r\n\t\tthis.currImageHoverTimeline.to(this.imagesComp[0], { opacity: 0, duration: 0.25 }, 0);\r\n\t\tthis.currImageHoverTimeline.to([this.imagesComp[2], this.imagesComp[1]], { opacity: 0, duration: 0.3 }, 0);\r\n\t\tif (this.index === 2) {\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[0], { yPercent: 0, xPercent: -15, ease: 'power4.out', duration: 1.2 / 1.6 }, 0);\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[2], { xPercent: -10, yPercent: -5, ease: 'power4.out', duration: 1.5 / 1.6 }, 0);\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[1], { yPercent: 4, xPercent: -20, ease: 'power4.out', duration: 1.6 / 1.6 }, 0);\r\n\t\t} else {\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[2], { xPercent: 3, ease: 'power4.out', duration: 1 }, 0);\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[1], { xPercent: -3, ease: 'power4.out', duration: 1 }, 0);\r\n\t\t}\r\n\r\n\t\tgsap.killTweensOf(this.descriptions[this.currHoverIndex]);\r\n\t\tgsap.killTweensOf(this.imagesSingular[this.currHoverIndex]);\r\n\t\tgsap.to(this.descriptions[this.currHoverIndex], { opacity: 1, duration: 0.5 });\r\n\t\tgsap.to(this.imagesSingular[this.currHoverIndex], { opacity: 1, duration: this.index === 2 ? 0.3 : 0.1 });\r\n\t};\r\n\r\n\tprivate hideCurrentIndex(instant = false) {\r\n\t\tgsap.killTweensOf(this.descriptions[this.currHoverIndex]);\r\n\t\tgsap.killTweensOf(this.imagesSingular[this.currHoverIndex]);\r\n\t\tgsap.to(this.descriptions[this.currHoverIndex], { opacity: 0, duration: instant ? 0 : 0.35 });\r\n\t\tgsap.to(this.imagesSingular[this.currHoverIndex], { opacity: 0, duration: instant ? 0 : this.index === 2 ? 0.3 : 0.6 });\r\n\r\n\t\tif (this.currImageHoverTimeline) {\r\n\t\t\tthis.currImageHoverTimeline.kill();\r\n\t\t\tthis.currImageHoverTimeline = null;\r\n\t\t}\r\n\t\tthis.currImageHoverTimeline = gsap.timeline();\r\n\t\tthis.currImageHoverTimeline.to(this.imagesComp[0], { opacity: 1, duration: instant ? 0 : 0.6 }, 0);\r\n\t\tthis.currImageHoverTimeline.to([this.imagesComp[2], this.imagesComp[1]], { opacity: 1, duration: instant ? 0 : 0.4 }, 0);\r\n\t\tif (this.index === 2) {\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[0], { yPercent: 0, xPercent: 0, ease: 'power4.out', duration: instant ? 0 : 1.2 / 1.6 }, 0);\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[2], { xPercent: 0, yPercent: 0, ease: 'power4.out', duration: instant ? 0 : 1.5 / 1.6 }, 0);\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[1], { yPercent: 0, xPercent: 0, ease: 'power4.out', duration: instant ? 0 : 1.6 / 1.6 }, 0);\r\n\t\t} else {\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[2], { xPercent: 0, ease: 'power4.out', duration: instant ? 0 : 1 }, 0);\r\n\t\t\tthis.currImageHoverTimeline.to(this.imagesComp[1], { xPercent: 0, ease: 'power4.out', duration: instant ? 0 : 1 }, 0);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate mouseOut = (index: number, instant = false) => {\r\n\t\tif (this.currHoverIndex !== -1) {\r\n\t\t\tthis.hideCurrentIndex(instant);\r\n\t\t}\r\n\t\tthis.currHoverIndex = -1;\r\n\t};\r\n\r\n\tplayIn() {\r\n\t\tif (this.inTimeline.paused()) {\r\n\t\t\tthis.inTimeline.play();\r\n\t\t}\r\n\t}\r\n}\r\n","import { Chapter, IChapter } from '../../ui/chapters/Chapter';\r\nimport { DOFPointsMaterial } from '../../ui/materials/DOFPointsMaterial';\r\nimport { BufferGeometry, Color, Group, Object3D, PerspectiveCamera, Points } from 'three';\r\nimport { gsap } from 'gsap';\r\nimport { DollyZoom } from '../../utils/DollyZoom';\r\nimport { UIRing } from '../../ui/UIRing';\r\nimport { ExploreButton } from '../../ui/ExploreButton';\r\nimport { CustomEase } from 'gsap/CustomEase';\r\nimport { MakeChoice } from '../../ui/MakeChoice';\r\nimport { MainScene } from '../../ui/MainScene';\r\n\r\nexport class Chapter2 extends Chapter implements IChapter {\r\n\tprivate planetLink: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate planetLinkContainer = new Object3D();\r\n\tprivate spaceContainer: Object3D;\r\n\tprivate spaceStation: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate _shipWrapper: Object3D;\r\n\tprivate _ship: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate ringsWrapper = new Group();\r\n\tprivate makeChoice: MakeChoice;\r\n\r\n\tprivate dollyZoom: DollyZoom;\r\n\tprivate dollyZoom2: DollyZoom;\r\n\tprivate dollyZoom3: DollyZoom;\r\n\tprivate dollyZoom4: DollyZoom;\r\n\tprivate dollyZoom5: DollyZoom;\r\n\tprivate dollyZoom6: DollyZoom;\r\n\tprivate dollyZoom7: DollyZoom;\r\n\tpublic CHAPTER_OFFSET = 0.005;\r\n\tpublic SCROLL_LENGTH = 15;\r\n\r\n\tconstructor(\r\n\t\tmenu: any,\r\n\t\tcamera: PerspectiveCamera,\r\n\t\tcameraWrapper: Object3D,\r\n\t\tmainGroup: Group,\r\n\t\tcameraLookAtPoint: Object3D,\r\n\t\texploreButton: ExploreButton,\r\n\t\tchapterIntro: HTMLDivElement,\r\n\t\tchapterPOITitles: HTMLDivElement[],\r\n\t\tindex: number,\r\n\t\tmain: MainScene,\r\n\t\texploreNavLink: HTMLAnchorElement\r\n\t) {\r\n\t\tsuper(menu, camera, cameraWrapper, mainGroup, cameraLookAtPoint, exploreButton, chapterIntro, chapterPOITitles, index, main, exploreNavLink);\r\n\t\tthis.dollyZoom = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom2 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom3 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom4 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom5 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom6 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom7 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.chapterWrapper.add(this.ringsWrapper);\r\n\r\n\t\tthis.makeChoice = new MakeChoice(document.querySelectorAll('.MakeChoice')[1] as HTMLDivElement, 2);\r\n\t}\r\n\r\n\tgetLoadItems(): Array<Array<string>> {\r\n\t\treturn [\r\n\t\t\t['particles/vzus/0.drc', 'ship'],\r\n\t\t\t['particles/spacestation/0.drc', 'space_station'],\r\n\t\t\t['particles/planet_link/0.drc', 'planet_link'],\r\n\t\t\t['particles/planet_link/lines.drc', 'planet_link_lines']\r\n\t\t];\r\n\t}\r\n\r\n\titemLoaded = (geometry: BufferGeometry, path: string, name: string) => {\r\n\t\tif (name === 'ship') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tfocusFadeOutLength: 4.87,\r\n\t\t\t\t\tfocusNear: 7.523,\r\n\t\t\t\t\tfocusFar: 11.934,\r\n\t\t\t\t\tminOpacity: 0.016,\r\n\t\t\t\t\tmaxOpacity: 0.214,\r\n\t\t\t\t\tmaxBlur: 0.13,\r\n\t\t\t\t\tminBlur: 0.12\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(0.01, 0.01, 0.01);\r\n\t\t\tmesh.add(this.exploreAnchor);\r\n\t\t\tthis.exploreAnchor.position.set(-152.65, -25.95, -78.08);\r\n\t\t\tthis._shipWrapper = new Object3D();\r\n\t\t\tthis._shipWrapper.rotation.set(-0.34, 0.65, 0.36);\r\n\t\t\tthis._shipWrapper.add(mesh);\r\n\t\t\tthis._ship = mesh;\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis._shipWrapper.position.z = 12.5;\r\n\t\t\tmesh = this._shipWrapper as any;\r\n\t\t} else if (name === 'space_station') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 10,\r\n\t\t\t\t\tfocusFar: 16,\r\n\t\t\t\t\tfocusFadeOutLength: 9.5,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.016,\r\n\t\t\t\t\tmaxBlur: 0.2,\r\n\t\t\t\t\tminBlur: 0.006\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(0.005, 0.005, 0.005);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\t// mesh.rotation.y = 0.28;\r\n\t\t\tthis.spaceStation = mesh;\r\n\t\t\tthis.spaceContainer = new Object3D();\r\n\t\t\t// this.spaceContainer.position.set(-8.07, -9, -80);\r\n\t\t\tthis.spaceContainer.position.set(-4.67, -9, -80);\r\n\t\t\t// this.exploreAnchor.position.y = 600;\r\n\t\t\t// this.exploreAnchor.position.z = 100;\r\n\t\t\t// mesh.add(this.exploreAnchor);\r\n\t\t\tthis.spaceContainer.add(this.spaceStation);\r\n\t\t\tgsap.to(mesh.rotation, { y: Math.PI * 2, ease: 'none', repeat: -1, duration: 200 });\r\n\t\t\tgsap.to(mesh.position, { y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5 });\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.spaceContainer;\r\n\t\t} else if (name === 'planet_link') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 5.436,\r\n\t\t\t\t\tfocusFar: 0.01,\r\n\t\t\t\t\tfocusFadeOutLength: 35.4,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.05,\r\n\t\t\t\t\tmaxBlur: 0.19,\r\n\t\t\t\t\tminBlur: 0.08\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tmesh.scale.set(0.005, 0.005, 0.005);\r\n\t\t\t// mesh.rotation.y = 0.28;\r\n\t\t\tthis.planetLink = mesh;\r\n\t\t\tmesh.name = 'planetLink';\r\n\t\t\t// mesh.add(this.exploreAnchorSpaceLink);\r\n\t\t\t// this.exploreAnchorSpaceLink.position.set(-200, 350, 0);\r\n\t\t\tthis.planetLinkContainer.add(this.planetLink);\r\n\t\t\tthis.planetLinkContainer.scale.set(-1, 1, 1);\r\n\t\t\tthis.planetLinkContainer.position.set(-2.2, -1.55, -21.1);\r\n\t\t\tthis.planetLinkContainer.rotation.set(0.28, -0.568, 0);\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.planetLinkContainer;\r\n\t\t} else if (name === 'planet_link_lines') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 0.01,\r\n\t\t\t\t\tfocusFar: 12.2,\r\n\t\t\t\t\tfocusFadeOutLength: 0.485,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.2,\r\n\t\t\t\t\tmaxBlur: 0.11,\r\n\t\t\t\t\tminBlur: 0.1\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tmesh.scale.set(0.005, 0.005, 0.005);\r\n\t\t\t// mesh.rotation.y = 0.28;\r\n\t\t\tmesh.name = 'planetLink-lines';\r\n\t\t\tthis.planetLinkContainer.add(mesh);\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.planetLinkContainer;\r\n\t\t}\r\n\t\tmesh.name = name;\r\n\t\tthis.chapterWrapper.add(mesh);\r\n\t};\r\n\r\n\tloadDone() {\r\n\t\tsuper.loadDone();\r\n\t\tthis.createChapterRings();\r\n\t}\r\n\r\n\tpublic setupScrollTimeline = (): gsap.core.Timeline => {\r\n\t\tconst duration = this.duration;\r\n\t\tconst introOffset = 0.1;\r\n\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 0);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.001);\r\n\t\tthis.scrollTimeline.to(this, { scrollProgress: 1, ease: 'none', duration: this.duration }, 0);\r\n\t\tthis.scrollTimeline.fromTo(this.chapterIntroClass.timeline, { progress: 1 }, { progress: 0, ease: 'none', duration: introOffset * 0.45 }, 0);\r\n\t\tthis.scrollTimeline.to(this.chapterIntroClass.timeline, { progress: 1, ease: 'none', duration: introOffset * 0.3 }, introOffset * 1.25);\r\n\t\tthis.scrollTimeline.fromTo(this.ringsWrapper.position, { z: 20 }, { z: 0, ease: 'none', duration: introOffset }, 0);\r\n\t\tthis.scrollTimeline.from(this.ringsMaterial.uniforms.maxOpacity, { value: 0, duration: introOffset * 0.5 }, introOffset * 0.45);\r\n\t\tthis.scrollTimeline.to(\r\n\t\t\tthis.dollyZoom7,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: introOffset * 0.75,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom7.update(15, 4 + 0.9514728725 * 0.3385, 55)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.scrollTimeline.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 160, ease: 'power1.inOut', duration: introOffset * 0.75 }, 0);\r\n\r\n\t\tconst st = gsap.timeline({ paused: true });\r\n\t\t// this.chapterWrapper.visible = false;\r\n\t\t// this.scrollTimeline.set(this.chapterWrapper, {visible: false}, 0);\r\n\t\t// this.scrollTimeline.set(this.chapterWrapper, {visible: true}, 0.001);\r\n\r\n\t\t//Camera dollying:\r\n\t\tvar tlDolly = gsap.timeline({ paused: true });\r\n\t\ttlDolly.to({ dummy: 0 }, { dummy: 1, duration: 100 }, 0);\r\n\r\n\t\t//Tweak rings for focus when camera is dollying:\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFar, { value: 0.01, ease: 'power1.inOut', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFadeOutLength, { value: 24, ease: 'sine.out', duration: 5 }, 0);\r\n\t\ttlDolly.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 51, ease: 'sine.out', duration: 4 }, 0);\r\n\r\n\t\ttlDolly.to(this.main, { mousePanAmount: 4, mouseMoveAmount: 1, duration: 10 }, 0);\r\n\r\n\t\t//Camera dollying:\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 7,\r\n\t\t\t\tease: 'power1.inOut', //'sine.in'\r\n\t\t\t\tonUpdate: () => this.dollyZoom.update(110, 100, 15)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom2,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom2.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t10\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom3,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom3.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t30\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom4,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom4.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t40\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom5,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom5.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t70\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom6,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 10,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom6.update(55, 8, 110)\r\n\t\t\t},\r\n\t\t\t80\r\n\t\t);\r\n\t\tst.to(tlDolly, { progress: 1, ease: 'none', duration: duration * 0.9 }, 0);\r\n\t\t/*        gsap.to(this.spaceStation.material, {\r\n                    focusLength: 50,\r\n                    ease: 'sine.inOut',\r\n                    scrollTrigger: {scrub: scrub, start: '20%', end: '40%', markers: GlobalsLanding.SHOW_MARKERS}\r\n                });*/\r\n\r\n\t\t//Space station:\r\n\t\tst.to(this.spaceStation.material.uniforms.maxOpacity, { value: 0.129, ease: 'none', duration: duration * 0.1 }, 0.1);\r\n\t\tst.to(this.spaceStation.material.uniforms.minBlur, { value: 0.08, ease: 'none', duration: duration * 0.1 }, 0.1);\r\n\t\tst.to(this.spaceStation.material.uniforms.focusFadeOutLength, { value: 9, ease: 'none', duration: duration * 0.1 }, 0.1);\r\n\t\tst.to(this.spaceStation.material.uniforms.focusNear, { value: 12, ease: 'none', duration: duration * 0.1 }, 0.1);\r\n\t\tst.to(this.spaceContainer.position, { y: -3.31, ease: 'sine.out', duration: duration * 0.2 }, 0);\r\n\t\tst.to(this.spaceContainer.rotation, { y: 0.28, ease: 'sine.out', duration: duration * 0.2 }, 0);\r\n\r\n\t\t//Planets with line links:\r\n\t\tst.to(this.planetLinkContainer.position, { x: 2.7, ease: 'power1.inOut', duration: duration * 0.2 }, 0.4);\r\n\t\tst.to(this.planetLinkContainer.rotation, { y: 0, x: 0, ease: 'power1.inOut', duration: duration * 0.2 }, 0.4);\r\n\t\tst.to(this.planetLink.material.uniforms.focusFar, { value: 37, ease: 'none', duration: duration * 0.2 }, 0.4);\r\n\r\n\t\t//Chapter POI titles:\r\n\t\tst.to(this.chapterPOIs[0].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.08);\r\n\t\tst.to(this.chapterPOIs[1].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.4);\r\n\r\n\t\t//Spaceship:\r\n\t\tst.to(this._shipWrapper.position, { z: 16.95, ease: 'power4.inOut', duration: duration * 0.18 }, 0.7);\r\n\t\tst.fromTo(this._ship.rotation, { x: -0.27, y: -0.6, z: 1.659 }, { x: 0, y: 0, z: 0, ease: 'power2.inOut', duration: duration * 0.18 }, 0.7);\r\n\t\tst.fromTo(this._ship.position, { x: 2.04, y: 0, z: 300 }, { x: 0.98, y: -0.25, z: -2.81, ease: 'power2.inOut', duration: duration * 0.15 }, 0.7);\r\n\t\tst.to(this._ship.position, { z: -19, ease: 'power2.in', duration: duration * 0.1 }, 0.85);\r\n\t\tst.to(this._ship.rotation, { x: 0, y: 0, z: -0.23, ease: 'power4.in', duration: duration * 0.07 }, 0.88);\r\n\t\tst.to(this._shipWrapper.rotation, { x: 0, y: 0, z: -0.14, ease: 'power4.in', duration: duration * 0.3 }, 0.7);\r\n\t\t// st.fromTo(this._ship.position, {x: 2.04, y: 0, z: 300}, {x: 0.98, y: -0.250, z: -19, ease: 'slow(0.1, 0.7, false)', duration: duration * 0.2}, 0.7);\r\n\t\tst.fromTo(this._ship.material.uniforms.minOpacity, { value: 0 }, { value: 0.016, ease: 'sine.out', duration: duration * 0.18 }, 0.7);\r\n\t\tst.to(this._ship.material.uniforms.maxBlur, { value: 0.36, ease: 'sine.out', duration: duration * 0.1 }, 0.9);\r\n\t\tst.to(this._ship.material.uniforms.focusNear, { value: 9.76, duration: duration * 0.1 }, 0.9);\r\n\r\n\t\t//Explore button in:\r\n\t\tvar tl = gsap.timeline({ paused: true, onUpdate: this.setActiveExploreItem });\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 0.19);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'auto', duration: 0 }, 0.2);\r\n\t\ttl.fromTo(this.exploreButton.container, { opacity: 0 }, { opacity: 1, ease: 'sine.out', duration: 0.2 }, 0.2);\r\n\t\ttl.fromTo(this.exploreButton.container, { opacity: 1 }, { opacity: 0, ease: 'sine.out', duration: 0.2 }, 0.8);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 1);\r\n\t\tst.to(tl, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.7);\r\n\r\n\t\t/*        gsap.fromTo(this._ship.rotation, {z: -Math.PI * 0.7},\r\n                    {\r\n                        z: 0,\r\n                        ease: 'power4.inOut',\r\n                        scrollTrigger: {scrub: scrub, start: '80%', end: 'bottom bottom', markers: GlobalsLanding.SHOW_MARKERS}\r\n                    });*/\r\n\t\t/*        gsap.fromTo(this._ship.material, {focusLength: 0},\r\n                    {\r\n                        focusLength: 100,\r\n                        ease: 'power4.inOut',\r\n                        scrollTrigger: {scrub: scrub, start: '80%', end: 'bottom bottom', markers: GlobalsLanding.SHOW_MARKERS}\r\n                    });*/\r\n\r\n\t\tconst ease = CustomEase.create('custom', 'M0,0 C0.632,0.674 0.656,0.708 0.786,0.854 0.852,0.928 0.918,1 1,1 ');\r\n\t\t// const ease = CustomEase.create(\"custom\", \"M0,0 C0,0 0.826,1 1,1 \");\r\n\r\n\t\tst.to(this.cameraWrapper.position, { z: 130 + 122, ease: ease, duration: this.duration }, 0);\r\n\t\tst.to(this.cameraLookAtPoint.position, { z: 150 + this.CHAPTER_DISTANCE, ease: ease, duration: this.duration }, 0);\r\n\t\t// const ease = CustomEase.create(\"custom\", \"M0,0 C0,0 0.826,1 1,1 \");\r\n\r\n\t\tst.to(\r\n\t\t\tthis.main,\r\n\t\t\t{\r\n\t\t\t\tmousePanAmount: 2,\r\n\t\t\t\tmouseMoveAmount: 2,\r\n\t\t\t\tduration: 0.1\r\n\t\t\t},\r\n\t\t\t0.9\r\n\t\t);\r\n\r\n\t\tthis.scrollTimeline.to(st, { progress: 1, duration: this.duration * 0.88 - introOffset, ease: 'none' }, introOffset);\r\n\t\tthis.scrollTimeline.to(this.makeChoice.timeline, { progress: 1, duration: this.duration * 0.3 - introOffset * 0.6, ease: 'none' }, 0.7 + introOffset * 0.6);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.999);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 1);\r\n\t\treturn this.scrollTimeline;\r\n\t};\r\n\r\n\tprivate createChapterRings() {\r\n\t\tconst rings = 15;\r\n\t\tvar offset = -80 + (rings - 5) * 10;\r\n\r\n\t\tfor (let i = 0; i < rings; i++) {\r\n\t\t\tconst ring = new UIRing(this.ringsWrapper, 10, 100, 0, Math.PI * 2, this.menu, 'ring', new Color(0x080202), null, this.ringsMaterial);\r\n\t\t\tthis.rings.push(ring);\r\n\t\t\tring.points.position.z = offset - i * 10;\r\n\t\t\tgsap.to(ring.points.rotation, { z: Math.PI, duration: 50 + i * 10, repeat: -1, ease: 'none' });\r\n\t\t}\r\n\t}\r\n}\r\n","import { Chapter } from '../ui/chapters/Chapter';\r\nimport { BufferGeometry, FileLoader, Loader, Texture, TextureLoader } from 'three';\r\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader';\r\nimport { GLTF, GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\r\n\r\nexport interface ILoadItem {\r\n\tpath: string;\r\n\tname: string;\r\n\tdoneCallback: (geometry: BufferGeometry, path: string, name: string) => void;\r\n}\r\n\r\nexport class LoadManager extends Loader {\r\n\tprivate chapters: Chapter[];\r\n\tprivate loadItems: Map<string, ILoadItem[]> = new Map();\r\n\tprivate currentlyLoaded = 0;\r\n\tprivate additionalLoads = 0;\r\n\tprivate additionalLoadsCompleted = 0;\r\n\tprivate loadDoneCallback: () => void;\r\n\tprivate dracoLoader = new DRACOLoader();\r\n\tprivate gltfLoader = new GLTFLoader();\r\n\tprivate loadedPaths = [];\r\n\r\n\tprivate taskConfig = {\r\n\t\tattributeIDs: {\r\n\t\t\tposition: 'POSITION',\r\n\t\t\tcolor: 'COLOR',\r\n\t\t\tsize: 'GENERIC'\r\n\t\t},\r\n\t\tattributeTypes: {\r\n\t\t\tposition: 'Float32Array',\r\n\t\t\tcolor: 'Float32Array',\r\n\t\t\tsize: 'Float32Array'\r\n\t\t},\r\n\t\tuseUniqueIDs: false\r\n\t};\r\n\r\n\tconstructor(loadDoneCallback: () => void) {\r\n\t\tsuper();\r\n\t\tthis.manager.setURLModifier(url => {\r\n\t\t\treturn 'assets/home/' + url;\r\n\t\t});\r\n\t\tthis.loadDoneCallback = loadDoneCallback;\r\n\t\tthis.dracoLoader.setDecoderPath('libs/draco/');\r\n\t\tthis.dracoLoader.setDecoderConfig({ type: 'wasm' });\r\n\t\t// Optional: Pre-fetch Draco WASM/JS module.\r\n\t\tthis.dracoLoader.preload();\r\n\t\tthis.gltfLoader.setDRACOLoader(this.dracoLoader);\r\n\t}\r\n\r\n\tpublic setChapters(chapters: Chapter[]) {\r\n\t\tthis.chapters = chapters;\r\n\t\tthis.chapters.forEach(chapter => {\r\n\t\t\tchapter.getLoadItems().forEach(item => {\r\n\t\t\t\tconst path = item[0];\r\n\t\t\t\tconst loadObj = { path, name: item[1], doneCallback: chapter.itemLoaded };\r\n\t\t\t\tif (!this.loadItems.has(path)) {\r\n\t\t\t\t\tthis.loadItems.set(path, [loadObj]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.loadItems.get(path).push(loadObj);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tpublic addLoadItem = (loadItem: ILoadItem) => {\r\n\t\tconst path = loadItem.path;\r\n\t\tif (!this.loadItems.has(path)) {\r\n\t\t\tthis.loadItems.set(path, [loadItem]);\r\n\t\t} else {\r\n\t\t\tthis.loadItems.get(path).push(loadItem);\r\n\t\t}\r\n\t};\r\n\tpublic loadGLTF = (path: string, callback: (result: GLTF) => void) => {\r\n\t\tthis.additionalLoads++;\r\n\t\tthis.gltfLoader.load(\r\n\t\t\tpath,\r\n\t\t\tresult => {\r\n\t\t\t\tthis.additionalLoadsCompleted++;\r\n\t\t\t\tthis.checkLoadDone();\r\n\t\t\t\tcallback(result);\r\n\t\t\t},\r\n\t\t\tfunction(xhr) {\r\n\t\t\t\t//console.log((xhr.loaded / xhr.total * 100) + '% loaded');\r\n\t\t\t},\r\n\t\t\tfunction(error) {\r\n\t\t\t\tconsole.log('An error happened', error);\r\n\t\t\t}\r\n\t\t);\r\n\t};\r\n\r\n\tdracoLoad(url, onLoad, onProgress, onError) {\r\n\t\tconst loader = new FileLoader(this.manager);\r\n\r\n\t\tloader.setPath(this.path);\r\n\t\tloader.setResponseType('arraybuffer');\r\n\t\tloader.setRequestHeader(this.requestHeader);\r\n\t\tloader.setWithCredentials(this.withCredentials);\r\n\r\n\t\tloader.load(\r\n\t\t\turl,\r\n\t\t\tbuffer => {\r\n\t\t\t\t//@ts-ignore:\r\n\t\t\t\tthis.dracoLoader\r\n\t\t\t\t\t//@ts-ignore:\r\n\t\t\t\t\t.decodeGeometry(buffer, this.taskConfig)\r\n\t\t\t\t\t.then(onLoad)\r\n\t\t\t\t\t.catch(onError);\r\n\t\t\t},\r\n\t\t\tonProgress,\r\n\t\t\tonError\r\n\t\t);\r\n\t}\r\n\r\n\tpublic startLoading() {\r\n\t\tthis.loadItems.forEach(loadItem => {\r\n\t\t\t// console.log(loadItem);\r\n\t\t\tif (loadItem[0].path.indexOf('.drc') > 0) {\r\n\t\t\t\tthis.dracoLoad(\r\n\t\t\t\t\t// resource URL\r\n\t\t\t\t\tloadItem[0].path,\r\n\t\t\t\t\t// called when the resource is loaded\r\n\t\t\t\t\t(geometry: BufferGeometry) => {\r\n\t\t\t\t\t\t// if (geometry.getAttribute('position').count > 65000) {\r\n\t\t\t\t\t\t//     console.warn(\"too many points in one object: \", loadItem, geometry.getAttribute('position').count)\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\tgeometry.setAttribute('customColor', geometry.attributes.color);\r\n\t\t\t\t\t\tgeometry.deleteAttribute('color');\r\n\t\t\t\t\t\tthis.itemLoaded(geometry, loadItem);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t// called as loading progresses\r\n\t\t\t\t\tfunction(xhr) {\r\n\t\t\t\t\t\t//console.log((xhr.loaded / xhr.total * 100) + '% loaded');\r\n\t\t\t\t\t},\r\n\t\t\t\t\t// called when loading has errors\r\n\t\t\t\t\tfunction(error) {\r\n\t\t\t\t\t\tconsole.log('An error happened');\r\n\t\t\t\t\t\tconsole.log(error);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\t//loadCSV(loadItem, this.itemLoaded)\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\titemLoaded = (geometry: BufferGeometry, loadItem: ILoadItem[]) => {\r\n\t\tthis.currentlyLoaded++;\r\n\t\tloadItem.forEach(loadItem => loadItem.doneCallback(geometry, loadItem.path, loadItem.name));\r\n\t\tthis.checkLoadDone();\r\n\t};\r\n\r\n\tprivate checkLoadDone() {\r\n\t\tif (this.loadItems.size + this.additionalLoads === this.currentlyLoaded + this.additionalLoadsCompleted) {\r\n\t\t\tthis.loadDone();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate loadDone() {\r\n\t\tthis.dracoLoader.dispose();\r\n\t\tthis.loadDoneCallback();\r\n\t}\r\n\r\n\tloadTexture(path: string): Texture {\r\n\t\tthis.additionalLoads++;\r\n\t\treturn new TextureLoader().load(\r\n\t\t\tpath,\r\n\t\t\tresult => {\r\n\t\t\t\tthis.additionalLoadsCompleted++;\r\n\t\t\t\tthis.checkLoadDone();\r\n\t\t\t},\r\n\t\t\tfunction(xhr) {\r\n\t\t\t\t//console.log((xhr.loaded / xhr.total * 100) + '% loaded');\r\n\t\t\t},\r\n\t\t\tfunction(error) {\r\n\t\t\t\tconsole.log('An error happened', error);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n}\r\n","import { Chapter, IChapter } from '../../ui/chapters/Chapter';\r\nimport { DOFPointsMaterial } from '../../ui/materials/DOFPointsMaterial';\r\nimport { BufferGeometry, Color, Group, Object3D, PerspectiveCamera, Points } from 'three';\r\nimport { gsap } from 'gsap';\r\nimport { DollyZoom } from '../../utils/DollyZoom';\r\nimport { UIRing } from '../../ui/UIRing';\r\nimport { ExploreButton } from '../../ui/ExploreButton';\r\nimport { CustomEase } from 'gsap/CustomEase';\r\nimport { SlowMo } from 'gsap/EasePack';\r\nimport { MakeChoice } from '../../ui/MakeChoice';\r\nimport { MainScene } from '../../ui/MainScene';\r\n\r\ngsap.registerPlugin(CustomEase, SlowMo);\r\nexport class Chapter1 extends Chapter implements IChapter {\r\n\tpublic SCROLL_LENGTH = 11;\r\n\r\n\tprivate dollyZoom: DollyZoom;\r\n\tprivate dollyZoom2: DollyZoom;\r\n\tprivate dollyZoom3: DollyZoom;\r\n\tprivate dollyZoom4: DollyZoom;\r\n\tprivate dollyZoom5: DollyZoom;\r\n\tprivate dollyZoom6: DollyZoom;\r\n\r\n\tprivate makeChoice: MakeChoice;\r\n\tprivate planetShipsOrbit: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate planetShipsOrbitContainer: Object3D = new Object3D();\r\n\tprivate ship: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate shipContainer: Object3D = new Object3D();\r\n\tprivate shipContainer2: Object3D = new Object3D();\r\n\tprivate planets: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate ship2: Points<BufferGeometry, DOFPointsMaterial>;\r\n\r\n\tconstructor(\r\n\t\tmenu: any,\r\n\t\tcamera: PerspectiveCamera,\r\n\t\tcameraWrapper: Object3D,\r\n\t\tmainGroup: Group,\r\n\t\tcameraLookAtPoint: Object3D,\r\n\t\texploreButton: ExploreButton,\r\n\t\tchapterIntro: HTMLDivElement,\r\n\t\tchapterPOITitles: HTMLDivElement[],\r\n\t\tindex: number,\r\n\t\tmain: MainScene,\r\n\t\texploreNavLink: HTMLAnchorElement\r\n\t) {\r\n\t\tsuper(menu, camera, cameraWrapper, mainGroup, cameraLookAtPoint, exploreButton, chapterIntro, chapterPOITitles, index, main, exploreNavLink);\r\n\t\tthis.dollyZoom = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom2 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom3 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom4 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom5 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom6 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\r\n\t\tthis.makeChoice = new MakeChoice(document.querySelectorAll('.MakeChoice')[0] as HTMLDivElement);\r\n\t}\r\n\r\n\tgetLoadItems(): Array<Array<string>> {\r\n\t\treturn [['particles/planet_ships_orbit/0.drc', 'planet_ships_orbit'], ['particles/pearce_ship/pearce.drc', 'ship'], ['particles/multiple_planets/0.drc', 'planets']];\r\n\t}\r\n\r\n\titemLoaded = (geometry: BufferGeometry, path: string, name: string) => {\r\n\t\tif (name === 'planet_ships_orbit') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tfocusNear: 10,\r\n\t\t\t\t\tfocusFar: 16,\r\n\t\t\t\t\tfocusFadeOutLength: 9,\r\n\t\t\t\t\tminBlur: 0.02,\r\n\t\t\t\t\tmaxBlur: 0.09,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.126\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\t// var material = new DOFPointsMaterial({minOpacity: 0, maxBlur: 0.15, focusNear: 10000, focusFar: 15000, focusFadeOutLength: 5000}, this.menu, name);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\t// exportGLTF(mesh);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tmesh.scale.set(-0.005, 0.005, 0.005);\r\n\t\t\tmesh.position.x = -5.57;\r\n\t\t\tmesh.position.z = -80;\r\n\t\t\tmesh.visible = false;\r\n\t\t\tthis.planetShipsOrbit = mesh;\r\n\t\t\tthis.planetShipsOrbitContainer.add(this.planetShipsOrbit);\r\n\t\t\t//@ts-ignore:\r\n\t\t\tmesh = this.planetShipsOrbitContainer;\r\n\t\t} else if (name === 'ship') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tfocusNear: 5.1,\r\n\t\t\t\t\tfocusFar: 29,\r\n\t\t\t\t\tfocusFadeOutLength: 2.6,\r\n\t\t\t\t\tminBlur: 0.08,\r\n\t\t\t\t\tmaxBlur: 0.3,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.192,\r\n\t\t\t\t\tradiusScaleFactor: 100\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tthis.ship2 = new Points(geometry, material);\r\n\t\t\tthis.sortPoints.push(this.ship2);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.ship2.scale.set(-1, 1, 1);\r\n\t\t\tmesh.position.z = -25.96;\r\n\t\t\tmesh.rotation.x = -0.16;\r\n\t\t\tmesh.visible = false;\r\n\t\t\tthis.ship = mesh;\r\n\t\t\t// mesh.visible = false;\r\n\t\t\tthis.shipContainer.add(this.ship);\r\n\r\n\t\t\tthis.shipContainer2.position.set(-6.96, -2.78, -26);\r\n\t\t\tthis.shipContainer2.rotation.set(0, -2.81, 0);\r\n\t\t\tthis.shipContainer2.add(this.ship2);\r\n\t\t\tthis.chapterWrapper.add(this.shipContainer2);\r\n\t\t\t//@ts-ignore:\r\n\t\t\tmesh = this.shipContainer;\r\n\t\t} else if (name === 'planets') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tminBlur: 0.04,\r\n\t\t\t\t\tmaxOpacity: 0.5,\r\n\t\t\t\t\tmaxBlur: 0.21,\r\n\t\t\t\t\tfocusNear: 3,\r\n\t\t\t\t\tfocusFar: 150,\r\n\t\t\t\t\tfocusFadeOutLength: 3.76,\r\n\t\t\t\t\tradiusScaleFactor: 100\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\t// var material = new DOFPointsMaterial({minOpacity: 0, maxBlur: 0.15, focusNear: 10000, focusFar: 15000, focusFadeOutLength: 5000}, this.menu, name);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.planets = mesh;\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tmesh.position.z = 80;\r\n\t\t\t// mesh.position.set(-26.420, -2.03, 50);\r\n\t\t\t// mesh.rotation.set(-0.45, -0.35, 0);\r\n\t\t\tthis.exploreAnchor.position.set(-11.87, 8.7, 18.9);\r\n\t\t\tmesh.add(this.exploreAnchor);\r\n\t\t\tmesh.visible = false;\r\n\t\t\t// mesh.visible = false;\r\n\t\t\t// gsap.to(mesh.rotation, {y: Math.PI * 2, ease: 'none', repeat: -1, duration: 200});\r\n\t\t}\r\n\t\tmesh.name = name;\r\n\t\tthis.chapterWrapper.add(mesh);\r\n\t};\r\n\r\n\tloadDone() {\r\n\t\tsuper.loadDone();\r\n\t\tthis.createChapterRings();\r\n\t}\r\n\r\n\tpublic setupScrollTimeline = (): gsap.core.Timeline => {\r\n\t\tconst duration = this.duration;\r\n\t\tthis.scrollTimeline.to(this.chapterIntroClass.timeline, { progress: 1, ease: 'none', duration: duration * 0.05 }, 0);\r\n\r\n\t\t// console.log(this.cameraLookAtPoint.getWorldPosition().distanceTo(this.camera.getWorldPosition()))\r\n\t\tconst st = gsap.timeline({ paused: true });\r\n\t\tthis.scrollTimeline.to(this, { scrollProgress: 1, ease: 'none', duration: this.duration }, 0);\r\n\r\n\t\t//Camera dollying:\r\n\t\tvar tlDolly = gsap.timeline({ paused: true });\r\n\t\ttlDolly.to({ dummy: 0 }, { dummy: 1, duration: 100 }, 0);\r\n\r\n\t\t//Tweak rings for focus when camera is dollying:\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFar, { value: 0.01, ease: 'sine.out', duration: 2 }, 0);\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFadeOutLength, { value: 24, ease: 'sine.out', duration: 2 }, 0);\r\n\t\ttlDolly.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 51, ease: 'sine.out', duration: 4 }, 0);\r\n\r\n\t\ttlDolly.to(\r\n\t\t\tthis.main,\r\n\t\t\t{\r\n\t\t\t\tmousePanAmount: 6,\r\n\t\t\t\tmouseMoveAmount: 1,\r\n\t\t\t\tduration: 7\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\r\n\t\t//Camera dollying:\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 7,\r\n\t\t\t\tease: 'sine.out',\r\n\t\t\t\tonUpdate: () => this.dollyZoom.update(110, 100, 15)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom2,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom2.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t10\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom3,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom3.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t30\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom4,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom4.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t40\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom5,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom5.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t70\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom6,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 10,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom6.update(55, 8, 110)\r\n\t\t\t},\r\n\t\t\t80\r\n\t\t);\r\n\t\tst.to(tlDolly, { progress: 1, ease: 'none', duration: duration * 0.9 }, 0);\r\n\t\t/*        gsap.to(this.spaceStation.material, {\r\n                    focusLength: 50,\r\n                    ease: 'sine.inOut',\r\n                    scrollTrigger: {scrub: scrub, start: '20%', end: '40%', markers: GlobalsLanding.SHOW_MARKERS}\r\n                });*/\r\n\r\n\t\t//Chapter POI titles:\r\n\t\tst.to(this.chapterPOIs[0].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.08);\r\n\t\tst.to(this.chapterPOIs[1].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.4);\r\n\t\tst.to('.ScrollHelpIndicator', { opacity: 0, yPercent: 100, ease: 'none', duration: duration * 0.02 }, 0);\r\n\r\n\t\t//Planet ships orbit:\r\n\t\tst.set(this.planetShipsOrbit, { visible: true }, 0);\r\n\t\tst.to(this.planetShipsOrbit.material.uniforms.maxBlur, { value: 0.21, duration: 0.16 }, 0.2);\r\n\t\tst.fromTo(this.planetShipsOrbit.material.uniforms.maxOpacity, { value: 0.027 }, { value: 0.3, duration: 0.16 }, 0.1);\r\n\t\tst.fromTo(this.planetShipsOrbit.rotation, { x: -0.15, y: -0.45 }, { x: 0.15, y: 0.45, duration: 0.45 }, 0.05);\r\n\t\tst.to(this.planetShipsOrbit.position, { y: -5.19, duration: 0.45 }, 0.05);\r\n\r\n\t\t//Ship\r\n\t\tst.set(this.planetShipsOrbit, { visible: false }, 0.3);\r\n\t\tst.set(this.ship, { visible: true }, 0.3);\r\n\t\t// st.to(this.ship.rotation, {y: 0, ease: 'power1.inOut', duration: duration * 0.4}, 0.4);\r\n\t\tst.fromTo(this.ship.rotation, { z: -2 }, { z: 0, ease: 'power1.inOut', duration: duration * 0.4 }, 0.3);\r\n\t\tst.to(this.ship.rotation, { x: 0, ease: 'power2.inOut', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.ship.rotation, { y: -0.37 }, { y: 0, ease: 'power2.inOut', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.ship.position, { z: -5 }, { z: -30, ease: 'power1.out', duration: duration * 0.5 }, 0.35);\r\n\t\tst.fromTo(this.ship.position, { y: -5 }, { y: 0, ease: 'power3.out', duration: duration * 0.5 }, 0.35);\r\n\t\tst.fromTo(this.shipContainer2.position, { z: -30 }, { z: -26, ease: 'power1.out', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.ship2.position, { z: 30 }, { z: -60, ease: 'power1.out', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.ship2.rotation, { z: 1.06 }, { z: 0, ease: 'power3.out', duration: duration * 0.4 }, 0.3);\r\n\t\tst.set(this.ship2, { visible: false }, 0.5);\r\n\r\n\t\t// st.to(this.ship.position, {y: 0, ease: 'power1.inOut', duration: duration * 0.4}, 0.4);\r\n\t\t// st.fromTo(this.shipContainer.position, {x:-25},{x: 0, ease: 'power1.inOut', duration: duration * 0.2}, 0.3);\r\n\t\t// st.to(this.ship.material.uniforms.focusFar, {value: 27, ease: 'none', duration: duration * 0.1}, 0.3);\r\n\t\tst.fromTo(this.ship.material.uniforms.minBlur, { value: 0.02 }, { value: 0.08, ease: 'none', duration: duration * 0.2 }, 0.3);\r\n\t\t// st.fromTo(this.ship.material.uniforms.maxBlur, {value: 0.1},{value: 0.3, ease: 'none', duration: duration * 0.1}, 0.4);\r\n\t\tst.from(this.ship.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.04 }, 0.3);\r\n\r\n\t\t//Asteroids:\r\n\t\tst.set(this.planetShipsOrbit, { visible: false }, 0.6);\r\n\t\tst.set(this.planets, { visible: true }, 0.6);\r\n\t\tst.fromTo(this.planets.material.uniforms.maxOpacity, { value: 0 }, { value: 0.137, ease: 'none', duration: duration * 0.05 }, 0.65);\r\n\t\tst.to(this.planets.material.uniforms.maxOpacity, { value: 0.578, ease: 'none', duration: duration * 0.05 }, 0.74);\r\n\t\tst.from(this.planets.material.uniforms.radiusScaleFactor, { value: 50, ease: 'none', duration: duration * 0.3 }, 0.65);\r\n\t\tst.fromTo(this.planets.material.uniforms.minBlur, { value: 0.001 }, { value: 0.045, ease: 'none', duration: duration * 0.25 }, 0.65);\r\n\t\tst.to(this.planets.rotation, { y: 0.71, ease: 'power1.inOut', duration: duration * 0.35 }, 0.65);\r\n\t\tst.to(this.planets.position, { z: 10, ease: 'none', duration: duration * 0.3 }, 0.65);\r\n\t\tst.to(this.planets.position, { y: 2, ease: 'power1.inOut', duration: duration * 0.3 }, 0.65);\r\n\t\tst.to(this.planets.material.uniforms.focusNear, { value: 20, ease: 'none', duration: duration * 0.15 }, 0.65);\r\n\t\t// st.to(this.planets.material.uniforms.focusNear, {value: 80, ease: 'none', duration: duration * 0.15}, 0.8);\r\n\t\tst.to(this.planets.material.uniforms.focusFadeOutLength, { value: 3, ease: 'none', duration: duration * 0.15 }, 0.65);\r\n\t\tst.to(this.planets.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0.8);\r\n\t\t// st.to(this.planets.position, {z: -11, ease: 'power1.inOut', duration: duration * 0.05}, 0.95);\r\n\t\t// st.to(this.planets.rotation, {y: 0.71, ease: 'power1.inOut', duration: duration * 0.05}, 0.95);\r\n\t\tst.set(this.planets, { visible: false }, 0.9);\r\n\r\n\t\t//Explore button in:\r\n\t\tvar tl = gsap.timeline({ paused: true, onUpdate: this.setActiveExploreItem });\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 0.19);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'auto', duration: 0 }, 0.2);\r\n\t\ttl.fromTo(this.exploreButton.container, { opacity: 0 }, { opacity: 1, ease: 'sine.out', duration: 0.2 }, 0.2);\r\n\t\ttl.fromTo(this.exploreButton.container, { opacity: 1 }, { opacity: 0, ease: 'sine.out', duration: 0.2 }, 0.8);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 1);\r\n\t\tst.to(tl, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.62);\r\n\r\n\t\t/*        gsap.fromTo(this._ship.rotation, {z: -Math.PI * 0.7},\r\n                    {\r\n                        z: 0,\r\n                        ease: 'power4.inOut',\r\n                        scrollTrigger: {scrub: scrub, start: '80%', end: 'bottom bottom', markers: GlobalsLanding.SHOW_MARKERS}\r\n                    });*/\r\n\t\t/*        gsap.fromTo(this._ship.material, {focusLength: 0},\r\n                    {\r\n                        focusLength: 100,\r\n                        ease: 'power4.inOut',\r\n                        scrollTrigger: {scrub: scrub, start: '80%', end: 'bottom bottom', markers: GlobalsLanding.SHOW_MARKERS}\r\n                    });*/\r\n\r\n\t\tconst ease = CustomEase.create('custom', 'M0,0 C0.632,0.674 0.656,0.708 0.786,0.854 0.852,0.928 0.918,1 1,1 ');\r\n\t\t// const ease = CustomEase.create(\"custom\", \"M0,0 C0,0 0.826,1 1,1 \");\r\n\r\n\t\tst.to(this.cameraWrapper.position, { z: 130, ease: ease, duration: this.duration }, 0);\r\n\t\tst.to(this.cameraLookAtPoint.position, { z: 150, ease: ease, duration: this.duration }, 0);\r\n\r\n\t\tst.to(\r\n\t\t\tthis.main,\r\n\t\t\t{\r\n\t\t\t\tmousePanAmount: 2,\r\n\t\t\t\tmouseMoveAmount: 2,\r\n\t\t\t\tduration: 0.1\r\n\t\t\t},\r\n\t\t\t0.9\r\n\t\t);\r\n\r\n\t\tthis.scrollTimeline.to(st, { progress: 1, duration: this.duration * 0.88, ease: 'none' }, 0);\r\n\t\tthis.scrollTimeline.to(this.makeChoice.timeline, { progress: 1, duration: this.duration * 0.3, ease: 'none' }, 0.7);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.999);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 1);\r\n\r\n\t\treturn this.scrollTimeline;\r\n\t};\r\n\r\n\tprivate createChapterRings() {\r\n\t\tconst rings = 14;\r\n\t\tvar offset = -80 + (rings - 5) * 10;\r\n\r\n\t\tfor (let i = 0; i < rings; i++) {\r\n\t\t\tconst ring = new UIRing(this.chapterWrapper, 10, 100, 0, Math.PI * 2, this.menu, 'ring', new Color(0x080202), null, this.ringsMaterial);\r\n\t\t\tthis.rings.push(ring);\r\n\t\t\tring.points.position.z = offset - i * 10;\r\n\t\t\tgsap.to(ring.points.rotation, { z: Math.PI, duration: 50 + i * 10, repeat: -1, ease: 'none' });\r\n\t\t}\r\n\t}\r\n}\r\n","import { LoadManager } from '../utils/LoadManager';\r\nimport { gsap } from 'gsap';\r\nimport { BufferGeometry, Group, Object3D, Points } from 'three';\r\nimport { GlobalsLanding } from '../utils/GlobalsLanding';\r\nimport { DOFPointsMaterial } from './materials/DOFPointsMaterial';\r\n\r\nexport class ClusterCloud {\r\n\tpublic material: DOFPointsMaterial;\r\n\tprivate container: Object3D;\r\n\tprivate group = new Group();\r\n\r\n\tconstructor(loadManager: LoadManager, container: Object3D, chapters: number, menu: any) {\r\n\t\tthis.chapters = chapters;\r\n\t\tthis.container = container;\r\n\t\tthis.material = new DOFPointsMaterial(\r\n\t\t\t{\r\n\t\t\t\tfocusNear: 0.01,\r\n\t\t\t\tfocusFar: 160,\r\n\t\t\t\tfocusFadeOutLength: 28,\r\n\t\t\t\tmaxBlur: 0.11,\r\n\t\t\t\tminBlur: 0.05,\r\n\t\t\t\tminOpacity: 0,\r\n\t\t\t\tmaxOpacity: 0.28\r\n\t\t\t},\r\n\t\t\tmenu,\r\n\t\t\t'ClusterCloud'\r\n\t\t);\r\n\t\tthis.container.add(this.group);\r\n\t\tloadManager.addLoadItem({ path: 'particles/clusters/0.drc', name: 'cluster', doneCallback: this.setupGeometry });\r\n\t}\r\n\r\n\tprivate setupGeometry = (geometry: BufferGeometry, path: string, name: string) => {\r\n\t\tlet mesh: Points;\r\n\t\tvar length = 5087.172 / 10;\r\n\t\tfor (let j = 0; j < this.chapters; j++) {\r\n\t\t\tconst zOffset = (j - 1) * GlobalsLanding.CHAPTER_DISTANCE;\r\n\t\t\tfor (let i = 0; i < 3; i++) {\r\n\t\t\t\tmesh = new Points(geometry, this.material);\r\n\t\t\t\tmesh.scale.set(0.1, 0.1, 0.1);\r\n\t\t\t\tmesh.position.set(0, 0, zOffset + i * length);\r\n\t\t\t\tgsap.to(mesh.rotation, { z: Math.PI * 2, ease: 'none', repeat: -1, duration: 200 });\r\n\t\t\t\tgsap.to(mesh.position, { z: '-=' + length, ease: 'none', repeat: -1, duration: 100 });\r\n\t\t\t\tthis.group.add(mesh);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tprivate chapters: number;\r\n}\r\n","import { gsap } from 'gsap';\r\n\r\nexport class ExploreNav {\r\n\tprivate container = document.querySelector('.ExploreNav');\r\n\tprivate links = Array.from(this.container.querySelectorAll('a'));\r\n\tprivate lines = Array.from(this.container.querySelectorAll('.ExploreNav-line'));\r\n\tprivate linesInner = Array.from(this.container.querySelectorAll('.ExploreNav-lineInner'));\r\n\tprivate linesProgress = Array.from(this.container.querySelectorAll('.ExploreNav-lineProgress'));\r\n\tprivate diamonds = Array.from(this.container.querySelectorAll('.ExploreNav-diamond'));\r\n\tprivate innerDiamonds = Array.from(this.container.querySelectorAll('.innerDiamond'));\r\n\tprivate outerDiamonds = Array.from(this.container.querySelectorAll('.outerDiamond'));\r\n\tprivate highlightDiamonds = Array.from(this.container.querySelectorAll('.highlightDiamond'));\r\n\tprivate highlightDiamondOuters = Array.from(this.container.querySelectorAll('.highlightDiamondOuter'));\r\n\tprivate diamondLabels = Array.from(this.container.querySelectorAll('.ExploreNav-diamond span'));\r\n\tpublic timeline: gsap.core.Timeline;\r\n\tprivate gotoChapter: (index: number) => void;\r\n\tprivate linksTimeline = gsap.timeline({ paused: true });\r\n\tprivate chapterLengths: number[];\r\n\tprivate expandTime = 0.01;\r\n\tprivate ease = 'sine.inOut';\r\n\tprivate dummyTime = 0;\r\n\tprivate dummyTime2 = 0;\r\n\tconstructor(gotoChapter: (index: number) => void) {\r\n\t\tthis.gotoChapter = gotoChapter;\r\n\t}\r\n\r\n\tsetupTimeline(chapterLengths: number[]) {\r\n\t\tthis.chapterLengths = chapterLengths;\r\n\t\tthis.timeline = gsap.timeline({ paused: true });\r\n\r\n\t\tthis.timeline.to(this, { dummyTime: 1, duration: 1 }, 0);\r\n\t\tthis.linksTimeline.to(this, { dummyTime2: 1, duration: 1 }, 0);\r\n\r\n\t\tvar currOffset = 0;\r\n\t\tconst ease = this.ease;\r\n\r\n\t\tchapterLengths.forEach((length, index) => {\r\n\t\t\tlet tl = gsap.timeline({ paused: true });\r\n\r\n\t\t\t// in/open:\r\n\t\t\ttl.to(this.diamondLabels[index], { opacity: 1, duration: this.expandTime, ease }, 0);\r\n\t\t\ttl.to(this.highlightDiamonds[index], { opacity: 1, duration: this.expandTime, ease }, 0);\r\n\t\t\ttl.to(this.innerDiamonds[index], { opacity: 0, scale: 0.2, duration: this.expandTime, ease }, 0);\r\n\t\t\ttl.to(this.outerDiamonds[index], { opacity: 0, duration: this.expandTime, ease }, 0);\r\n\t\t\ttl.fromTo(this.highlightDiamondOuters[index], { scale: 0.8, opacity: 0 }, { scale: 1, opacity: 0.2, duration: this.expandTime, ease }, 0);\r\n\t\t\ttl.to(this.linesInner[index], { yPercent: 0, duration: this.expandTime, ease }, 0);\r\n\r\n\t\t\t// progress:\r\n\t\t\ttl.to(this.linesProgress[index], { scaleY: 1, duration: 1 - this.expandTime, ease: 'none' }, 0);\r\n\r\n\t\t\t// Out/collapse:\r\n\t\t\ttl.to(this.linesInner[index], { yPercent: -50, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\t\t\ttl.to(this.linesProgress[index], { scaleY: 0.535, opacity: 0, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\t\t\ttl.to(this.diamondLabels[index], { opacity: 0, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\t\t\ttl.to(this.highlightDiamonds[index], { opacity: 0, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\t\t\ttl.to(this.innerDiamonds[index], { opacity: 1, scale: 1, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\t\t\ttl.to(this.outerDiamonds[index], { opacity: 1, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\t\t\ttl.to(this.highlightDiamondOuters[index], { scale: 0.8, opacity: 0, duration: this.expandTime, ease }, 1 - this.expandTime);\r\n\r\n\t\t\tthis.timeline.to(tl, { progress: 1, ease: 'none', duration: length }, currOffset);\r\n\t\t\tcurrOffset += length;\r\n\t\t});\r\n\t\tthis.timeline.to(this.linksTimeline, { progress: 1, ease: 'none', duration: 1 }, 0);\r\n\r\n\t\t//Click listeners:\r\n\t\tthis.links.forEach((link, index) => {\r\n\t\t\tconst i = index;\r\n\t\t\tlink.addEventListener('click', (event: MouseEvent) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tthis.gotoChapter(i);\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('resize', this.onResize);\r\n\t\tthis.onResize();\r\n\t}\r\n\r\n\tprivate onResize = () => {\r\n\t\tif (window.innerWidth >= 768 && window.innerHeight >= 768) {\r\n\t\t\tthis.buildLinksDisplaceTimeline(false);\r\n\t\t} else {\r\n\t\t\tthis.buildLinksDisplaceTimeline(true);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate buildLinksDisplaceTimeline(mobile = false) {\r\n\t\tvar currOffset = 0;\r\n\t\tvar progress = this.linksTimeline.progress();\r\n\t\tvar duration = 0;\r\n\t\tvar expandTime = 0;\r\n\t\tthis.linksTimeline\r\n\t\t\t.pause(0)\r\n\t\t\t.render(0)\r\n\t\t\t.clear();\r\n\r\n\t\tthis.chapterLengths.forEach((length, index) => {\r\n\t\t\tlet tl = gsap.timeline({ paused: true });\r\n\r\n\t\t\tconst line = this.links.slice(index + 1, this.lines.length + 1);\r\n\t\t\ttl.to(line, { y: mobile ? 26 : 60, duration: this.expandTime, ease: this.ease }, 0); //26\r\n\t\t\ttl.to(line, { y: 0, duration: this.expandTime, ease: this.ease }, 1 - this.expandTime);\r\n\r\n\t\t\tthis.linksTimeline.to(tl, { progress: 1, ease: 'none', duration: length }, currOffset);\r\n\t\t\tcurrOffset += length;\r\n\t\t});\r\n\t\t// Set the animation back to its previous state\r\n\t\tthis.linksTimeline.progress(progress);\r\n\t}\r\n}\r\n","import { Chapter, IChapter } from '../../ui/chapters/Chapter';\r\nimport { DOFPointsMaterial } from '../../ui/materials/DOFPointsMaterial';\r\nimport { BufferGeometry, Color, Group, Object3D, PerspectiveCamera, Points } from 'three';\r\nimport { gsap } from 'gsap';\r\nimport { DollyZoom } from '../../utils/DollyZoom';\r\nimport { UIRing } from '../../ui/UIRing';\r\nimport { ExploreButton } from '../../ui/ExploreButton';\r\nimport { CustomEase } from 'gsap/CustomEase';\r\nimport { MainScene } from '../../ui/MainScene';\r\n\r\nexport class Chapter3 extends Chapter implements IChapter {\r\n\tprivate planetLink: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate planetLinkContainer = new Object3D();\r\n\tprivate stationContainer: Object3D;\r\n\tprivate miningStation: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate miningStation2: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate asteroids: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate ringsWrapper = new Group();\r\n\r\n\tprivate dollyZoom: DollyZoom;\r\n\tprivate dollyZoom2: DollyZoom;\r\n\tprivate dollyZoom3: DollyZoom;\r\n\tprivate dollyZoom4: DollyZoom;\r\n\tprivate dollyZoom5: DollyZoom;\r\n\tprivate dollyZoom6: DollyZoom;\r\n\tprivate dollyZoom7: DollyZoom;\r\n\r\n\tpublic CHAPTER_OFFSET = 0.005;\r\n\tpublic SCROLL_LENGTH = 15;\r\n\tprivate miningStationPlanet: Points<BufferGeometry, DOFPointsMaterial>;\r\n\r\n\tconstructor(\r\n\t\tmenu: any,\r\n\t\tcamera: PerspectiveCamera,\r\n\t\tcameraWrapper: Object3D,\r\n\t\tmainGroup: Group,\r\n\t\tcameraLookAtPoint: Object3D,\r\n\t\texploreButton: ExploreButton,\r\n\t\tchapterIntro: HTMLDivElement,\r\n\t\tchapterPOITitles: HTMLDivElement[],\r\n\t\tindex: number,\r\n\t\tmain: MainScene,\r\n\t\texploreNavLink: HTMLAnchorElement\r\n\t) {\r\n\t\tsuper(menu, camera, cameraWrapper, mainGroup, cameraLookAtPoint, exploreButton, chapterIntro, chapterPOITitles, index, main, exploreNavLink);\r\n\t\tthis.dollyZoom = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom2 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom3 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom4 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom5 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom6 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom7 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.chapterWrapper.add(this.ringsWrapper);\r\n\t}\r\n\r\n\tgetLoadItems(): Array<Array<string>> {\r\n\t\treturn [['particles/mining_station/new2/0.drc', 'mining_station'], ['particles/mining_station/planet/0.drc', 'planet'], ['particles/multiple_asteroids/0.drc', 'asteroids']];\r\n\t}\r\n\r\n\titemLoaded = (geometry: BufferGeometry, path: string, name: string) => {\r\n\t\tif (name === 'asteroids') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tminBlur: 0.02,\r\n\t\t\t\t\tmaxOpacity: 0.225,\r\n\t\t\t\t\tmaxBlur: 0.21,\r\n\t\t\t\t\tfocusNear: 11,\r\n\t\t\t\t\tfocusFar: 90,\r\n\t\t\t\t\tfocusFadeOutLength: 3.76,\r\n\t\t\t\t\tradiusScaleFactor: 100\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\t// var material = new DOFPointsMaterial({minOpacity: 0, maxBlur: 0.15, focusNear: 10000, focusFar: 15000, focusFadeOutLength: 5000}, this.menu, name);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.asteroids = mesh;\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tmesh.position.set(-26.42, -2.03, -60);\r\n\t\t\tmesh.rotation.set(-0.45, -0.35, 0);\r\n\t\t\tmesh.visible = false;\r\n\t\t\t// gsap.to(mesh.rotation, {y: Math.PI * 2, ease: 'none', repeat: -1, duration: 200});\r\n\t\t\tthis.chapterWrapper.add(mesh);\r\n\t\t} else if (name === 'mining_station') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tfocusNear: 9.7,\r\n\t\t\t\t\tfocusFar: 60,\r\n\t\t\t\t\tfocusFadeOutLength: 3.76,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.7,\r\n\t\t\t\t\tmaxBlur: 0.28,\r\n\t\t\t\t\tminBlur: 0.03,\r\n\t\t\t\t\tradiusScaleFactor: 100\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.miningStation = mesh;\r\n\t\t\tthis.miningStation.rotation.y = Math.PI * 0.5;\r\n\t\t\tthis.stationContainer = new Object3D();\r\n\t\t\tthis.stationContainer.position.set(-5.7, -3.55, -8.83);\r\n\t\t\tthis.stationContainer.rotation.y = 0.35;\r\n\t\t\tthis.stationContainer.add(this.miningStation);\r\n\r\n\t\t\tvar material2 = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tfocusNear: 9.7,\r\n\t\t\t\t\tfocusFar: 60,\r\n\t\t\t\t\tfocusFadeOutLength: 3.76,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.7,\r\n\t\t\t\t\tmaxBlur: 0.28,\r\n\t\t\t\t\tminBlur: 0.03,\r\n\t\t\t\t\tradiusScaleFactor: 100\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tthis.miningStation2 = new Points(geometry, material2);\r\n\t\t\tthis.miningStation2.scale.set(-1, 1, 1);\r\n\t\t\tthis.miningStation2.name = 'miningStation2';\r\n\t\t\tthis.miningStation2.position.set(-4.28, -1.28, 36.32);\r\n\t\t\tthis.miningStation2.rotation.set(-0.45, -11.769, 0);\r\n\t\t\tthis.exploreAnchor.position.set(-4.9, 0.9, 3.53);\r\n\t\t\tthis.miningStation2.add(this.exploreAnchor);\r\n\t\t\tthis.sortPoints.push(this.miningStation2);\r\n\t\t\t// gsap.to(mesh.rotation, {y: Math.PI * 2, ease: 'none', repeat: -1, duration: 200});\r\n\t\t\t// gsap.to(mesh.position, {y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5});\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.stationContainer;\r\n\t\t\tthis.chapterWrapper.add(mesh);\r\n\t\t\tthis.chapterWrapper.add(this.miningStation2);\r\n\t\t} else if (name === 'planet') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tfocusNear: 9.7,\r\n\t\t\t\t\tfocusFar: 41,\r\n\t\t\t\t\tfocusFadeOutLength: 3.76,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.589,\r\n\t\t\t\t\tmaxBlur: 0.12,\r\n\t\t\t\t\tminBlur: 0.03,\r\n\t\t\t\t\tradiusScaleFactor: 100\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.miningStationPlanet = mesh;\r\n\t\t\tthis.miningStationPlanet.rotation.y = Math.PI * 0.5 + 0.35;\r\n\t\t\tthis.miningStationPlanet.position.set(-5.7, -3.55, -8.83);\r\n\t\t\t// gsap.to(mesh.rotation, {y: Math.PI * 2, ease: 'none', repeat: -1, duration: 200});\r\n\t\t\t// gsap.to(mesh.position, {y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5});\r\n\t\t\tthis.chapterWrapper.add(mesh);\r\n\t\t}\r\n\t\tmesh.name = name;\r\n\t};\r\n\r\n\tloadDone() {\r\n\t\tsuper.loadDone();\r\n\t\tthis.createChapterRings();\r\n\t}\r\n\r\n\tpublic setupScrollTimeline = (): gsap.core.Timeline => {\r\n\t\tconst duration = this.duration;\r\n\r\n\t\tconst introOffset = 0.1;\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 0);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.001);\r\n\t\tthis.scrollTimeline.to(this, { scrollProgress: 1, ease: 'none', duration: this.duration }, 0);\r\n\t\tthis.scrollTimeline.fromTo(this.chapterIntroClass.timeline, { progress: 1 }, { progress: 0, ease: 'none', duration: introOffset * 0.45 }, 0);\r\n\t\tthis.scrollTimeline.to(this.chapterIntroClass.timeline, { progress: 1, ease: 'none', duration: introOffset * 0.3 }, introOffset * 1.25);\r\n\t\tthis.scrollTimeline.fromTo(this.ringsWrapper.position, { z: 20 }, { z: 0, ease: 'none', duration: introOffset }, 0);\r\n\t\tthis.scrollTimeline.from(this.ringsMaterial.uniforms.maxOpacity, { value: 0, duration: introOffset * 0.5 }, introOffset * 0.45);\r\n\t\tthis.scrollTimeline.to(\r\n\t\t\tthis.dollyZoom7,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: introOffset * 0.75,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom7.update(15, 4 + 0.9514728725 * 0.3385, 55)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.scrollTimeline.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 160, ease: 'power1.inOut', duration: introOffset * 0.75 }, 0);\r\n\r\n\t\tconst st = gsap.timeline({ paused: true });\r\n\r\n\t\t//Camera dollying:\r\n\t\tvar tlDolly = gsap.timeline({ paused: true });\r\n\t\ttlDolly.to({ dummy: 0 }, { dummy: 1, duration: 100 }, 0);\r\n\r\n\t\t//Tweak rings for focus when camera is dollying:\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFar, { value: 0.01, ease: 'power1.inOut', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFadeOutLength, { value: 24, ease: 'sine.out', duration: 5 }, 0);\r\n\t\ttlDolly.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 51, ease: 'sine.out', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.main, { mousePanAmount: 4, mouseMoveAmount: 1, duration: 10 }, 0);\r\n\r\n\t\t//Camera dollying:\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 7,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom.update(110, 100, 15)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom2,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom2.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t10\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom3,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom3.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t30\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom4,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom4.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t40\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom5,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom5.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t70\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom6,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 10,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom6.update(55, 8, 110)\r\n\t\t\t},\r\n\t\t\t80\r\n\t\t);\r\n\t\tst.to(tlDolly, { progress: 1, ease: 'none', duration: duration * 0.9 }, 0);\r\n\r\n\t\t//Chapter POI titles:\r\n\t\tst.to(this.chapterPOIs[0].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.08);\r\n\t\tst.to(this.chapterPOIs[1].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.4);\r\n\r\n\t\t//Asteroids:\r\n\t\t// st.set(this.planetShipsOrbit, {visible: false}, 0.6);\r\n\t\tst.set(this.asteroids, { visible: true }, 0);\r\n\t\tst.fromTo(this.asteroids.material.uniforms.maxOpacity, { value: 0 }, { value: 0.578, ease: 'none', duration: duration * 0.1 }, 0.05);\r\n\t\tst.to(this.asteroids.material.uniforms.minBlur, { value: 0.04, ease: 'none', duration: duration * 0.35 }, 0.1);\r\n\t\tst.fromTo(this.asteroids.rotation, { y: -0.9 }, { y: 0.71, ease: 'power1.inOut', duration: duration * 0.5 }, 0);\r\n\t\t// st.to(this.asteroids.position, {z: 30, ease: 'none', duration: duration * 0.3}, 0.65);\r\n\t\tst.fromTo(this.asteroids.position, { y: -4 }, { y: 4, ease: 'power1.inOut', duration: duration * 0.5 }, 0.05);\r\n\t\t// st.fromTo(this.asteroids.position,{x: -20}, {x: -26.420, ease: 'power1.inOut', duration: duration * 0.2}, 0.05);\r\n\t\tst.to(this.asteroids.position, { z: '+=3', ease: 'power1.inOut', duration: duration * 0.3 }, 0.1);\r\n\t\t// st.fromTo(this.asteroids.rotation,{x: -0.81}, {x: -0.45, ease: 'power1.inOut', duration: duration * 0.2}, 0.05);\r\n\t\t// st.to(this.asteroids.material.uniforms.maxOpacity, {value: 0, ease: 'none', duration: duration * 0.15}, 0.75);\r\n\t\t// st.to(this.asteroids.material.uniforms.focusNear, {value: 20, ease: 'none', duration: duration * 0.15}, 0.65);\r\n\t\t// st.to(this.asteroids.material.uniforms.focusNear, {value: 80, ease: 'none', duration: duration * 0.15}, 0.8);\r\n\t\t// st.to(this.asteroids.material.uniforms.focusFadeOutLength, {value: 3, ease: 'none', duration: duration * 0.15}, 0.65);\r\n\t\t// st.to(this.asteroids.rotation, {y: 0.71, ease: 'power1.inOut', duration: duration * 0.05}, 0.95);\r\n\t\tst.to(this.asteroids.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0.3);\r\n\t\tst.set(this.asteroids, { visible: false }, 0.8);\r\n\r\n\t\t//Mining station:\r\n\t\tst.from(this.miningStation.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0.4);\r\n\t\t// st.to(this.miningStation.material.uniforms.minBlur, {value: 0.08, ease: 'none', duration: duration * 0.1}, 0.1);\r\n\t\t// st.to(this.miningStation.material.uniforms.focusFadeOutLength, {value: 9, ease: 'none', duration: duration * 0.1}, 0.1);\r\n\t\t// st.to(this.miningStation.material.uniforms.focusNear, {value: 12, ease: 'none', duration: duration * 0.1}, 0.1);\r\n\t\t// st.from(this.stationContainer.position, {y: 0, ease: 'sine.out', duration: duration * 0.3}, 0);\r\n\t\t// st.to(this.stationContainer.rotation, {y: 0.28, ease: 'sine.out', duration: duration * 0.1}, 0.1);\r\n\t\t// st.from(this.stationContainer.position, {z: '+=10', ease: 'sine.out', duration: duration * 0.2}, 0.6);\r\n\t\tst.fromTo(this.stationContainer.rotation, { x: -0.09, y: 0 }, { x: 0, y: 0.95, ease: 'power1.in', duration: duration * 0.45 }, 0.25);\r\n\t\tst.to(this.miningStationPlanet.position, { z: -26.48, ease: 'power1.inOut', duration: duration * 0.2 }, 0.6);\r\n\r\n\t\tst.from(this.miningStation2.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.15 }, 0.71);\r\n\t\tst.from(this.miningStation2.rotation, { y: '+=1', ease: 'power1.in', duration: 1 - 0.71 }, 0.71);\r\n\t\tst.to(this.miningStation2.position, { z: '-=10', ease: 'power1.inOut', duration: 1 - 0.71 }, 0.71);\r\n\t\tst.to(this.miningStation2.position, { y: 6.375, ease: 'power1.in', duration: 1 - 0.71 }, 0.71);\r\n\t\t// st.to(this.miningStation2.rotation, {y: '-=0.5', ease: 'power1.in', duration: duration * 0.04}, 0.96);\r\n\t\tst.to(this.miningStation2.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.01 }, 0.99);\r\n\t\tst.to(this.miningStation2.material.uniforms.minBlur, { value: 0.14, ease: 'none', duration: duration * 0.07 }, 0.93);\r\n\t\tst.to(this.miningStation2.material.uniforms.maxBlur, { value: 0.63, ease: 'none', duration: duration * 0.07 }, 0.93);\r\n\t\tst.to(this.miningStation2.material.uniforms.focusNear, { value: 40.019, ease: 'none', duration: duration * 0.07 }, 0.93);\r\n\r\n\t\t//Explore button in:\r\n\t\tvar tl = gsap.timeline({ paused: true, onUpdate: this.setActiveExploreItem });\r\n\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 0.19);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'auto', duration: 0 }, 0.2);\r\n\t\ttl.to(this.exploreButton.container, { opacity: 1, ease: 'sine.out', duration: 0.2 }, 0.2);\r\n\t\ttl.to(this.exploreButton.container, { opacity: 0, ease: 'sine.out', duration: 0.2 }, 0.8);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 1);\r\n\t\t// st.to(tl, {progress: 1, ease: 'none', duration: duration * 0.25}, 0.62);\r\n\t\tst.to(tl, { progress: 1, ease: 'none', duration: duration * 0.24 }, 0.7);\r\n\r\n\t\tconst ease = CustomEase.create('custom', 'M0,0 C0.632,0.674 0.656,0.708 0.786,0.854 0.852,0.928 0.918,1 1,1 ');\r\n\t\t// const ease = CustomEase.create(\"custom\", \"M0,0 C0,0 0.826,1 1,1 \");\r\n\r\n\t\tst.to(this.cameraWrapper.position, { z: 130 + 122 * (this.index - 1), ease: ease, duration: this.duration }, 0);\r\n\t\tst.to(this.cameraLookAtPoint.position, { z: 150 + this.CHAPTER_DISTANCE * (this.index - 1), ease: ease, duration: this.duration }, 0);\r\n\r\n\t\tst.to(\r\n\t\t\tthis.main,\r\n\t\t\t{\r\n\t\t\t\tmousePanAmount: 2,\r\n\t\t\t\tmouseMoveAmount: 2,\r\n\t\t\t\tduration: 0.1\r\n\t\t\t},\r\n\t\t\t0.9\r\n\t\t);\r\n\r\n\t\tthis.scrollTimeline.to(st, { progress: 1, duration: this.duration - introOffset, ease: 'none' }, introOffset);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.999);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 1);\r\n\t\treturn this.scrollTimeline;\r\n\t};\r\n\r\n\tprivate createChapterRings() {\r\n\t\tconst rings = 14;\r\n\t\tvar offset = -80 + (rings - 5) * 10;\r\n\r\n\t\tfor (let i = 0; i < rings; i++) {\r\n\t\t\tconst ring = new UIRing(this.ringsWrapper, 10, 100, 0, Math.PI * 2, this.menu, 'ring', new Color(0x080202), null, this.ringsMaterial);\r\n\t\t\tthis.rings.push(ring);\r\n\t\t\tring.points.position.z = offset - i * 10;\r\n\t\t\tgsap.to(ring.points.rotation, { z: Math.PI, duration: 50 + i * 10, repeat: -1, ease: 'none' });\r\n\t\t}\r\n\t}\r\n}\r\n","import { Chapter, IChapter } from '../../ui/chapters/Chapter';\r\nimport { DOFPointsMaterial } from '../../ui/materials/DOFPointsMaterial';\r\nimport { BufferGeometry, Color, Group, Object3D, PerspectiveCamera, Points } from 'three';\r\nimport { gsap } from 'gsap';\r\nimport { DollyZoom } from '../../utils/DollyZoom';\r\nimport { UIRing } from '../../ui/UIRing';\r\nimport { ExploreButton } from '../../ui/ExploreButton';\r\nimport { CustomEase } from 'gsap/CustomEase';\r\nimport { MainScene } from '../../ui/MainScene';\r\n\r\nexport class Chapter4 extends Chapter implements IChapter {\r\n\tprivate capitalShipContainer: Object3D;\r\n\tprivate capitalShipContainer2: Object3D;\r\n\tprivate capitalShipContainer3: Object3D;\r\n\tprivate capitalShip: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate calicoYachtContainer: Object3D;\r\n\tprivate calicoYacht: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate cosmonautContainer: Object3D;\r\n\tprivate cosmonaut: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate ringsWrapper = new Group();\r\n\r\n\tprivate dollyZoom: DollyZoom;\r\n\tprivate dollyZoom2: DollyZoom;\r\n\tprivate dollyZoom3: DollyZoom;\r\n\tprivate dollyZoom4: DollyZoom;\r\n\tprivate dollyZoom5: DollyZoom;\r\n\tprivate dollyZoom6: DollyZoom;\r\n\tprivate dollyZoom7: DollyZoom;\r\n\r\n\tpublic CHAPTER_OFFSET = 0.01;\r\n\tpublic SCROLL_LENGTH = 15;\r\n\tprivate capitalShip2: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate capitalShip3: Points<BufferGeometry, DOFPointsMaterial>;\r\n\r\n\tconstructor(\r\n\t\tmenu: any,\r\n\t\tcamera: PerspectiveCamera,\r\n\t\tcameraWrapper: Object3D,\r\n\t\tmainGroup: Group,\r\n\t\tcameraLookAtPoint: Object3D,\r\n\t\texploreButton: ExploreButton,\r\n\t\tchapterIntro: HTMLDivElement,\r\n\t\tchapterPOITitles: HTMLDivElement[],\r\n\t\tindex: number,\r\n\t\tmain: MainScene,\r\n\t\texploreNavLink: HTMLAnchorElement\r\n\t) {\r\n\t\tsuper(menu, camera, cameraWrapper, mainGroup, cameraLookAtPoint, exploreButton, chapterIntro, chapterPOITitles, index, main, exploreNavLink);\r\n\t\tthis.dollyZoom = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom2 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom3 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom4 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom5 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom6 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom7 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.chapterWrapper.add(this.ringsWrapper);\r\n\t}\r\n\r\n\tgetLoadItems(): Array<Array<string>> {\r\n\t\treturn [['particles/capital_ship/0.drc', 'capital_ship'], ['particles/calico_yacht/new/0.drc', 'calico_yacht'], ['particles/cosmonaut/0.drc', 'cosmonaut']];\r\n\t}\r\n\r\n\titemLoaded = (geometry: BufferGeometry, path: string, name: string) => {\r\n\t\tif (name === 'cosmonaut') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 7.5,\r\n\t\t\t\t\tfocusFar: 18.5,\r\n\t\t\t\t\tfocusFadeOutLength: 3.766,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.335,\r\n\t\t\t\t\tmaxBlur: 0.46,\r\n\t\t\t\t\tradiusScaleFactor: 100,\r\n\t\t\t\t\tminBlur: 0.07\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\t// mesh.rotation.y = 0.28;\r\n\t\t\tthis.cosmonaut = mesh;\r\n\t\t\tthis.cosmonaut.position.x = -3.8;\r\n\t\t\tthis.cosmonautContainer = new Object3D();\r\n\t\t\t// this.spaceContainer.position.set(-8.07, -9, -80);\r\n\t\t\tthis.cosmonautContainer.position.set(0, -4.27, -13.76);\r\n\t\t\t// this.cosmonautContainer.rotation.x = -1.000;\r\n\t\t\t// this.exploreAnchor.position.y = 600;\r\n\t\t\t// this.exploreAnchor.position.z = 100;\r\n\t\t\t// mesh.add(this.exploreAnchor);\r\n\t\t\tthis.cosmonautContainer.add(this.cosmonaut);\r\n\t\t\t// gsap.to(mesh.rotation, {y: Math.PI * 2, ease: 'none', repeat: -1, duration: 10});\r\n\t\t\tgsap.to(this.cosmonaut.position, { y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5 });\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.cosmonautContainer;\r\n\t\t} else if (name === 'capital_ship') {\r\n\t\t\tthis.capitalShipContainer = new Object3D();\r\n\t\t\tthis.capitalShipContainer.position.set(0, 7, -20);\r\n\t\t\tthis.capitalShipContainer2 = new Object3D();\r\n\r\n\t\t\t// -0.63, z: 40\r\n\r\n\t\t\tthis.capitalShipContainer2.position.set(0, -0.63, 40);\r\n\t\t\tthis.capitalShipContainer3 = new Object3D();\r\n\t\t\tthis.capitalShipContainer3.position.set(0, -0.63, 40);\r\n\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 10,\r\n\t\t\t\t\tfocusFar: 50,\r\n\t\t\t\t\tfocusFadeOutLength: 9.5,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.214,\r\n\t\t\t\t\tmaxBlur: 0.2,\r\n\t\t\t\t\tradiusScaleFactor: 100,\r\n\t\t\t\t\tminBlur: 0.05\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.capitalShip = mesh;\r\n\r\n\t\t\tthis.capitalShip2 = new Points(geometry, material);\r\n\t\t\tthis.capitalShip2.scale.set(-1, 1, 1);\r\n\t\t\tthis.capitalShipContainer2.rotation.set(-0.08, 0.33, 0);\r\n\t\t\tthis.sortPoints.push(this.capitalShip2);\r\n\t\t\tthis.capitalShipContainer2.add(this.capitalShip2);\r\n\r\n\t\t\tthis.capitalShip3 = new Points(geometry, material);\r\n\t\t\tthis.capitalShip3.scale.set(-1, 1, 1);\r\n\t\t\tthis.capitalShipContainer3.rotation.set(-0.08, -0.33, 0);\r\n\t\t\tthis.sortPoints.push(this.capitalShip3);\r\n\t\t\tthis.capitalShipContainer3.add(this.capitalShip3);\r\n\r\n\t\t\tthis.exploreAnchor.position.y = 2.8;\r\n\t\t\tthis.capitalShip.add(this.exploreAnchor);\r\n\r\n\t\t\tthis.capitalShipContainer.add(this.capitalShip);\r\n\t\t\tthis.chapterWrapper.add(this.capitalShipContainer2);\r\n\t\t\tthis.chapterWrapper.add(this.capitalShipContainer3);\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.capitalShipContainer;\r\n\t\t} else if (name === 'calico_yacht') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 7.5,\r\n\t\t\t\t\tfocusFar: 18.5,\r\n\t\t\t\t\tfocusFadeOutLength: 3.766,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.214,\r\n\t\t\t\t\tmaxBlur: 0.46,\r\n\t\t\t\t\tradiusScaleFactor: 100,\r\n\t\t\t\t\tminBlur: 0.05\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.calicoYacht = mesh;\r\n\t\t\tthis.calicoYachtContainer = new Object3D();\r\n\t\t\tthis.calicoYachtContainer.position.set(0, 0, -77);\r\n\t\t\tthis.calicoYachtContainer.rotation.x = -1.0;\r\n\t\t\tthis.calicoYachtContainer.add(this.calicoYacht);\r\n\t\t\tgsap.to(mesh.rotation, { y: Math.PI * 2, ease: 'none', repeat: -1, duration: 200 });\r\n\t\t\tgsap.to(mesh.position, { y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5 });\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.calicoYachtContainer;\r\n\t\t}\r\n\t\tmesh.name = name;\r\n\t\tthis.chapterWrapper.add(mesh);\r\n\t};\r\n\r\n\tloadDone() {\r\n\t\tsuper.loadDone();\r\n\t\tthis.createChapterRings();\r\n\t}\r\n\r\n\tpublic setupScrollTimeline = (): gsap.core.Timeline => {\r\n\t\tconst duration = this.duration;\r\n\r\n\t\tconst introOffset = 0.1;\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 0);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.001);\r\n\t\tthis.scrollTimeline.to(this, { scrollProgress: 1, ease: 'none', duration: this.duration }, 0);\r\n\t\tthis.scrollTimeline.fromTo(this.chapterIntroClass.timeline, { progress: 1 }, { progress: 0, ease: 'none', duration: introOffset * 0.45 }, 0);\r\n\t\tthis.scrollTimeline.to(this.chapterIntroClass.timeline, { progress: 1, ease: 'none', duration: introOffset * 0.3 }, introOffset * 1.25);\r\n\t\tthis.scrollTimeline.fromTo(this.ringsWrapper.position, { z: 20 }, { z: 0, ease: 'none', duration: introOffset }, 0);\r\n\t\tthis.scrollTimeline.from(this.ringsMaterial.uniforms.maxOpacity, { value: 0, duration: introOffset * 0.5 }, introOffset * 0.45);\r\n\t\tthis.scrollTimeline.to(\r\n\t\t\tthis.dollyZoom7,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: introOffset * 0.75,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom7.update(15, 4 + 0.9514728725 * 0.3385, 55)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.scrollTimeline.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 160, ease: 'power1.inOut', duration: introOffset * 0.75 }, 0);\r\n\r\n\t\tconst st = gsap.timeline({ paused: true });\r\n\r\n\t\t//Camera dollying:\r\n\t\tvar tlDolly = gsap.timeline({ paused: true });\r\n\t\ttlDolly.to({ dummy: 0 }, { dummy: 1, duration: 100 }, 0);\r\n\r\n\t\t//Tweak rings for focus when camera is dollying:\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFar, { value: 0.01, ease: 'power1.inOut', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFadeOutLength, { value: 24, ease: 'sine.out', duration: 5 }, 0);\r\n\t\ttlDolly.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 51, ease: 'sine.out', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.main, { mousePanAmount: 4, mouseMoveAmount: 1, duration: 10 }, 0);\r\n\r\n\t\t//Camera dollying:\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 7,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom.update(110, 100, 15)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom2,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom2.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t10\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom3,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom3.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t30\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom4,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom4.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t40\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom5,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom5.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t70\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom6,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 10,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom6.update(55, 8, 110)\r\n\t\t\t},\r\n\t\t\t80\r\n\t\t);\r\n\t\tst.to(tlDolly, { progress: 1, ease: 'none', duration: duration * 0.9 }, 0);\r\n\r\n\t\tst.from(this.calicoYacht.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0);\r\n\t\t// st.from(this.calicoYachtContainer.position, {z: this.calicoYachtContainer.position.y - 3, ease: 'power1.inOut', duration: duration * 0.15}, 0);\r\n\t\tst.to(this.calicoYachtContainer.position, { z: -60, ease: 'sine.inOut', duration: duration * 0.25 }, 0.2);\r\n\t\t// st.from(this.calicoYacht.position, {z: 30, ease: 'power1.inOut', duration: duration * 0.5}, 0);\r\n\t\tst.to(this.calicoYacht.rotation, { x: 0.91, ease: 'sine.out', duration: duration * 0.3 }, 0.2);\r\n\r\n\t\tst.from(this.cosmonaut.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.cosmonaut.material.uniforms.focusFar, { value: 31.785 }, { value: 25.785, ease: 'none', duration: duration * 0.2 }, 0.3);\r\n\t\tst.from(this.cosmonaut.material.uniforms.maxBlur, { value: 0.05, ease: 'none', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.cosmonautContainer.rotation, { y: 0 }, { y: -0.438, ease: 'none', duration: duration * 0.5 }, 0.3);\r\n\t\t// st.from(this.cosmonaut.position, {y: -39, ease: 'none', duration: duration * 0.2}, 0.3);\r\n\t\tst.from(this.cosmonautContainer.position, { z: -26.307, y: -6.32, ease: 'none', duration: duration * 0.4 }, 0.3);\r\n\t\tst.fromTo(this.cosmonaut.rotation, { y: -0.95 }, { y: 1.35, ease: 'power1.inOut', duration: duration * 0.4 }, 0.3);\r\n\t\tst.to(this.cosmonaut.position, { x: 0.74, ease: 'sine.inOut', duration: duration * 0.4 }, 0.3);\r\n\r\n\t\t//Capital ship:\r\n\t\tst.from(this.capitalShip.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0.65);\r\n\t\t// st.to(this.capitalShip.material.uniforms.minBlur, {value: 0.06, ease: 'none', duration: duration * 0.1}, 0.6);\r\n\t\tst.to(this.capitalShip.material.uniforms.focusFadeOutLength, { value: 9, ease: 'none', duration: duration * 0.1 }, 0.6);\r\n\t\tst.to(this.capitalShip.material.uniforms.focusNear, { value: 12, ease: 'none', duration: duration * 0.1 }, 0.6);\r\n\t\tst.to(this.capitalShipContainer.position, { y: -0.63, z: 40, ease: 'power3.out', duration: duration * 0.2 }, 0.7);\r\n\t\t// st.to(this.capitalShipContainer2.position, {y: -0.63, z: 40, ease: 'power3.out', duration: duration * 0.2}, 0.7);\r\n\t\t// st.to(this.capitalShipContainer3.position, {y: -0.63, z: 40, ease: 'power3.out', duration: duration * 0.2}, 0.7);\r\n\t\t// st.to(this.capitalShip2.position, { z: 0, ease: 'power3.out', duration: duration * 0.2}, 0.7);\r\n\t\t// st.to(this.capitalShip3.position, { z: 0, ease: 'power3.out', duration: duration * 0.2}, 0.7);\r\n\r\n\t\tst.fromTo(this.capitalShip2.position, { z: -60, x: 16, y: 0 }, { x: 12.77, z: 5, y: -5.22, ease: 'power3.out', duration: duration * 0.1 }, 0.74);\r\n\t\tst.fromTo(this.capitalShip3.position, { z: -60, x: -16, y: 0 }, { x: -12.77, z: 5, y: -5.22, ease: 'power3.out', duration: duration * 0.1 }, 0.75);\r\n\t\tst.to(this.capitalShip.position, { /*y: -15, */ z: -51, ease: 'power3.in', duration: duration * 0.1 }, 0.9);\r\n\r\n\t\tst.to(this.capitalShip2.position, { z: 51, ease: 'power3.in', duration: duration * 0.1 }, 0.9);\r\n\t\tst.to(this.capitalShip3.position, { z: 51, ease: 'power3.in', duration: duration * 0.1 }, 0.9);\r\n\t\t// st.to(this.capitalShip2.rotation, {y: 0.370, ease: 'power3.in', duration: duration * 0.1}, 0.9);\r\n\t\t// st.to(this.capitalShip3.rotation, {y: -0.370, ease: 'power3.in', duration: duration * 0.1}, 0.9);\r\n\t\t// st.to(this.capitalShip.rotation, {z: -0.2, ease: 'power3.out', duration: duration * 0.2}, 0.7);\r\n\t\t// st.to(this.capitalShip.rotation, {z: 0, y: -0.2, ease: 'power3.in', duration: duration * 0.1}, 0.9);\r\n\t\t// st.to(this.capitalShipContainer.rotation, {y: 0.28, ease: 'sine.out', duration: duration * 0.1}, 0.6);\r\n\r\n\t\t//Chapter POI titles:\r\n\t\tst.to(this.chapterPOIs[0].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.08);\r\n\t\tst.to(this.chapterPOIs[1].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.4);\r\n\r\n\t\t//Explore button in:\r\n\t\tvar tl = gsap.timeline({ paused: true, onUpdate: this.setActiveExploreItem });\r\n\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 0.19);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'auto', duration: 0 }, 0.2);\r\n\t\ttl.to(this.exploreButton.container, { opacity: 1, ease: 'sine.out', duration: 0.2 }, 0.2);\r\n\t\ttl.to(this.exploreButton.container, { opacity: 0, ease: 'sine.out', duration: 0.2 }, 0.8);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 1);\r\n\t\t// st.to(tl, {progress: 1, ease: 'none', duration: duration * 0.25}, 0.62);\r\n\t\tst.to(tl, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.7);\r\n\r\n\t\tconst ease = CustomEase.create('custom', 'M0,0 C0.632,0.674 0.656,0.708 0.786,0.854 0.852,0.928 0.918,1 1,1 ');\r\n\t\t// const ease = CustomEase.create(\"custom\", \"M0,0 C0,0 0.826,1 1,1 \");\r\n\r\n\t\tst.to(this.cameraWrapper.position, { z: 130 + 122 * (this.index - 1), ease: ease, duration: this.duration }, 0);\r\n\t\tst.to(this.cameraLookAtPoint.position, { z: 150 + this.CHAPTER_DISTANCE * (this.index - 1), ease: ease, duration: this.duration }, 0);\r\n\r\n\t\tst.to(\r\n\t\t\tthis.main,\r\n\t\t\t{\r\n\t\t\t\tmousePanAmount: 2,\r\n\t\t\t\tmouseMoveAmount: 2,\r\n\t\t\t\tduration: 0.1\r\n\t\t\t},\r\n\t\t\t0.9\r\n\t\t);\r\n\r\n\t\tthis.scrollTimeline.to(st, { progress: 1, duration: this.duration - introOffset, ease: 'none' }, introOffset);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.999);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 1);\r\n\t\treturn this.scrollTimeline;\r\n\t};\r\n\r\n\tprivate createChapterRings() {\r\n\t\tconst rings = 15;\r\n\t\tvar offset = -80 + (rings - 5) * 10;\r\n\r\n\t\tfor (let i = 0; i < rings; i++) {\r\n\t\t\tconst ring = new UIRing(this.ringsWrapper, 10, 100, 0, Math.PI * 2, this.menu, 'ring', new Color(0x080202), null, this.ringsMaterial);\r\n\t\t\tthis.rings.push(ring);\r\n\t\t\tring.points.position.z = offset - i * 10;\r\n\t\t\tgsap.to(ring.points.rotation, { z: Math.PI, duration: 50 + i * 10, repeat: -1, ease: 'none' });\r\n\t\t}\r\n\t}\r\n}\r\n","import { Chapter, IChapter } from '../../ui/chapters/Chapter';\r\nimport { DOFPointsMaterial } from '../../ui/materials/DOFPointsMaterial';\r\nimport { BufferGeometry, Color, Group, Object3D, PerspectiveCamera, Points } from 'three';\r\nimport { gsap } from 'gsap';\r\nimport { DollyZoom } from '../../utils/DollyZoom';\r\nimport { UIRing } from '../../ui/UIRing';\r\nimport { ExploreButton } from '../../ui/ExploreButton';\r\nimport { CustomEase } from 'gsap/CustomEase';\r\nimport { MainScene } from '../../ui/MainScene';\r\n\r\nexport class Chapter5 extends Chapter implements IChapter {\r\n\tprivate usturFaceContainer: Object3D;\r\n\tprivate usturFace: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate usturContainer: Object3D;\r\n\tprivate ustur: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate councilOfPeaceContainer: Object3D;\r\n\tprivate councilOfPeace: Points<BufferGeometry, DOFPointsMaterial>;\r\n\tprivate ringsWrapper = new Group();\r\n\r\n\tprivate dollyZoom: DollyZoom;\r\n\tprivate dollyZoom2: DollyZoom;\r\n\tprivate dollyZoom3: DollyZoom;\r\n\tprivate dollyZoom4: DollyZoom;\r\n\tprivate dollyZoom5: DollyZoom;\r\n\tprivate dollyZoom6: DollyZoom;\r\n\tprivate dollyZoom7: DollyZoom;\r\n\r\n\tpublic CHAPTER_OFFSET = 0.01;\r\n\tpublic SCROLL_LENGTH = 15;\r\n\r\n\tprivate endScreen = document.querySelector('.EndScreen');\r\n\tprivate endScreenItems = document.querySelectorAll('.EndScreen .fadeIn');\r\n\r\n\tconstructor(\r\n\t\tmenu: any,\r\n\t\tcamera: PerspectiveCamera,\r\n\t\tcameraWrapper: Object3D,\r\n\t\tmainGroup: Group,\r\n\t\tcameraLookAtPoint: Object3D,\r\n\t\texploreButton: ExploreButton,\r\n\t\tchapterIntro: HTMLDivElement,\r\n\t\tchapterPOITitles: HTMLDivElement[],\r\n\t\tindex: number,\r\n\t\tmain: MainScene,\r\n\t\texploreNavLink: HTMLAnchorElement\r\n\t) {\r\n\t\tsuper(menu, camera, cameraWrapper, mainGroup, cameraLookAtPoint, exploreButton, chapterIntro, chapterPOITitles, index, main, exploreNavLink);\r\n\t\tthis.dollyZoom = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom2 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom3 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom4 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom5 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom6 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.dollyZoom7 = new DollyZoom(this.camera, this.cameraLookAtPoint);\r\n\t\tthis.chapterWrapper.add(this.ringsWrapper);\r\n\t\tgsap.set(this.endScreenItems, { opacity: 0, force3D: true });\r\n\t}\r\n\r\n\tgetLoadItems(): Array<Array<string>> {\r\n\t\treturn [['particles/ustur/face/0.drc', 'ustur_face'], ['particles/ustur/new/0.drc', 'ustur'], ['particles/council_of_peace/0.drc', 'council_of_peace']];\r\n\t}\r\n\r\n\titemLoaded = (geometry: BufferGeometry, path: string, name: string) => {\r\n\t\tif (name === 'council_of_peace') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 7.5,\r\n\t\t\t\t\tfocusFar: 18.5,\r\n\t\t\t\t\tfocusFadeOutLength: 3.766,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.335,\r\n\t\t\t\t\tmaxBlur: 0.46,\r\n\t\t\t\t\tradiusScaleFactor: 100,\r\n\t\t\t\t\tminBlur: 0.07\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.councilOfPeace = mesh;\r\n\t\t\tthis.councilOfPeaceContainer = new Object3D();\r\n\t\t\tthis.councilOfPeaceContainer.position.set(0, -6.11, -31.85);\r\n\t\t\tthis.councilOfPeaceContainer.add(this.councilOfPeace);\r\n\t\t\t// gsap.to(mesh.rotation, {y: Math.PI * 2, ease: 'none', repeat: -1, duration: 10});\r\n\t\t\t// gsap.to(this.councilOfPeaceContainer.position, {y: 0.1, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5});\r\n\t\t\tgsap.to(this.councilOfPeace.position, { y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5 });\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.councilOfPeaceContainer;\r\n\t\t} else if (name === 'ustur_face') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 10,\r\n\t\t\t\t\tfocusFar: 50,\r\n\t\t\t\t\tfocusFadeOutLength: 9.5,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.214,\r\n\t\t\t\t\tmaxBlur: 0.2,\r\n\t\t\t\t\tradiusScaleFactor: 100,\r\n\t\t\t\t\tminBlur: 0.05\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\t// mesh.rotation.y = 0.28;\r\n\t\t\tthis.usturFace = mesh;\r\n\t\t\tthis.usturFaceContainer = new Object3D();\r\n\t\t\t// this.spaceContainer.position.set(-8.07, -9, -80);\r\n\t\t\tthis.usturFaceContainer.position.set(0, 7, -20);\r\n\t\t\tthis.usturFaceContainer.add(this.exploreAnchor);\r\n\t\t\tthis.exploreAnchor.position.set(3.81, 2.9, 0);\r\n\t\t\t// this.exploreAnchor.position.z = 100;\r\n\t\t\tthis.usturFace.add(this.exploreAnchor);\r\n\t\t\tthis.usturFaceContainer.add(this.usturFace);\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.usturFaceContainer;\r\n\t\t} else if (name === 'ustur') {\r\n\t\t\tvar material = new DOFPointsMaterial(\r\n\t\t\t\t{\r\n\t\t\t\t\tuseFocusCenter: false,\r\n\t\t\t\t\tfocusNear: 7.5,\r\n\t\t\t\t\tfocusFar: 18.5,\r\n\t\t\t\t\tfocusFadeOutLength: 3.766,\r\n\t\t\t\t\tminOpacity: 0,\r\n\t\t\t\t\tmaxOpacity: 0.236,\r\n\t\t\t\t\tmaxBlur: 0.46,\r\n\t\t\t\t\tradiusScaleFactor: 100,\r\n\t\t\t\t\tminBlur: 0.05\r\n\t\t\t\t},\r\n\t\t\t\tthis.menu,\r\n\t\t\t\tname\r\n\t\t\t);\r\n\t\t\tvar mesh = new Points(geometry, material);\r\n\t\t\tmesh.scale.set(-1, 1, 1);\r\n\t\t\tthis.sortPoints.push(mesh);\r\n\t\t\tthis.ustur = mesh;\r\n\t\t\tthis.usturContainer = new Object3D();\r\n\t\t\tthis.usturContainer.position.set(0, -2.79, -77);\r\n\t\t\tthis.ustur.rotation.y = -0.8;\r\n\t\t\tthis.usturContainer.add(this.ustur);\r\n\t\t\tgsap.to(this.ustur.position, { y: 0.5, ease: 'sine.inOut', repeat: -1, yoyo: true, duration: 5 });\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\tmesh = this.usturContainer;\r\n\t\t}\r\n\t\tmesh.name = name;\r\n\t\tthis.chapterWrapper.add(mesh);\r\n\t};\r\n\r\n\tloadDone() {\r\n\t\tsuper.loadDone();\r\n\t\tthis.createChapterRings();\r\n\t}\r\n\r\n\tpublic setupScrollTimeline = (): gsap.core.Timeline => {\r\n\t\tconst duration = this.duration;\r\n\r\n\t\tconst introOffset = 0.1;\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: false }, 0);\r\n\t\tthis.scrollTimeline.set(this.chapterWrapper, { visible: true }, 0.001);\r\n\t\tthis.scrollTimeline.to(this, { scrollProgress: 1, ease: 'none', duration: this.duration }, 0);\r\n\t\tthis.scrollTimeline.fromTo(this.chapterIntroClass.timeline, { progress: 1 }, { progress: 0, ease: 'none', duration: introOffset * 0.45 }, 0);\r\n\t\tthis.scrollTimeline.to(this.chapterIntroClass.timeline, { progress: 1, ease: 'none', duration: introOffset * 0.3 }, introOffset * 1.25);\r\n\t\tthis.scrollTimeline.fromTo(this.ringsWrapper.position, { z: 20 }, { z: 0, ease: 'none', duration: introOffset }, 0);\r\n\t\tthis.scrollTimeline.from(this.ringsMaterial.uniforms.maxOpacity, { value: 0, duration: introOffset * 0.5 }, introOffset * 0.45);\r\n\t\tthis.scrollTimeline.to(\r\n\t\t\tthis.dollyZoom7,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: introOffset * 0.75,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom7.update(15, 4 + 0.9514728725 * 0.3385, 55)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\tthis.scrollTimeline.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 160, ease: 'power1.inOut', duration: introOffset * 0.75 }, 0);\r\n\r\n\t\tconst st = gsap.timeline({ paused: true });\r\n\r\n\t\t//Camera dollying:\r\n\t\tvar tlDolly = gsap.timeline({ paused: true });\r\n\t\ttlDolly.to({ dummy: 0 }, { dummy: 1, duration: 100 }, 0);\r\n\r\n\t\t//Tweak rings for focus when camera is dollying:\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFar, { value: 0.01, ease: 'power1.inOut', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.ringsMaterial.uniforms.focusFadeOutLength, { value: 24, ease: 'sine.out', duration: 5 }, 0);\r\n\t\ttlDolly.to(this.main.clusterCloud.material.uniforms.focusFar, { value: 51, ease: 'sine.out', duration: 4 }, 0);\r\n\t\ttlDolly.to(this.main, { mousePanAmount: 4, mouseMoveAmount: 1, duration: 10 }, 0);\r\n\r\n\t\t//Camera dollying:\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 7,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom.update(110, 100, 15)\r\n\t\t\t},\r\n\t\t\t0\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom2,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom2.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t10\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom3,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom3.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t30\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom4,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 12,\r\n\t\t\t\tease: 'power1.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom4.update(55, 3, 110)\r\n\t\t\t},\r\n\t\t\t40\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom5,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 6,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom5.update(110, 20, 55)\r\n\t\t\t},\r\n\t\t\t70\r\n\t\t);\r\n\t\ttlDolly.to(\r\n\t\t\tthis.dollyZoom6,\r\n\t\t\t{\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tduration: 10,\r\n\t\t\t\tease: 'sine.inOut',\r\n\t\t\t\tonUpdate: () => this.dollyZoom6.update(55, 8, 110)\r\n\t\t\t},\r\n\t\t\t80\r\n\t\t);\r\n\t\tst.to(tlDolly, { progress: 1, ease: 'none', duration: duration * 0.9 }, 0);\r\n\r\n\t\tst.from(this.ustur.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0);\r\n\t\tst.from(this.ustur.material.uniforms.maxBlur, { value: 0.1, ease: 'none', duration: duration * 0.3 }, 0);\r\n\t\t// st.from(this.usturContainer.position, {z: this.usturContainer.position.y - 3, ease: 'power1.inOut', duration: duration * 0.15}, 0);\r\n\t\tst.to(this.usturContainer.position, { z: -65, ease: 'sine.in', duration: duration * 0.3 }, 0.1);\r\n\t\t// st.from(this.ustur.position, {z: 30, ease: 'power1.inOut', duration: duration * 0.5}, 0);\r\n\t\tst.to(this.ustur.rotation, { x: 0, y: 0, ease: 'sine.out', duration: duration * 0.5 }, 0);\r\n\t\tst.to(this.usturContainer.position, { y: -2.643, ease: 'sine.out', duration: duration * 0.4 }, 0);\r\n\r\n\t\tst.to(this.councilOfPeace.material.uniforms.focusFar, { value: 35.785, ease: 'none', duration: duration * 0.3 }, 0.1);\r\n\t\tst.from(this.councilOfPeace.material.uniforms.maxBlur, { value: 0.05, ease: 'none', duration: duration * 0.4 }, 0.3);\r\n\t\tst.from(this.councilOfPeace.material.uniforms.minBlur, { value: 0.01, ease: 'none', duration: duration * 0.6 }, 0.1);\r\n\t\tst.fromTo(this.councilOfPeace.rotation, { y: 1.19 }, { y: 0, ease: 'none', duration: 0.4 }, 0.3);\r\n\t\t// st.from(this.councilOfPeace.position, {y: -39, ease: 'none', duration: duration * 0.2}, 0.3);\r\n\t\tst.to(this.councilOfPeaceContainer.position, { y: 0, ease: 'power1.out', duration: duration * 0.3 }, 0.3);\r\n\t\tst.to(this.councilOfPeaceContainer.position, { z: -12.95, ease: 'none', duration: duration * 0.4 }, 0.3);\r\n\t\tst.to(this.councilOfPeaceContainer.position, { y: 30, ease: 'power1.in', duration: duration * 0.1 }, 0.6);\r\n\r\n\t\t//Capital ship:\r\n\t\tst.from(this.usturFace.material.uniforms.maxOpacity, { value: 0, ease: 'none', duration: duration * 0.1 }, 0.65);\r\n\t\t// st.to(this.usturFace.material.uniforms.minBlur, {value: 0.06, ease: 'none', duration: duration * 0.1}, 0.6);\r\n\t\tst.to(this.usturFace.material.uniforms.focusFadeOutLength, { value: 9, ease: 'none', duration: duration * 0.1 }, 0.6);\r\n\t\tst.to(this.usturFace.material.uniforms.focusNear, { value: 12, ease: 'none', duration: duration * 0.1 }, 0.6);\r\n\t\tst.to(this.usturFaceContainer.position, { y: -0.63, z: 40, ease: 'power3.out', duration: duration * 0.2 }, 0.7);\r\n\t\t// st.to(this.usturFace.position, {/*y: -15, */z: -51, ease: 'power3.in', duration: duration * 0.1}, 0.9);\r\n\t\t// st.to(this.usturFace.rotation, {z: -0.2, ease: 'power3.out', duration: duration * 0.2}, 0.7);\r\n\t\t// st.to(this.usturFace.rotation, {z: 0, y: -0.2, ease: 'power3.in', duration: duration * 0.1}, 0.9);\r\n\t\t// st.to(this.usturFaceContainer.rotation, {y: 0.28, ease: 'sine.out', duration: duration * 0.1}, 0.6);\r\n\r\n\t\t//Chapter POI titles:\r\n\t\tst.to(this.chapterPOIs[0].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.08);\r\n\t\tst.to(this.chapterPOIs[1].timeline, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.4);\r\n\r\n\t\t//Explore button in:\r\n\t\tvar tl = gsap.timeline({ paused: true, onUpdate: this.setActiveExploreItem });\r\n\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'none', duration: 0 }, 0.19);\r\n\t\ttl.set(this.exploreButton.container, { pointerEvents: 'auto', duration: 0 }, 0.2);\r\n\t\ttl.to(this.exploreButton.container, { opacity: 1, ease: 'sine.out', duration: 0.2 }, 0.2);\r\n\t\ttl.to(this.exploreButton.container, { opacity: 0, ease: 'sine.out', duration: 0.2 }, 0.8);\r\n\t\t// st.to(tl, {progress: 1, ease: 'none', duration: duration * 0.25}, 0.62);\r\n\t\tst.to(tl, { progress: 1, ease: 'none', duration: duration * 0.25 }, 0.7);\r\n\r\n\t\tconst ease = CustomEase.create('custom', 'M0,0 C0.632,0.674 0.656,0.708 0.786,0.854 0.852,0.928 0.918,1 1,1 ');\r\n\t\t// const ease = CustomEase.create(\"custom\", \"M0,0 C0,0 0.826,1 1,1 \");\r\n\r\n\t\tst.fromTo(this.endScreenItems, { opacity: 0 }, { opacity: 1, duration: duration * 0.05, force3D: true }, 0.95);\r\n\t\tst.set(this.endScreen, { pointerEvents: 'auto' }, 0.955);\r\n\t\tst.to(this.usturFaceContainer.position, { x: 9.49, y: 4.56, ease: 'power1.inOut', duration: duration * 0.1 }, 0.9);\r\n\t\tst.to(this.usturFaceContainer.rotation, { y: 0.7, ease: 'power2.inOut', duration: duration * 0.12 }, 0.88);\r\n\t\tst.to(this.usturFace.material.uniforms.focusNear, { value: 23.65, ease: 'power1.inOut', duration: duration * 0.12 }, 0.88);\r\n\t\tst.to(this.usturFace.material.uniforms.focusFadeOutLength, { value: 2.723, ease: 'power1.inOut', duration: duration * 0.12 }, 0.88);\r\n\t\tst.to(this.usturFace.material.uniforms.maxBlur, { value: 0.35, ease: 'power1.inOut', duration: duration * 0.12 }, 0.88);\r\n\t\tst.to(this.cameraWrapper.position, { z: 130 + 122 * (this.index - 1), ease: ease, duration: this.duration }, 0);\r\n\t\tst.to(this.cameraLookAtPoint.position, { z: 150 + this.CHAPTER_DISTANCE * (this.index - 1), ease: ease, duration: this.duration }, 0);\r\n\r\n\t\t/*\r\n        st.to(this.main, {\r\n            mousePanAmount: 2,\r\n            mouseMoveAmount: 2,\r\n            duration: 0.1\r\n        }, 0.9);\r\n*/\r\n\r\n\t\tthis.scrollTimeline.to(st, { progress: 1, duration: this.duration - introOffset, ease: 'none' }, introOffset);\r\n\t\t// this.scrollTimeline.set(this.chapterWrapper, {visible: true}, 0.999);\r\n\t\t// this.scrollTimeline.set(this.chapterWrapper, {visible: false}, 1);\r\n\t\treturn this.scrollTimeline;\r\n\t};\r\n\r\n\tprivate createChapterRings() {\r\n\t\tconst rings = 16;\r\n\t\tvar offset = -80 + (rings - 5) * 10;\r\n\r\n\t\tfor (let i = 0; i < rings; i++) {\r\n\t\t\tconst ring = new UIRing(this.ringsWrapper, 10, 100, 0, Math.PI * 2, this.menu, 'ring', new Color(0x080202), null, this.ringsMaterial);\r\n\t\t\tthis.rings.push(ring);\r\n\t\t\tring.points.position.z = offset - i * 10;\r\n\t\t\tgsap.to(ring.points.rotation, { z: Math.PI, duration: 50 + i * 10, repeat: -1, ease: 'none' });\r\n\t\t}\r\n\t}\r\n}\r\n","import { GalleryItem } from './chapters/Chapter';\r\nimport { gsap } from 'gsap';\r\nimport { Draggable } from 'gsap/Draggable';\r\nimport { InertiaPlugin } from 'gsap/InertiaPlugin';\r\nimport { GlobalsLanding } from '../utils/GlobalsLanding';\r\nimport { Globals } from '../../../utils/Globals';\r\n\r\ngsap.registerPlugin(InertiaPlugin, Draggable);\r\n\r\nexport class Gallery {\r\n\tprivate items: GalleryItem[];\r\n\tprivate container = document.getElementById('LandingGallery');\r\n\tprivate imageContainer = this.container.querySelector('.LandingGallery-images');\r\n\tprivate imageContainerInner = this.container.querySelector('.LandingGallery-imagesInner');\r\n\tprivate title = this.container.querySelector('.LandingGallery-description h3');\r\n\tprivate descriptionWrapper = this.container.querySelector('.LandingGallery-descriptionWrapper');\r\n\tprivate description = this.container.querySelector('.LandingGallery-description p');\r\n\tprivate closeButton = this.container.querySelector('.LandingGallery-close');\r\n\tprivate navButtons = this.container.querySelectorAll('.LandingGallery-nav');\r\n\tprivate jumpNavContainer = this.container.querySelector('.LandingGallery-jumpNav');\r\n\tpublic visible = false;\r\n\tprivate draggable: Draggable;\r\n\r\n\tprivate width: number = 0;\r\n\tprivate animation: gsap.core.Tween;\r\n\tprivate wrap: any;\r\n\tprivate snapX: any;\r\n\tprivate progressWrap = gsap.utils.wrap(0, 1);\r\n\tprivate wrapWidth: number = 0;\r\n\tprivate proxy: HTMLDivElement;\r\n\tprivate slides: HTMLImageElement[] = [];\r\n\tprivate slideAnimation = gsap.to({}, {});\r\n\tprivate slideDuration = 0.75;\r\n\r\n\tprivate currSnapIndex = 0;\r\n\tprivate currSnapX = 0;\r\n\tprivate totalSlides = 0;\r\n\tprivate jumpNavContainerAnchors: HTMLAnchorElement[] = [];\r\n\r\n\tconstructor() {\r\n\t\tthis.closeButton.addEventListener('click', this.closeClickHandler);\r\n\t\tthis.proxy = document.createElement('div');\r\n\r\n\t\twindow.addEventListener('resize', this.resize);\r\n\t\tthis.resize();\r\n\t\tthis.draggable = new Draggable(this.proxy, {\r\n\t\t\ttrigger: GlobalsLanding.IS_ANDROID ? this.imageContainer : this.container,\r\n\t\t\tinertia: true,\r\n\t\t\tonPress: this.onPress,\r\n\t\t\tonRelease: this.onRelease,\r\n\t\t\tonDrag: this.updateProgress,\r\n\t\t\tonThrowUpdate: this.updateProgress,\r\n\t\t\tonThrowComplete: () => this.toggleCaption(true, true),\r\n\t\t\tsnap: {\r\n\t\t\t\tx: value => {\r\n\t\t\t\t\tthis.currSnapX = this.snapX(value);\r\n\t\t\t\t\tthis.currSnapIndex = this.getSnapIndex(this.currSnapX);\r\n\t\t\t\t\t// console.log('snap', this.currSnapIndex, this.currSnapX, this.progressWrap(this.currSnapX / this.wrapWidth));\r\n\t\t\t\t\treturn this.currSnapX;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.navButtons[0].addEventListener('click', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.killDragThrow(event);\r\n\t\t\tthis.animateSlides(1);\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tthis.navButtons[1].addEventListener('click', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.killDragThrow(event);\r\n\t\t\tthis.animateSlides(-1);\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate killDragThrow(event: Event) {\r\n\t\tthis.draggable.endDrag(event);\r\n\t\tif (this.draggable.tween) {\r\n\t\t\tthis.draggable.tween.progress(1);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onPress = () => {\r\n\t\tthis.toggleCaption(false);\r\n\t\tthis.updateDraggable();\r\n\t};\r\n\r\n\tprivate onRelease = () => {\r\n\t\t// gsap.killTweensOf(this.descriptionWrapper);\r\n\t\t// this.title.textContent = this.items[this.currSnapIndex].title;\r\n\t\t// this.description.textContent = this.items[this.currSnapIndex].description;\r\n\t\tif (!this.draggable.isThrowing || !this.draggable.tween || this.draggable.tween.progress() === 1) {\r\n\t\t\tthis.toggleCaption(true);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate toggleCaption = (show = false, noDelay = false) => {\r\n\t\tif (!show) {\r\n\t\t\tgsap.killTweensOf(this.descriptionWrapper);\r\n\t\t\tgsap.to(this.descriptionWrapper, { opacity: 0, duration: 0.2 });\r\n\t\t} else {\r\n\t\t\tgsap.to(this.descriptionWrapper, {\r\n\t\t\t\topacity: 1,\r\n\t\t\t\tduration: 0.2,\r\n\t\t\t\tdelay: !noDelay ? this.slideDuration : 0,\r\n\t\t\t\tonStart: () => {\r\n\t\t\t\t\tthis.title.textContent = this.items[this.currSnapIndex].title;\r\n\t\t\t\t\tthis.description.textContent = this.items[this.currSnapIndex].description;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tprivate getSnapIndex(x: number, updateAnchors = true) {\r\n\t\tif (updateAnchors) {\r\n\t\t\tthis.jumpNavContainerAnchors[this.currSnapIndex].classList.remove('active');\r\n\t\t}\r\n\t\tlet snap = Math.round((1 - this.progressWrap(x / this.wrapWidth)) * this.totalSlides);\r\n\t\tsnap = snap === this.totalSlides ? 0 : snap;\r\n\t\tif (updateAnchors) {\r\n\t\t\tthis.jumpNavContainerAnchors[snap].classList.add('active');\r\n\t\t}\r\n\t\treturn snap;\r\n\t}\r\n\r\n\tprivate animateSlides = direction => {\r\n\t\tlet currX = gsap.getProperty(this.proxy, 'x') as number;\r\n\t\tif (this.slideAnimation.isActive()) {\r\n\t\t\t//Makes it possible to click many times in a row to progress far.\r\n\t\t\tcurrX = this.slideAnimation.vars.x as number;\r\n\t\t}\r\n\t\tthis.slideAnimation.kill();\r\n\r\n\t\tvar x = this.snapX(currX + direction * this.width);\r\n\t\tthis.currSnapIndex = this.getSnapIndex(x);\r\n\r\n\t\tthis.slideAnimation = gsap.to(this.proxy, {\r\n\t\t\tx: x,\r\n\t\t\tease: 'power3.inOut',\r\n\t\t\tduration: this.slideDuration,\r\n\t\t\tonUpdate: this.updateProgress\r\n\t\t});\r\n\t};\r\n\r\n\tprivate resize = () => {\r\n\t\tif (this.items) {\r\n\t\t\tif (this.draggable.tween) {\r\n\t\t\t\tthis.draggable.tween.progress(1);\r\n\t\t\t}\r\n\t\t\tthis.animateSlides(0);\r\n\t\t\tthis.slideAnimation.progress(1);\r\n\t\t}\r\n\t\tthis.width = this.container.clientWidth;\r\n\t\tthis.snapX = gsap.utils.snap(this.width);\r\n\t\tthis.updateSize();\r\n\t};\r\n\r\n\tprivate updateSize = () => {\r\n\t\tvar norm = (gsap.getProperty(this.proxy, 'x') as number) / this.wrapWidth || 0;\r\n\t\tthis.wrapWidth = this.width * this.totalSlides;\r\n\t\tgsap.set(this.proxy, {\r\n\t\t\tx: norm * this.wrapWidth\r\n\t\t});\r\n\t};\r\n\r\n\tprivate updateDraggable = () => {\r\n\t\t// timer.restart(true);\r\n\t\tthis.slideAnimation.kill();\r\n\t\tthis.draggable.update();\r\n\t\tthis.updateProgress();\r\n\t};\r\n\tprivate updateProgress = () => {\r\n\t\tthis.animation.progress(this.progressWrap((gsap.getProperty(this.proxy, 'x') as number) / this.wrapWidth));\r\n\t};\r\n\r\n\tpublic setGalleryItems(galleryItems: GalleryItem[]) {\r\n\t\tif (this.items !== galleryItems) {\r\n\t\t\tthis.items = galleryItems;\r\n\r\n\t\t\t//Clear:\r\n\t\t\tthis.slides.forEach(slide => this.imageContainerInner.removeChild(slide));\r\n\t\t\tthis.jumpNavContainerAnchors.forEach(anchor => this.jumpNavContainer.removeChild(anchor));\r\n\t\t\tthis.jumpNavContainerAnchors = [];\r\n\r\n\t\t\tthis.slides = this.items.map((item, index) => {\r\n\t\t\t\tconst img = document.createElement('img');\r\n\t\t\t\timg.onload = () => {\r\n\t\t\t\t\timg.classList.add('loaded');\r\n\t\t\t\t};\r\n\t\t\t\timg.sizes = '100vw';\r\n\t\t\t\tconst fm = Globals.WEBP_SUPPORTED ? 'webp' : 'jpg';\r\n\t\t\t\timg.srcset = `${item.url}?w=2000&h=2000&q=80&fm=${fm} 1000w, ${item.url}?w=4000&h=2880&q=80&fm=${fm} 4000w`;\r\n\t\t\t\tgsap.set(img, {\r\n\t\t\t\t\txPercent: index * 100\r\n\t\t\t\t});\r\n\t\t\t\tthis.imageContainerInner.appendChild(img);\r\n\r\n\t\t\t\tconst jumpAnchor = document.createElement('a');\r\n\t\t\t\tjumpAnchor.href = '#slide-' + index;\r\n\t\t\t\t//@ts-ignore:\r\n\t\t\t\tjumpAnchor.slideIndex = index;\r\n\t\t\t\tif (index === 0) {\r\n\t\t\t\t\tjumpAnchor.classList.add('active');\r\n\t\t\t\t}\r\n\t\t\t\tjumpAnchor.addEventListener('click', this.jumpAnchorClickHandler);\r\n\t\t\t\tthis.jumpNavContainerAnchors.push(jumpAnchor);\r\n\t\t\t\tthis.jumpNavContainer.appendChild(jumpAnchor);\r\n\r\n\t\t\t\treturn img;\r\n\t\t\t});\r\n\t\t\tthis.currSnapIndex = 0;\r\n\t\t\tthis.currSnapX = 0;\r\n\t\t\tthis.totalSlides = this.items.length;\r\n\t\t\tif (this.totalSlides > 0) {\r\n\t\t\t\tthis.title.textContent = this.items[0].title;\r\n\t\t\t\tthis.description.textContent = this.items[0].description;\r\n\t\t\t}\r\n\t\t\tthis.wrap = gsap.utils.wrap(-100, (this.totalSlides - 1) * 100);\r\n\t\t\tgsap.set(this.proxy, {\r\n\t\t\t\tx: 0\r\n\t\t\t});\r\n\r\n\t\t\tif (this.totalSlides > 1) {\r\n\t\t\t\tthis.draggable.enable();\r\n\t\t\t\tthis.animation = gsap.to(this.slides, {\r\n\t\t\t\t\txPercent: '+=' + this.slides.length * 100,\r\n\t\t\t\t\tduration: 1,\r\n\t\t\t\t\tease: 'none',\r\n\t\t\t\t\tpaused: true,\r\n\t\t\t\t\trepeat: -1,\r\n\t\t\t\t\tmodifiers: {\r\n\t\t\t\t\t\txPercent: this.wrap\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.container.classList.remove('single');\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.classList.add('single');\r\n\t\t\t\tthis.animation = gsap.to({}, {});\r\n\t\t\t\tthis.draggable.disable();\r\n\t\t\t}\r\n\t\t\tthis.updateSize();\r\n\t\t\tthis.updateDraggable();\r\n\t\t\tthis.updateProgress();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic show() {\r\n\t\tthis.visible = true;\r\n\t\tgsap.to(this.container, { duration: 0.5, autoAlpha: 1 });\r\n\t}\r\n\r\n\tpublic hide() {\r\n\t\tthis.visible = false;\r\n\t\tgsap.to(this.container, { duration: 0.5, autoAlpha: 0 });\r\n\t}\r\n\r\n\tprivate closeClickHandler = (event: MouseEvent) => {\r\n\t\tevent.preventDefault();\r\n\t\tif (this.visible) {\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\r\n\tprivate jumpAnchorClickHandler = (event: MouseEvent) => {\r\n\t\tevent.preventDefault();\r\n\t\t//@ts-ignore:\r\n\t\tconst index = event.currentTarget.slideIndex;\r\n\t\tthis.killDragThrow(event);\r\n\r\n\t\tlet currX = gsap.getProperty(this.proxy, 'x') as number;\r\n\t\tthis.slideAnimation.kill();\r\n\r\n\t\tlet snappingToIndex = this.getSnapIndex(currX, false);\r\n\r\n\t\tlet diff = snappingToIndex - index;\r\n\r\n\t\tvar x = this.snapX(currX + diff * this.width);\r\n\t\tthis.currSnapIndex = this.getSnapIndex(x);\r\n\r\n\t\tthis.slideAnimation = gsap.to(this.proxy, {\r\n\t\t\tx: x,\r\n\t\t\tease: 'power3.inOut',\r\n\t\t\tduration: this.slideDuration,\r\n\t\t\tonUpdate: this.updateProgress\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\t};\r\n}\r\n","import { gsap } from 'gsap';\r\nimport { GlobalsLanding } from '../utils/GlobalsLanding';\r\n\r\nexport class AmbientAudio {\r\n\tprivate audioElement = document.getElementById('AmbientAudio') as HTMLAudioElement;\r\n\tprivate soundToggle = document.body.querySelector('.SoundMute') as HTMLDivElement;\r\n\tprivate playing = true;\r\n\tprivate enabled = false;\r\n\tconstructor() {\r\n\t\t//Audio:\r\n\t\tthis.audioElement.volume = 0;\r\n\t\tGlobalsLanding.AmbientAudio = this;\r\n\t}\r\n\r\n\tpublic loadAudio = () => {\r\n\t\tthis.audioElement.src = this.audioElement.dataset.src;\r\n\t\tthis.soundToggle.addEventListener('click', this.toggleSound);\r\n\t};\r\n\r\n\tpublic enableAudio = () => {\r\n\t\tthis.audioElement.play();\r\n\t\tthis.enabled = true;\r\n\t\twindow.removeEventListener('click', this.enableAudio);\r\n\t\tgsap.to(this.audioElement, { volume: 1, duration: 3 });\r\n\t};\r\n\r\n\tprivate toggleSound = () => {\r\n\t\tif (this.playing) {\r\n\t\t\tthis.playing = false;\r\n\t\t\tthis.audioElement.pause();\r\n\t\t\tthis.soundToggle.classList.add('off');\r\n\t\t} else {\r\n\t\t\tthis.playing = true;\r\n\t\t\tthis.audioElement.play();\r\n\t\t\tthis.soundToggle.classList.remove('off');\r\n\t\t}\r\n\t};\r\n\r\n\tstop() {\r\n\t\tif (this.enabled && this.playing) {\r\n\t\t\tthis.audioElement.pause();\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tif (this.enabled && this.playing) {\r\n\t\t\tthis.audioElement.play();\r\n\t\t}\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { CameraHelper, Clock, DirectionalLight, Mesh, MeshBasicMaterial, Object3D, PerspectiveCamera, SphereBufferGeometry, SpotLight, Vector3 } from 'three';\r\n\r\nimport Stats from 'three/examples/jsm/libs/stats.module';\r\nimport { GUI } from 'three/examples/jsm/libs/dat.gui.module.js';\r\nimport { PostEffects } from './PostEffects';\r\nimport { DollyZoom } from '../utils/DollyZoom';\r\nimport { gsap } from 'gsap';\r\nimport { ScrollTrigger } from 'gsap/ScrollTrigger';\r\nimport { ScrollToPlugin } from 'gsap/ScrollToPlugin';\r\nimport { MouseMoveTracker } from '../utils/MouseMoveTracker';\r\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport { Eye } from './Eye';\r\nimport { GlobalsLanding } from '../utils/GlobalsLanding';\r\nimport { LandingMouseEnter } from './LandingMouseEnter';\r\nimport { ExploreButton } from './ExploreButton';\r\nimport { Chapter } from './chapters/Chapter';\r\nimport { Chapter2 } from './chapters/Chapter2';\r\nimport { LoadManager } from '../utils/LoadManager';\r\nimport { Chapter1 } from './chapters/Chapter1';\r\nimport { DOFPointsMaterial } from './materials/DOFPointsMaterial';\r\nimport { ClusterCloud } from './ClusterCloud';\r\nimport { ExploreNav } from './ExploreNav';\r\nimport { Chapter3 } from './chapters/Chapter3';\r\nimport { Chapter4 } from './chapters/Chapter4';\r\nimport { Chapter5 } from './chapters/Chapter5';\r\nimport { Gallery } from './Gallery';\r\nimport { WEBGL } from 'three/examples/jsm/WebGL';\r\nimport { AmbientAudio } from './AmbientAudio';\r\nimport { Globals } from '../../../utils/Globals';\r\n\r\nexport class MainScene {\r\n\tprivate _camera: THREE.PerspectiveCamera;\r\n\tprivate _scene: THREE.Scene;\r\n\tprivate _renderer: THREE.WebGLRenderer;\r\n\tprivate _clock: Clock;\r\n\tprivate _mainGroup = new THREE.Group();\r\n\r\n\tpublic widthHalf: number;\r\n\tpublic heightHalf: number;\r\n\tpublic width: number;\r\n\tpublic height: number;\r\n\tpublic windowWidth: number;\r\n\tpublic windowHeight: number;\r\n\r\n\tprivate postEffects: PostEffects;\r\n\tprivate AppContainer = document.getElementById('App');\r\n\tprivate ViewContainer = document.getElementById('ViewContainer');\r\n\tprivate ScrollSpacer = document.getElementById('ScrollSpacer');\r\n\tpublic MouseMoveTracker: MouseMoveTracker = new MouseMoveTracker();\r\n\r\n\tprivate USE_SCROLL_TIMER = CSS.supports('contain', 'content');\r\n\r\n\tprivate cameraWrapper: Object3D;\r\n\tprivate cameraLookAtPoint = new Object3D();\r\n\tprivate _cameraLookAtVector = new Vector3();\r\n\tprivate eye: Eye;\r\n\tprivate clickMouseEnter: LandingMouseEnter;\r\n\tprivate diamondMouseEnter: LandingMouseEnter;\r\n\tprivate landingEnterHitArea: HTMLElement;\r\n\tprivate spotLight: SpotLight;\r\n\tprivate dirLight: DirectionalLight;\r\n\r\n\tprivate ambientValue = 0;\r\n\tprivate currentMasterScrollProgress = 0;\r\n\tprivate landingSkipped: Boolean = false;\r\n\tprivate chapterPOITitles = Array.from(document.querySelectorAll('.ChapterPOIs > div') as NodeListOf<HTMLDivElement>);\r\n\tpublic mouseMoveAmount = 0.2;\r\n\tpublic mousePanAmount = 5;\r\n\tpublic activeExploreAnchor: Object3D = null;\r\n\r\n\tpublic chapters: Chapter[] = [];\r\n\tprivate loadManager: LoadManager;\r\n\tprivate introDollyZoom: DollyZoom;\r\n\r\n\t//Debug:\r\n\tprivate renderEffects = true;\r\n\tprivate _controls: OrbitControls;\r\n\tprivate stats: Stats;\r\n\tprivate menu: any;\r\n\tprivate debugCamera: PerspectiveCamera;\r\n\tprivate DEBUG_MODE: boolean = false;\r\n\tprivate DebugHelpers: CameraHelper[] = [];\r\n\tprivate SKIP_INTRO = new URLSearchParams(window.location.search).get('skipIntro');\r\n\tprivate SKIP_LOAD_ANIMATION = new URLSearchParams(window.location.search).get('skipLoadAni');\r\n\tprivate container: HTMLDivElement;\r\n\tpublic clusterCloud: ClusterCloud;\r\n\tprivate exploreNav: ExploreNav;\r\n\tprivate chapterPositions: number[] = [];\r\n\tprivate scrollHeight: number = 0;\r\n\tprivate gallery: Gallery = new Gallery();\r\n\tprivate exploreButton = new ExploreButton(this.gallery, this);\r\n\tpublic currentExploreChapter: Chapter;\r\n\r\n\tprivate requestAnimationFrameID: number = null;\r\n\r\n\tprivate ambientAudio = new AmbientAudio();\r\n\tprivate scrollTriggerReady: boolean = false;\r\n\tprivate scrollTrigger: ScrollTrigger = null;\r\n\r\n\tconstructor(container: HTMLDivElement) {\r\n\t\tif (WEBGL.isWebGLAvailable()) {\r\n\t\t\tthis._clock = new THREE.Clock();\r\n\t\t\tif (GlobalsLanding.DEBUG) {\r\n\t\t\t\tthis.menu = new GUI();\r\n\t\t\t}\r\n\t\t\tGlobalsLanding.MainScene = this;\r\n\t\t\tthis.init(container);\r\n\t\t\tthis.animate();\r\n\r\n\t\t\t// Handle page visibility change\r\n\t\t\tdocument.addEventListener(\r\n\t\t\t\t'visibilitychange',\r\n\t\t\t\t() => {\r\n\t\t\t\t\tif (document['hidden']) {\r\n\t\t\t\t\t\tthis._clock.stop();\r\n\t\t\t\t\t\tthis.ambientAudio.stop();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._clock.start();\r\n\t\t\t\t\t\tthis.ambientAudio.resume();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tconst warning = WEBGL.getWebGLErrorMessage();\r\n\t\t\tdocument.getElementById('TemplateLayer').children[0].appendChild(warning);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate init = (container: HTMLDivElement) => {\r\n\t\tthis.container = container;\r\n\t\tgsap.registerPlugin(ScrollTrigger, ScrollToPlugin);\r\n\t\tif (GlobalsLanding.USE_STICKY && !GlobalsLanding.IS_SAFARI) {\r\n\t\t\tcontainer.style.zIndex = '-1'; //Otherwise the scrollbar does not appear in chromium browsers, but safaris performance degrades if this is set always.\r\n\t\t}\r\n\r\n\t\tif (!this.USE_SCROLL_TIMER) {\r\n\t\t\tdocument.querySelector('.ScrollTimer').remove();\r\n\t\t}\r\n\t\tif (!GlobalsLanding.USE_STICKY) {\r\n\t\t\tdocument.documentElement.classList.add('non-sticky');\r\n\t\t} else {\r\n\t\t\tScrollTrigger.defaults({\r\n\t\t\t\tscroller: this.AppContainer,\r\n\t\t\t\ttrigger: this.ScrollSpacer\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.loadManager = new LoadManager(this.loadDone);\r\n\r\n\t\tgsap.set('.ChapterPOIs', { autoAlpha: 0 });\r\n\t\tgsap.set('.BottomBar-right', { autoAlpha: 0 });\r\n\t\tgsap.set(this.chapterPOITitles, { opacity: 0, force3D: true });\r\n\t\tthis.ScrollSpacer.style.height = 'auto'; //Workarounds safari bug where the scrollbar handle is hidden.\r\n\r\n\t\tthis.width = this.ViewContainer.clientWidth;\r\n\t\tthis.height = this.ViewContainer.clientHeight;\r\n\r\n\t\tgsap.to(this, { ambientValue: 1, duration: 4, ease: 'sine.inOut', repeat: -1, yoyo: true });\r\n\t\tthis._camera = new THREE.PerspectiveCamera(65, this.width / this.height, 1, 200);\r\n\r\n\t\tthis._scene = new THREE.Scene();\r\n\t\tthis.cameraWrapper = new Object3D();\r\n\t\tthis.cameraWrapper.add(this._camera);\r\n\t\tthis._scene.add(this.cameraWrapper);\r\n\t\tthis._scene.background = new THREE.Color(0xf1eae1);\r\n\r\n\t\tthis.introDollyZoom = new DollyZoom(this._camera, this.cameraLookAtPoint);\r\n\r\n\t\tthis._renderer = new THREE.WebGLRenderer({\r\n\t\t\tantialias: !this.renderEffects,\r\n\t\t\tstencil: !this.renderEffects,\r\n\t\t\tdepth: !this.renderEffects,\r\n\t\t\tpowerPreference: 'high-performance',\r\n\t\t\tpremultipliedAlpha: GlobalsLanding.PREMULTIPLY_ALPHA\r\n\t\t});\r\n\t\tthis._renderer.setPixelRatio(GlobalsLanding.RENDERER_PIXEL_RATIO);\r\n\t\tthis._renderer.setSize(this.width, this.height);\r\n\t\tGlobalsLanding.RENDERER_HEIGHT = this.height;\r\n\r\n\t\tDOFPointsMaterial.texCircleSolid = this.loadManager.loadTexture('circle_solid_32x32_premultiplied.png');\r\n\t\tDOFPointsMaterial.texCircleAlpha = this.loadManager.loadTexture('circle_alpha_32x32_premultiplied.png');\r\n\t\tDOFPointsMaterial.texCircleSolid.premultiplyAlpha = GlobalsLanding.PREMULTIPLY_ALPHA;\r\n\t\tDOFPointsMaterial.texCircleAlpha.premultiplyAlpha = GlobalsLanding.PREMULTIPLY_ALPHA;\r\n\t\t// let anisotropy = Math.min(this._renderer.capabilities.getMaxAnisotropy(), 8);\r\n\t\t// DOFPointsMaterial.texCircleSolid.anisotropy = anisotropy;\r\n\t\t// DOFPointsMaterial.texCircleAlpha.anisotropy = anisotropy;\r\n\r\n\t\tthis.postEffects = new PostEffects(this._scene, this._camera, this._renderer, this.menu, this._clock, this.renderEffects);\r\n\r\n\t\tcontainer.appendChild(this._renderer.domElement);\r\n\r\n\t\tthis._scene.add(this._mainGroup);\r\n\t\tthis._scene.add(this.cameraLookAtPoint);\r\n\r\n\t\tthis.setupLights();\r\n\t\tif (GlobalsLanding.DEBUG) {\r\n\t\t\tthis.setupDebug();\r\n\t\t}\r\n\t\tlet resizeTimeout = 0; /*\r\n\t\twindow.addEventListener('resize', () => {\r\n\t\t\t// clear the timeout\r\n\t\t\tclearTimeout(resizeTimeout);\r\n\t\t\t// start timing for event \"completion\"\r\n\t\t\tthis.onWindowResize();\r\n\t\t\tresizeTimeout = setTimeout(this.onWindowResize, 1); //Works around a chrome bug\r\n\t\t});*/\r\n\t\twindow.addEventListener('resize', () => this.onWindowResize());\r\n\t\tthis.clusterCloud = new ClusterCloud(this.loadManager, this._mainGroup, 2, this.menu);\r\n\t\tthis.exploreNav = new ExploreNav(this.gotoChapter);\r\n\t\tthis.setupChapters();\r\n\r\n\t\tthis.landingEnterHitArea = document.querySelector('.LandingEnter-hitArea');\r\n\t\tthis.landingEnterHitArea.addEventListener('click', this.enterLanding);\r\n\t\tthis.diamondMouseEnter = new LandingMouseEnter(this.MouseMoveTracker, document.querySelector('.LandingEnter-largeDiamond'), 0.15, this.landingEnterHitArea);\r\n\t\tthis.clickMouseEnter = new LandingMouseEnter(this.MouseMoveTracker, document.querySelector('.LandingEnter'), 0.3, this.landingEnterHitArea);\r\n\t};\r\n\r\n\tprivate setupChapters() {\r\n\t\tconst chapterIntros = document.querySelectorAll('.ChapterIntro') as NodeListOf<HTMLDivElement>;\r\n\r\n\t\tconst exploreNavLinks = document.body.querySelectorAll('.ExploreNav a') as NodeListOf<HTMLAnchorElement>;\r\n\r\n\t\tconst chapter1 = new Chapter1(\r\n\t\t\tthis.menu,\r\n\t\t\tthis._camera,\r\n\t\t\tthis.cameraWrapper,\r\n\t\t\tthis._mainGroup,\r\n\t\t\tthis.cameraLookAtPoint,\r\n\t\t\tthis.exploreButton,\r\n\t\t\tchapterIntros[0],\r\n\t\t\tthis.chapterPOITitles.splice(0, 2),\r\n\t\t\t1,\r\n\t\t\tthis,\r\n\t\t\texploreNavLinks[0]\r\n\t\t);\r\n\t\tconst chapter2 = new Chapter2(\r\n\t\t\tthis.menu,\r\n\t\t\tthis._camera,\r\n\t\t\tthis.cameraWrapper,\r\n\t\t\tthis._mainGroup,\r\n\t\t\tthis.cameraLookAtPoint,\r\n\t\t\tthis.exploreButton,\r\n\t\t\tchapterIntros[1],\r\n\t\t\tthis.chapterPOITitles.splice(0, 2),\r\n\t\t\t2,\r\n\t\t\tthis,\r\n\t\t\texploreNavLinks[1]\r\n\t\t);\r\n\t\tconst chapter3 = new Chapter3(\r\n\t\t\tthis.menu,\r\n\t\t\tthis._camera,\r\n\t\t\tthis.cameraWrapper,\r\n\t\t\tthis._mainGroup,\r\n\t\t\tthis.cameraLookAtPoint,\r\n\t\t\tthis.exploreButton,\r\n\t\t\tchapterIntros[2],\r\n\t\t\tthis.chapterPOITitles.splice(0, 2),\r\n\t\t\t3,\r\n\t\t\tthis,\r\n\t\t\texploreNavLinks[2]\r\n\t\t);\r\n\t\tconst chapter4 = new Chapter4(\r\n\t\t\tthis.menu,\r\n\t\t\tthis._camera,\r\n\t\t\tthis.cameraWrapper,\r\n\t\t\tthis._mainGroup,\r\n\t\t\tthis.cameraLookAtPoint,\r\n\t\t\tthis.exploreButton,\r\n\t\t\tchapterIntros[3],\r\n\t\t\tthis.chapterPOITitles.splice(0, 2),\r\n\t\t\t4,\r\n\t\t\tthis,\r\n\t\t\texploreNavLinks[3]\r\n\t\t);\r\n\t\tconst chapter5 = new Chapter5(\r\n\t\t\tthis.menu,\r\n\t\t\tthis._camera,\r\n\t\t\tthis.cameraWrapper,\r\n\t\t\tthis._mainGroup,\r\n\t\t\tthis.cameraLookAtPoint,\r\n\t\t\tthis.exploreButton,\r\n\t\t\tchapterIntros[4],\r\n\t\t\tthis.chapterPOITitles.splice(0, 2),\r\n\t\t\t5,\r\n\t\t\tthis,\r\n\t\t\texploreNavLinks[4]\r\n\t\t);\r\n\t\tthis.chapters.push(chapter1);\r\n\t\tthis.chapters.push(chapter2);\r\n\t\tthis.chapters.push(chapter3);\r\n\t\tthis.chapters.push(chapter4);\r\n\t\tthis.chapters.push(chapter5);\r\n\r\n\t\tthis.eye = new Eye(this._scene, this.postEffects, this.menu, this.loadManager);\r\n\t\tthis.loadManager.setChapters(this.chapters);\r\n\t\tthis.loadManager.startLoading();\r\n\t}\r\n\r\n\tprivate loadDone = () => {\r\n\t\tthis._camera.position.z = -305;\r\n\t\tthis._camera.fov = 65;\r\n\t\tthis.ambientAudio.loadAudio();\r\n\r\n\t\tthis.onWindowResize(true);\r\n\r\n\t\tthis.chapters.forEach(chapter => chapter.loadDone());\r\n\t\tthis.playLoadDoneIntroAnimation();\r\n\t\tthis.activeExploreAnchor = this.chapters[0].exploreAnchor;\r\n\r\n\t\tif (GlobalsLanding.DEBUG) {\r\n\t\t\tthis.setupDebugControls();\r\n\t\t}\r\n\t};\r\n\r\n\tprivate animate = () => {\r\n\t\tthis.requestAnimationFrameID = requestAnimationFrame(this.animate);\r\n\t\tif (GlobalsLanding.DEBUG) {\r\n\t\t\tthis.stats.begin();\r\n\t\t}\r\n\t\tthis.MouseMoveTracker.raf();\r\n\t\tif (GlobalsLanding.VIDEO_OPEN || Globals.MENU_OPEN) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._camera.position.x = this.mouseMoveAmount * this.MouseMoveTracker.pos.xEased;\r\n\t\tthis._camera.position.y = this.mouseMoveAmount * this.MouseMoveTracker.pos.yEased;\r\n\t\tif (this.postEffects.godRaysEffect && this.landingSkipped == false) {\r\n\t\t\tthis.spotLight.position.y = 2.24 + this.MouseMoveTracker.pos.yEased * 1;\r\n\t\t\tthis.spotLight.position.x = 2.27 + this.MouseMoveTracker.pos.xEased * 3;\r\n\t\t\tthis.postEffects.godRaysEffect.godRaysMaterial.uniforms.decay.value = 0.88 + (1 - this.MouseMoveTracker.pos.distanceFromCenter) * 0.05;\r\n\t\t}\r\n\t\t// this._camera.position.y = 0.15 * this.MouseMoveTracker.pos.yEased;\r\n\t\t/*     if (this._shipWrapper) {\r\n                 // this._shipWrapper.rotation.y = Math.PI * 0.1 * this.MouseMoveTracker.pos.xEased;\r\n                 // this._shipWrapper.rotation.z = Math.PI * 0.05 * this.MouseMoveTracker.pos.yEased;\r\n             }*/\r\n\t\tthis.cameraLookAtPoint.position.x = this.mousePanAmount * (this.MouseMoveTracker.pos.xEased * -1);\r\n\t\tthis.cameraLookAtPoint.position.y = this.mousePanAmount * (this.MouseMoveTracker.pos.yEased * -1);\r\n\r\n\t\t// this._camera.lookAt(500 * this.MouseMoveTracker.pos.xEased, 500 * this.MouseMoveTracker.pos.yEased, 0);\r\n\t\tthis.cameraLookAtPoint.getWorldPosition(this._cameraLookAtVector);\r\n\t\t//todo: @lasse, see if all these updates are really necessary, look at seems expensive:\r\n\t\tthis._camera.lookAt(this._cameraLookAtVector);\r\n\t\tthis._camera.updateProjectionMatrix();\r\n\t\tthis._camera.updateMatrixWorld();\r\n\r\n\t\t// this.chapters[0].raf();\r\n\t\t// this.chapters.forEach(chapter => chapter.raf())\r\n\t\tif (this.activeExploreAnchor) {\r\n\t\t\tthis.exploreButton.updateScreenPosition(this.activeExploreAnchor, this._camera, this.widthHalf, this.heightHalf);\r\n\t\t}\r\n\r\n\t\t/*        if (this._ship) {\r\n                    //@todo: sort points is slow on the cpu, optimize, maybe webassembly or something else?\r\n                    // sortPoints(this._ship, this._camera);\r\n                }*/\r\n\t\t// this.rings.forEach(ring => sortPoints(ring.points, this._camera));\r\n\t\tif (this.DEBUG_MODE) {\r\n\t\t\tthis._controls.update();\r\n\t\t\tthis.DebugHelpers.forEach(helper => helper.update());\r\n\t\t\tthis._renderer.render(this._scene, this.debugCamera);\r\n\t\t} else {\r\n\t\t\tif (this.postEffects.enabled) {\r\n\t\t\t\tthis.postEffects.render();\r\n\t\t\t} else {\r\n\t\t\t\tthis._renderer.render(this._scene, this._camera);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (GlobalsLanding.DEBUG) {\r\n\t\t\tthis.stats.end();\r\n\t\t}\r\n\t};\r\n\r\n\tprivate onWindowResize = (force = false) => {\r\n\t\tvar prevWidth = this.width;\r\n\t\tvar prevHeight = this.height;\r\n\t\tthis.windowWidth = window.innerWidth;\r\n\t\tthis.windowHeight = window.innerHeight;\r\n\t\tthis.width = this.ViewContainer.clientWidth;\r\n\t\tthis.height = this.ViewContainer.clientHeight;\r\n\t\tGlobalsLanding.RENDERER_HEIGHT = this.height;\r\n\t\tif (prevWidth != this.width || prevHeight != this.height || force === true) {\r\n\t\t\tthis._camera.aspect = this.width / this.height;\r\n\t\t\t// console.log(this._camera.aspect);\r\n\t\t\tif (!this.landingSkipped && this._camera.aspect >= 1.9) {\r\n\t\t\t\tthis._camera.zoom = 1 + (this._camera.aspect - 1.9) + 0.15;\r\n\t\t\t\t// this._camera.zoom = gsap.utils.clamp(1, 2, );\r\n\t\t\t} else {\r\n\t\t\t\tthis._camera.zoom = 1;\r\n\t\t\t}\r\n\t\t\t// this._camera.zoom = gsap.utils.clamp(0.7, 1, this._camera.aspect);\r\n\t\t\t// this._camera.zoom = gsap.utils.mapRange()\r\n\t\t\t// var factor = 1 / gsap.utils.clamp(0.5, 1, this._camera.aspect);\r\n\t\t\t// this._camera.setViewOffset(this.width, this.height, (this.width - (this.width * factor)) * 0.5, (this.height - (this.height * factor)) * 0.5, this.width * factor, this.height * factor);\r\n\t\t\tthis._camera.updateProjectionMatrix();\r\n\r\n\t\t\tthis.widthHalf = this.width / 2;\r\n\t\t\tthis.heightHalf = this.height / 2;\r\n\r\n\t\t\tthis._renderer.setSize(this.width, this.height);\r\n\t\t\tthis.postEffects.composer.setSize(this.width, this.height);\r\n\t\t\tthis.MouseMoveTracker.resize();\r\n\t\t\tif (this.scrollTriggerReady) {\r\n\t\t\t\t// console.log('before: ', this.scrollTrigger.progress, this.height);\r\n\t\t\t\tconst progress = this.scrollTrigger.progress;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.scrollTrigger.scroll(progress * ScrollTrigger.maxScroll(this.scrollTrigger.scroller as HTMLElement));\r\n\t\t\t\t\tthis.scrollTrigger.getTween().progress(1);\r\n\t\t\t\t\tScrollTrigger.update();\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tthis.scrollTrigger.refresh();\r\n\t\t\t\t\tScrollTrigger.update();\r\n\t\t\t\t\tthis.scrollTrigger.scroll(progress * ScrollTrigger.maxScroll(this.scrollTrigger.scroller as HTMLElement));\r\n\t\t\t\t\tthis.scrollTrigger.getTween().progress(1);\r\n\t\t\t\t\t// console.log('after: ', this.scrollTrigger.progress);\r\n\t\t\t\t}, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tprivate setupLights() {\r\n\t\t/*\r\n        const light1 = new THREE.HemisphereLight(0x00ff00, 0x000088);\r\n        light1.position.set(-1, 1.5, 1);\r\n        this._scene.add(light1);\r\n\r\n        const light2 = new THREE.HemisphereLight(0xfff00, 0x880000, 0.5);\r\n        light2.position.set(-1, -1.5, -1);\r\n        this._scene.add(light2);\r\n\r\n*/\r\n\t\tthis.dirLight = new DirectionalLight(0xffffff, 0.49);\r\n\t\tthis.dirLight.position.set(0, 1, -10);\r\n\t\tthis.dirLight.lookAt(0, 0, 0);\r\n\t\t// var lightHelper = new DirectionalLightHelper(this.dirLight, 1);\r\n\t\t// this._scene.add(lightHelper);\r\n\t\t// gsap.to(this.dirLight.position, {duration: 3, yoyo: true, repeat: -1, z: 2000})\r\n\t\tthis._scene.add(this.dirLight);\r\n\r\n\t\tthis.spotLight = new SpotLight(0xffffff, 1, 1);\r\n\t\tthis.spotLight.intensity = 1.853;\r\n\t\tthis.spotLight.penumbra = 0.0;\r\n\t\tthis.spotLight.angle = 1.571;\r\n\t\tthis.spotLight.decay = -178;\r\n\t\tthis.spotLight.power = 5.58;\r\n\t\tthis.spotLight.position.set(2.27, 2.24, -305);\r\n\t\t// this.spotLight.lookAt(0,0,0);\r\n\t\tthis._scene.add(this.spotLight);\r\n\r\n\t\t// var ambLight = new AmbientLight();\r\n\t\t// ambLight.intensity = 1;\r\n\t\t// this._scene.add(ambLight);\r\n\t}\r\n\r\n\tprivate playLoadDoneIntroAnimation() {\r\n\t\tvar duration = 4;\r\n\t\tthis.setupScrollTimeline();\r\n\t\tthis.chapters[0].chapterIntroClass.timeline.progress(1);\r\n\t\tvar loadTimeline = gsap.timeline({\r\n\t\t\tpaused: true,\r\n\t\t\tease: 'power4.inOut',\r\n\t\t\tdelay: 0,\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tdocument.getElementById('Loading').remove();\r\n\t\t\t\tif (this.SKIP_INTRO) {\r\n\t\t\t\t\tsetTimeout(this.enterLanding, 100);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tloadTimeline.add(this.eye.getIntroAnimation(), 0);\r\n\t\tloadTimeline.from(this._camera, { zoom: this._camera.zoom + 2, duration: duration * 0.75, ease: 'power3.inOut' }, 0);\r\n\t\tloadTimeline.fromTo(this._camera.position, { z: -300 }, { z: -305, duration: duration }, 0);\r\n\t\tloadTimeline.call(\r\n\t\t\t() => {\r\n\t\t\t\tthis.diamondMouseEnter.enable();\r\n\t\t\t\tthis.clickMouseEnter.enable();\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t\t3\r\n\t\t);\r\n\t\tloadTimeline.set(this.landingEnterHitArea, { visibility: 'visible' }, duration);\r\n\t\tif (this.SKIP_LOAD_ANIMATION || this.SKIP_INTRO) {\r\n\t\t\tloadTimeline.timeScale(10);\r\n\t\t}\r\n\t\tloadTimeline.add(() => {\r\n\t\t\tdocument.documentElement.classList.add('darkMenu');\r\n\t\t}, 1.3);\r\n\t\tdocument.body.classList.add('loaded');\r\n\t\tloadTimeline.play();\r\n\t}\r\n\r\n\tprivate enableScroll = () => {\r\n\t\t//Safari/chrome bug workaround:\r\n\t\t//Define scrollspacer height\r\n\t\tthis.ScrollSpacer.style.display = 'block';\r\n\t\tthis.ScrollSpacer.style.height = this.scrollHeight * 100 + '%';\r\n\t\tthis.ScrollSpacer.style.display = 'none';\r\n\t\tthis.ScrollSpacer.offsetHeight; // no need to store this anywhere, the reference is enough\r\n\t\tthis.ScrollSpacer.style.display = 'block';\r\n\t\t//Define scrollspacer height end\r\n\t\tScrollTrigger.refresh();\r\n\t\tthis.scrollTriggerReady = true;\r\n\t\t// console.log(\"second sort\", this._camera.position, this._camera.rotation);\r\n\t\t// this.chapters.forEach(chapter => chapter.sortPointsData()); //This is slow;\r\n\t};\r\n\r\n\tprivate setupScrollTimeline = () => {\r\n\t\tconst scrub = GlobalsLanding.SCRUB_DURATION;\r\n\t\tthis.chapters.forEach(chapter => (this.scrollHeight += chapter.SCROLL_LENGTH));\r\n\r\n\t\tif (this.USE_SCROLL_TIMER) {\r\n\t\t\tconst scrollTimerText = document.querySelector('.ScrollTimer-time');\r\n\t\t\tvar scrolltime = { time: parseFloat(scrollTimerText.textContent) };\r\n\t\t\tgsap.to(scrolltime, {\r\n\t\t\t\tscrollTrigger: { scrub: scrub, start: '0%', end: '100%' },\r\n\t\t\t\ttime: '+=1001',\r\n\t\t\t\tease: 'none',\r\n\t\t\t\tonUpdate: () => {\r\n\t\t\t\t\tscrollTimerText.textContent = scrolltime.time.toFixed(3);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//Master scroll timeline, where chapter timelines get nested into:\r\n\t\tconst mtl = gsap.timeline({ scrollTrigger: { scrub: scrub, start: '0%', end: '100%' } });\r\n\t\tmtl.to(this, { currentMasterScrollProgress: 1, duration: 1, ease: 'none' }, 0);\r\n\t\tthis.scrollTrigger = mtl.scrollTrigger;\r\n\r\n\t\t// const wrapperPosDiff = 130 - this.cameraWrapper.position.z;\r\n\t\t// console.log('wrapperPosDiff: ' + wrapperPosDiff);\r\n\r\n\t\tconst chapterLength = 1 / this.chapters.length;\r\n\r\n\t\tlet currPos = 0;\r\n\t\tvar chapterLengths = [];\r\n\t\tvar currScrollLength = 0;\r\n\t\tthis.chapters.forEach((chapter, index) => {\r\n\t\t\tconst tl = chapter.setupScrollTimeline();\r\n\t\t\tconst length = chapter.SCROLL_LENGTH / this.scrollHeight;\r\n\t\t\tthis.chapterPositions.push(currScrollLength);\r\n\t\t\tcurrScrollLength += chapter.SCROLL_LENGTH;\r\n\r\n\t\t\tchapterLengths.push(length);\r\n\r\n\t\t\tmtl.to(tl, { progress: 1, ease: 'none', duration: length }, currPos - chapter.CHAPTER_OFFSET);\r\n\t\t\tcurrPos += length;\r\n\t\t});\r\n\t\tif (mtl.totalDuration() !== 1) {\r\n\t\t\tconsole.warn('Total timeline length is not == 1, somethings wonky');\r\n\t\t}\r\n\t\tthis.exploreNav.setupTimeline(chapterLengths);\r\n\t\tmtl.to(this.exploreNav.timeline, { progress: 1, ease: 'none', duration: mtl.totalDuration() }, 0);\r\n\r\n\t\t//@todo:\r\n\t\t// console.log(\"first sort\", this._camera.position, this._camera.rotation);\r\n\r\n\t\tlet camPos = this._camera.position.clone();\r\n\t\tlet camRot = this._camera.rotation.clone();\r\n\t\tthis._camera.position.set(-0.09324138656189779, 0.5441061764985087, -209.02427365941497);\r\n\t\tthis._camera.rotation.set(3.1411942241032187, 0.0006787114349817719, -3.141592383171151);\r\n\t\tthis._camera.updateProjectionMatrix();\r\n\t\tthis._camera.updateMatrixWorld(true);\r\n\t\tthis._camera.updateMatrix();\r\n\t\tthis._camera.updateWorldMatrix(true, true);\r\n\t\t// console.log(\"first sort\", this._camera.position, this._camera.rotation);\r\n\r\n\t\tthis.chapters.forEach(chapter => chapter.sortPointsData()); //This is slow;\r\n\t\tthis._camera.position.copy(camPos);\r\n\t\tthis._camera.rotation.copy(camRot);\r\n\r\n\t\tgsap.set(this.exploreButton.container, { opacity: 0, force3D: true });\r\n\r\n\t\t// ScrollTrigger.refresh(false);\r\n\t\t// this.gotoChapter(1);\r\n\t};\r\n\r\n\tpublic gotoChapter = (index: number) => {\r\n\t\tif (index < this.chapters.length) {\r\n\t\t\tvar scrollTo = index === 0 ? 0 : this.chapterPositions[index] * this.height + this.height * 0.8;\r\n\t\t} else {\r\n\t\t\tvar scrollTo = this.scrollHeight * this.height;\r\n\t\t}\r\n\t\tif (GlobalsLanding.USE_STICKY) {\r\n\t\t\tgsap.to(this.AppContainer, { duration: 1, scrollTo: { y: scrollTo } });\r\n\t\t} else {\r\n\t\t\tgsap.to(window, { duration: 1, scrollTo: { y: scrollTo } });\r\n\t\t}\r\n\t};\r\n\r\n\tprivate enterLanding = () => {\r\n\t\tthis.landingEnterHitArea.removeEventListener('click', this.enterLanding);\r\n\t\tthis.landingEnterHitArea.style.display = 'none';\r\n\t\tthis.landingSkipped = true;\r\n\t\tthis.clickMouseEnter.disable();\r\n\t\tthis.diamondMouseEnter.disable();\r\n\t\tthis.ambientAudio.enableAudio();\r\n\t\tconst firstChapter = this.chapters[0];\r\n\r\n\t\tgsap.to('#StickyOverlay .startScreenTrailer', { autoAlpha: 0, duration: 0.4 });\r\n\t\tgsap.to('.LandingMenuIntroWrapper', { autoAlpha: 0, duration: 0.4 });\r\n\r\n\t\tvar tl = gsap.timeline({ paused: true, onComplete: this.enableScroll });\r\n\t\tvar duration = 5;\r\n\t\t// tl.to(this.cameraLookAtPoint.position, {z: 250 * .05, ease: 'sine.inOut', duration: duration * 1}, 0);\r\n\t\ttl.add(this.eye.getScrollInAnimation());\r\n\t\t// tl.to(this.eye.getScrollInAnimation(), {progress: 1, duration: duration}, 0);\r\n\t\ttl.to(firstChapter.chapterIntroClass.timeline, { progress: 0, duration: 2.5, ease: 'sine.inOut' }, duration - 1);\r\n\t\ttl.to('.ExploreNav', { autoAlpha: 1, duration: 2 }, 3);\r\n\t\ttl.to('.ChapterPOIs', { autoAlpha: 1, duration: 2 }, 3);\r\n\t\ttl.to('.BottomBar-right', { autoAlpha: 1, duration: 2 }, 3);\r\n\t\tif (this.USE_SCROLL_TIMER) {\r\n\t\t\ttl.to('.ScrollTimer', { opacity: 1, duration: 2 }, 3);\r\n\t\t}\r\n\r\n\t\ttl.to(\r\n\t\t\tthis.introDollyZoom,\r\n\t\t\t{\r\n\t\t\t\tduration: 2,\r\n\t\t\t\tease: 'power3.inOut',\r\n\t\t\t\ttotalProgress: 1,\r\n\t\t\t\tonUpdate: () => this.introDollyZoom.update(15, -25)\r\n\t\t\t},\r\n\t\t\t3\r\n\t\t);\r\n\t\ttl.to(this.cameraWrapper.position, { z: 8, ease: 'power4.inOut', duration: 4 }, 3);\r\n\t\ttl.to(this._camera, { zoom: 1, duration: 2, ease: 'power3.inOut' }, 3);\r\n\t\ttl.to(this, { mousePanAmount: 2, mouseMoveAmount: 2, duration: 2, ease: 'power3.inOut' }, 3);\r\n\t\ttl.to('.ScrollHelpIndicator', { opacity: 1, duration: 1 }, 6);\r\n\t\ttl.from(firstChapter.ringsMaterial.uniforms.maxOpacity, { duration: 2, value: 0 }, 3);\r\n\t\ttl.add(() => {\r\n\t\t\tdocument.documentElement.classList.remove('darkMenu');\r\n\t\t}, 2.8);\r\n\t\ttl.play();\r\n\t\t// tl.set(this.spotLight, {visible: false});\r\n\t\t// tl.set(this.dirLight, {visible: false});\r\n\t\tif (this.SKIP_INTRO) {\r\n\t\t\ttl.timeScale(10);\r\n\t\t}\r\n\t};\r\n\r\n\tprivate setupDebugControls() {\r\n\t\tvar firstTimeDebug = true;\r\n\t\twindow.addEventListener('keyup', event => {\r\n\t\t\tif (event.key == 'h') {\r\n\t\t\t\tdocument.body.classList.toggle('hide-debug');\r\n\t\t\t}\r\n\t\t\tif (event.key == 'd') {\r\n\t\t\t\tif (firstTimeDebug) {\r\n\t\t\t\t\tfirstTimeDebug = false;\r\n\t\t\t\t\tvar cameraHelper = new CameraHelper(this._camera);\r\n\t\t\t\t\tthis.DebugHelpers.push(cameraHelper);\r\n\t\t\t\t\tthis._scene.add(cameraHelper);\r\n\t\t\t\t\tthis.debugCamera.position.copy(this._camera.position);\r\n\t\t\t\t\tthis.cameraLookAtPoint.add(new Mesh(new SphereBufferGeometry(1), new MeshBasicMaterial({ color: 0xff2080 })));\r\n\t\t\t\t}\r\n\t\t\t\tthis.DEBUG_MODE = !this.DEBUG_MODE;\r\n\t\t\t\tif (this.DEBUG_MODE) {\r\n\t\t\t\t\tdocument.body.classList.add('camera-debug');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdocument.body.classList.remove('camera-debug');\r\n\t\t\t\t}\r\n\t\t\t\tthis._controls.enabled = this.DEBUG_MODE;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate setupDebug() {\r\n\t\t// document.body.classList.add('hide-debug');\r\n\t\tdocument.body.classList.add('show-fps');\r\n\t\tthis.debugCamera = new THREE.PerspectiveCamera(45, this.width / this.height, 1, 8000);\r\n\t\tthis.menu\r\n\t\t\t.add(this._camera, 'fov')\r\n\t\t\t.min(0.0)\r\n\t\t\t.max(179.99)\r\n\t\t\t.step(0.1)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis._camera.fov = value;\r\n\t\t\t\tthis._camera.updateProjectionMatrix();\r\n\t\t\t});\r\n\t\tthis.menu\r\n\t\t\t.add(this._camera, 'far')\r\n\t\t\t.min(0.0)\r\n\t\t\t.max(200)\r\n\t\t\t.step(0.1)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis._camera.far = value;\r\n\t\t\t\tthis._camera.updateProjectionMatrix();\r\n\t\t\t});\r\n\t\tthis.debugCamera.position.z = 300;\r\n\t\tthis._controls = new OrbitControls(this.debugCamera, this._renderer.domElement);\r\n\t\tthis._controls.target.set(0, 0, 0);\r\n\t\tthis._controls.zoomSpeed = 0.1;\r\n\t\tthis._controls.enabled = this.DEBUG_MODE;\r\n\t\t// stats\r\n\t\tthis.stats = Stats();\r\n\t\tdocument.body.appendChild(this.stats.dom);\r\n\t\t//For debugging:\r\n\t\tthis.menu.close();\r\n\t\t//@ts-ignore:\r\n\t\twindow.THREE = THREE;\r\n\t\t(window as any).scene = this._scene;\r\n\t}\r\n\r\n\tpublic kill = () => {\r\n\t\tcancelAnimationFrame(this.requestAnimationFrameID);\r\n\t};\r\n}\r\n"],"sourceRoot":""}